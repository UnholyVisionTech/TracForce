<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title>TracForce CRM — Preview</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body,#root{width:100%;height:100%;overflow:hidden}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}</style>
</head><body><div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect, useRef } = React;


/* ══════════════════════════════════════════════════════════
   §2 — CONSTANTS & PERMISSIONS
   Standalone: constants.js — no dependencies
   ══════════════════════════════════════════════════════════ */
const ROLE_ORDER=["Master","Admin","Manager","Asst. Manager","Specialist","Client"];
const roleIdx=r=>ROLE_ORDER.indexOf(r);
const isAbove=(a,b)=>roleIdx(a)<roleIdx(b);
const canAssignKeys=r=>roleIdx(r)<=3;
const canDeleteBelow=(a,t)=>{if(a==="Master")return true;if(a==="Admin")return isAbove(a,t);return false;};
const canEditDeleteNote=(ar,nr)=>{if(ar==="Master")return true;if(ar==="Admin"||ar==="Manager")return isAbove(ar,nr)||ar===nr;if(ar==="Asst. Manager")return isAbove(ar,nr);return false;};

const ROLE_INFO={Master:{desc:"Full system access. Can override all permissions, manage billing, view audit logs, and delete any content.",perms:["Full system access","Delete any profile","Manage billing","View audit logs","Override all permissions","Approve changes to Master content"]},Admin:{desc:"High-level management access. Can delete profiles below their level, assign roles, view audit logs, and manage team operations.",perms:["Delete profiles below own level","Assign key access below own level","Edit/delete notes below own level","View audit logs","View all profiles & metrics","Use dial-in","View call recordings"]},Manager:{desc:"Team management access. Can assign roles and manage notes for team members below their level.",perms:["Assign key access below own level","Edit/delete notes below own level","View all profiles & metrics","Use dial-in","View call recordings"]},"Asst. Manager":{desc:"Supervisory access with ability to assign roles to Specialists.",perms:["Assign key access below own level","Edit/delete notes below own level","View all profiles & metrics","Use dial-in","View call recordings"]},Specialist:{desc:"Standard team member access. Can add notes, use dial-in, and view profiles.",perms:["Add notes (edit own only)","View all profiles & metrics","Use dial-in","View call recordings"]},Client:{desc:"External client — no platform access. Data is stored about them, not for them.",perms:["No platform access"]}};


/* ══════════════════════════════════════════════════════════
   §3 — SEED DATA & PROCEDURAL GENERATION
   Standalone: seedData.js — depends on: nothing
   ══════════════════════════════════════════════════════════ */
const initPosts={t1:[{id:"p1",date:"2026-02-25 09:15",text:"Wrapped up Q1 renewal discussions with NovaTech. Looking strong for an upsell."},{id:"p2",date:"2026-02-22 14:30",text:"Team sync complete — new onboarding flow rolling out next week."},{id:"p3",date:"2026-02-18 11:00",text:"Updated client tiers across the board. Enterprise accounts flagged for review."}],t2:[{id:"p1",date:"2026-02-24 16:00",text:"SSO integration resolved for BlueShift Labs."},{id:"p2",date:"2026-02-20 10:45",text:"Completed security audit on dial-in configurations."}],t3:[{id:"p1",date:"2026-02-23 13:20",text:"Quarterly reviews scheduled for all Enterprise clients through March."}],t4:[{id:"p1",date:"2026-02-21 09:30",text:"Onboarded 2 new Specialist team members this week."}],t5:[{id:"p1",date:"2026-02-25 08:00",text:"First week complete — getting up to speed on client workflows."}],t6:[{id:"p1",date:"2026-02-24 11:15",text:"Finished initial training. Ready to start client outreach next week."}]};

const TEAM_INIT=[
  {id:"t1",name:"Sarah Mitchell",role:"Master",email:"sarah@tracforce.com",phone:"+1 (415) 555-0100",joined:"2024-06-01",avatar:"SM",phoneTime:"142:38",noteCount:87,callCount:234,lastActive:"2026-02-25",photo:null},
  {id:"t2",name:"James Keller",role:"Admin",email:"james@tracforce.com",phone:"+1 (415) 555-0101",joined:"2024-08-15",avatar:"JK",phoneTime:"98:22",noteCount:63,callCount:178,lastActive:"2026-02-25",photo:null},
  {id:"t3",name:"Alex Rodriguez",role:"Manager",email:"alex@tracforce.com",phone:"+1 (415) 555-0102",joined:"2024-11-01",avatar:"AR",phoneTime:"76:45",noteCount:41,callCount:132,lastActive:"2026-02-24",photo:null},
  {id:"t4",name:"Nina Patel",role:"Asst. Manager",email:"nina@tracforce.com",phone:"+1 (415) 555-0103",joined:"2025-01-10",avatar:"NP",phoneTime:"54:10",noteCount:29,callCount:95,lastActive:"2026-02-24",photo:null},
  {id:"t5",name:"Chris Donovan",role:"Specialist",email:"chris@tracforce.com",phone:"+1 (415) 555-0104",joined:"2025-03-20",avatar:"CD",phoneTime:"38:55",noteCount:18,callCount:67,lastActive:"2026-02-25",photo:null},
  {id:"t6",name:"Maya Lin",role:"Specialist",email:"maya@tracforce.com",phone:"+1 (415) 555-0105",joined:"2025-05-01",avatar:"ML",phoneTime:"42:17",noteCount:22,callCount:74,lastActive:"2026-02-24",photo:null},
];

const CL_INIT=[
  {id:1,name:"Ava Richardson",co:"NovaTech",em:"ava@novatech.io",ph:"+1 (415) 555-0142",st:"Active",lc:"2026-02-24",ti:"Enterprise",photo:null,lead:"Hot",dest:"Main Database",assignedTo:"t2",listTag:null},
  {id:2,name:"Marcus Chen",co:"BlueShift Labs",em:"marcus@blueshift.com",ph:"+1 (212) 555-0198",st:"Active",lc:"2026-02-20",ti:"Pro",photo:null,lead:"Warm",dest:"Inbound Leads",assignedTo:"t4",listTag:null},
  {id:3,name:"Jasmine Okafor",co:"Pinnacle Group",em:"jasmine@pinnacle.co",ph:"+1 (310) 555-0167",st:"Pending",lc:"2026-02-18",ti:"Starter",photo:null,lead:"Cold",dest:"Outbound Leads",assignedTo:null,listTag:"pending"},
  {id:4,name:"Derek Holloway",co:"Streamline Inc",em:"derek@streamline.io",ph:"+1 (503) 555-0133",st:"Active",lc:"2026-02-22",ti:"Enterprise",photo:null,lead:"Hot",dest:"Main Database",assignedTo:"t3",listTag:null},
  {id:5,name:"Lina Petrova",co:"Axis Digital",em:"lina@axisdigital.com",ph:"+1 (617) 555-0185",st:"Inactive",lc:"2026-01-30",ti:"Pro",photo:null,lead:"Cold",dest:"Event Contacts",assignedTo:"t5",listTag:"sold"},
  {id:6,name:"Samuel Graves",co:"Redpoint Ventures",em:"sam@redpoint.vc",ph:"+1 (650) 555-0121",st:"Active",lc:"2026-02-25",ti:"Enterprise",photo:null,lead:"Warm",dest:"Partner Referrals",assignedTo:"t2",listTag:null},
];

const NT_INIT={1:[
  {id:1,d:"2026-02-25",a:"Sarah M.",aRole:"Master",t:"Follow-up call confirmed for March 3rd. Client wants to discuss expanded licensing."},
  {id:2,d:"2026-02-24",a:"James K.",aRole:"Admin",t:"Discussed Q1 renewal. Client interested in upgrading to Enterprise Plus tier."},
  {id:3,d:"2026-02-23",a:"Sarah M.",aRole:"Master",t:"Client requested a detailed breakdown of API usage for January and February."},
  {id:4,d:"2026-02-22",a:"Alex R.",aRole:"Manager",t:"Resolved billing discrepancy — credited $142 for duplicate charge in January."},
  {id:5,d:"2026-02-21",a:"Nina P.",aRole:"Asst. Manager",t:"Onboarding session completed for 3 new team members on the client side."},
  {id:6,d:"2026-02-20",a:"James K.",aRole:"Admin",t:"SSO integration finalized. Client confirmed all users can now authenticate."},
  {id:7,d:"2026-02-19",a:"Chris D.",aRole:"Specialist",t:"Sent updated documentation for webhook configurations per client request."},
  {id:8,d:"2026-02-18",a:"Sarah M.",aRole:"Master",t:"Quarterly business review — client reporting 40% efficiency gains since adoption."},
  {id:9,d:"2026-02-17",a:"Alex R.",aRole:"Manager",t:"Client flagged a UI bug in the reporting dashboard. Escalated to engineering."},
  {id:10,d:"2026-02-16",a:"Maya L.",aRole:"Specialist",t:"Provided training walkthrough for the new analytics module. Client very receptive."},
  {id:11,d:"2026-02-15",a:"James K.",aRole:"Admin",t:"Security audit completed. All endpoints meet compliance requirements."},
  {id:12,d:"2026-02-14",a:"Nina P.",aRole:"Asst. Manager",t:"Client asked about multi-region deployment options. Sent pricing sheet."},
  {id:13,d:"2026-02-13",a:"Sarah M.",aRole:"Master",t:"Executive sync with client CEO. Very positive — exploring strategic partnership."},
  {id:14,d:"2026-02-12",a:"Chris D.",aRole:"Specialist",t:"Helped client configure custom alert thresholds for their monitoring setup."},
  {id:15,d:"2026-02-11",a:"Alex R.",aRole:"Manager",t:"Client reported intermittent latency issues. Opened ticket with infrastructure team."},
  {id:16,d:"2026-02-10",a:"James K.",aRole:"Admin",t:"Onboarding completed for initial rollout. Client satisfied with the process."},
  {id:17,d:"2026-02-09",a:"Sarah M.",aRole:"Master",t:"Negotiated 2-year contract extension. Pending legal review on both sides."},
  {id:18,d:"2026-02-08",a:"Maya L.",aRole:"Specialist",t:"Delivered custom report template per client specifications. Approved on first pass."},
  {id:19,d:"2026-02-07",a:"Nina P.",aRole:"Asst. Manager",t:"Client requested dedicated Slack channel for support. Set up #novatech-support."},
  {id:20,d:"2026-02-06",a:"Alex R.",aRole:"Manager",t:"Reviewed client's feature request backlog. Prioritized top 5 for Q2 roadmap."},
  {id:21,d:"2026-02-05",a:"James K.",aRole:"Admin",t:"Initial discovery call. Mapped out client pain points and integration requirements."},
  {id:22,d:"2026-02-04",a:"Sarah M.",aRole:"Master",t:"First contact with NovaTech. Intro meeting went well — strong product fit identified."}
],2:[{id:1,d:"2026-02-20",a:"Sarah M.",aRole:"Master",t:"Technical support resolved. SSO integration help needed."}],3:[{id:1,d:"2026-02-18",a:"James K.",aRole:"Admin",t:"Discovery call. Interested in analytics. Sending proposal EOW."}],4:[{id:1,d:"2026-02-22",a:"Sarah M.",aRole:"Master",t:"Quarterly review done. 40% efficiency gain reported."},{id:2,d:"2026-02-01",a:"Alex R.",aRole:"Manager",t:"Billing inquiry resolved — duplicate charge from Jan."}],5:[],6:[{id:1,d:"2026-02-25",a:"James K.",aRole:"Admin",t:"Partnership discussion. Co-marketing opportunities for Q2."}]};

const CALLS_INIT={1:[{id:1,d:"2026-02-24",dur:"12:34",ty:"Outbound",ag:"Sarah M.",rc:true},{id:2,d:"2026-02-10",dur:"28:15",ty:"Inbound",ag:"James K.",rc:true},{id:3,d:"2026-01-28",dur:"5:02",ty:"Outbound",ag:"Sarah M.",rc:false}],2:[{id:1,d:"2026-02-20",dur:"18:47",ty:"Inbound",ag:"Sarah M.",rc:true}],3:[{id:1,d:"2026-02-18",dur:"32:10",ty:"Outbound",ag:"James K.",rc:true}],4:[{id:1,d:"2026-02-22",dur:"45:22",ty:"Outbound",ag:"Sarah M.",rc:true},{id:2,d:"2026-02-01",dur:"8:15",ty:"Inbound",ag:"Alex R.",rc:true}],5:[],6:[{id:1,d:"2026-02-25",dur:"22:08",ty:"Outbound",ag:"James K.",rc:true}]};
const SALES_INIT={1:[{id:1,d:"2026-02-24",amt:12500,product:"Enterprise Plan",ag:"Sarah M.",quality:"Premium",saleType:"New Business",netProfit:8750,grossProfit:11250,recurring:true,recurringFreq:"monthly",recurringAmt:12500}],4:[{id:1,d:"2026-02-15",amt:8700,product:"Pro Upgrade",ag:"Sarah M.",quality:"Standard",saleType:"Upsell",netProfit:5220,grossProfit:7400,recurring:false,recurringFreq:"",recurringAmt:0},{id:2,d:"2026-01-20",amt:3200,product:"Add-on Package",ag:"Alex R.",quality:"Basic",saleType:"Cross-sell",netProfit:1600,grossProfit:2560,recurring:true,recurringFreq:"quarterly",recurringAmt:3200}],6:[{id:1,d:"2026-02-25",amt:24000,product:"Annual Contract",ag:"James K.",quality:"Premium",saleType:"Renewal",netProfit:16800,grossProfit:21600,recurring:true,recurringFreq:"annually",recurringAmt:24000}]};

/* ── procedural generation: 100 extra clients across 5 years ── */
(()=>{
  const _sr=s=>{let h=s;return()=>{h=Math.imul(h^(h>>>16),0x45d9f3b);h=Math.imul(h^(h>>>13),0x45d9f3b);return((h^(h>>>16))>>>0)/4294967296;};};
  const _rd=(seed,moBack)=>{const r=_sr(seed);const d=new Date(2026,1,25);d.setMonth(d.getMonth()-Math.floor(r()*moBack));d.setDate(1+Math.floor(r()*28));return d.toISOString().slice(0,10);};
  const XNAMES=["Granite Systems","Horizon Labs","Iron Peak","Jade Networks","Kite Digital","Lunar Software","Metro Analytics","Nova Energy","Orbit Cloud","Prism AI","Quartz Data","Ridge Cyber","Summit Health","Titan Robotics","Unity Space","Vertex Bio","Wave Fintech","Xenon Media","Yield Ops","Zenith Corp","Amber Tech","Bolt Electric","Cedar Logic","Dune Consulting","Edge Computing","Fuse Networks","Globe Dynamics","Harbor Systems","Isle Analytics","Jetstream AI","Kelp Biotech","Latch Security","Maple Ventures","Nexus Cloud","Onyx Solutions","Pine Digital","Quasar Labs","Reef Computing","Sage Platforms","Terra Software","Urban Data","Vibe Analytics","Wolf Systems","Xcel Engineering","Yarrow Health","Zinc Industrial","Astra Finance","Blueprint Tech","Coral Design","Dawn Robotics","Elm Sciences","Flare Marketing","Glyph Studios","Halo Networks","Indigo Research","Jewel Payments","Karma Social","Lens Imaging","Moss Environmental","Neon Gaming","Opal Insurance","Plume Aviation","Quest Education","Relay Logistics","Spark Crypto","Tidal Shipping","Umbra Defense","Vale Agriculture","Wren Publishing","Axle Motors","Bloom Gardens","Crest Dental","Drift Travel","Echo Point","Fern Wellness","Grain Foods","Haven Real Estate","Ivy Legal","Jade Mountain","Keel Marine","Lake Hospitality","Mesa Mining","Nest Smart Home","Oak Furniture","Pearl Cosmetics","Quill Writing","Rain Apparel","Stone Architecture","Trail Outdoor","Uptown Retail","Veil Fashion","Wind Turbines","Xylo Music","Yonder Maps","Zinc Alloys","Acorn Farms","Bolt Lightning","Canyon Tours","Dew Beverages","Atlas Consulting","Birch Analytics","Cobalt Systems","Delta Networks","Ember Solutions","Forge Capital","Glacier Tech","Hawk Aerospace","Inlet Marine","Jupiter Labs","Kodiak Software","Lynx Security","Mantis Robotics","Nimbus Cloud","Obsidian Data","Pixel Creative","Quantum Edge","Raptor Dynamics","Sierra Ventures","Topaz Medical","Umber Logistics","Volt Energy","Willow Health","Xenith Finance","Yucca Solar","Zephyr Aviation","Alpine Digital","Basalt Mining","Cirrus Weather","Dolomite Construction","Ember Phoenix","Falcon Defense","Garnet Jewelers","Helix Genomics","Iris Optics","Jasper Materials","Kinetic Sports","Laurel Beauty","Monarch Travel","Neptune Aquatics","Orchid Wellness","Pyrite Analytics","Redwood Timber","Sapphire Hotels","Tundra Climate","Utopia Design","Velvet Media","Walrus Shipping","Xypher Gaming","Yeti Outdoors","Zodiac Astro"];
  const XTIERS=["Enterprise","Pro","Starter","Enterprise"];
  const XSTATS=["Active","Active","Active","Pending","Inactive"];
  const XLEADS=["Hot","Warm","Cold","Hot","Warm","DNC","Cold","Warm"];
  const XDESTS=["Main Database","Inbound Leads","Outbound Leads","Event Contacts","Partner Referrals"];
  const XLISTTAGS=[null,null,null,null,"new","new",null,"pending","past","sold",null,null,"cancelled",null,null];
  const XAGS=["Sarah M.","James K.","Alex R.","Nina P.","Chris D.","Maya L."];
  const XAROLES=["Master","Admin","Manager","Asst. Manager","Specialist","Specialist"];
  const XNTX=["Follow-up completed","Quarterly review done","Contract discussion","Demo scheduled","Pricing sent","Requirements gathered","Onboarding started","Support escalation resolved","Renewal proposed","Expansion opportunity identified","Budget approved","Technical review","Strategy session","Training completed","Integration planning"];
  const XCOUT=["Discussed roadmap","Pricing review","Check-in call","Renewal talk","Support follow-up","Intro call","Upsell discussion","Tech walkthrough","Quarterly sync","Budget planning"];
  for(let i=0;i<150;i++){
    const seed=i*7+42,r=_sr(seed),id=i+7;
    CL_INIT.push({id,name:XNAMES[i],co:XNAMES[i].split(" ")[0]+" Corp",em:XNAMES[i].toLowerCase().replace(/\s/g,"")+"@mail.io",ph:`+1 (555) ${String(1000+i)}`,st:XSTATS[Math.floor(r()*XSTATS.length)],lc:_rd(seed,60),ti:XTIERS[Math.floor(r()*XTIERS.length)],photo:null,lead:XLEADS[Math.floor(r()*XLEADS.length)],dest:XDESTS[Math.floor(r()*XDESTS.length)],assignedTo:null,listTag:XLISTTAGS[Math.floor(r()*XLISTTAGS.length)]});
    const nArr=[],cArr=[];
    const nc=2+Math.floor(r()*7);
    for(let j=0;j<nc;j++){const ai=Math.floor(_sr(seed+j+1)()*6);nArr.push({id:j+1,d:_rd(seed+j*13,60),a:XAGS[ai],aRole:XAROLES[ai],t:XNTX[Math.floor(_sr(seed+j*3)()*XNTX.length)]});}
    const cc=1+Math.floor(r()*5);
    for(let j=0;j<cc;j++){const ai=Math.floor(_sr(seed+j+50)()*6);cArr.push({id:j+1,d:_rd(seed+j*17,60),dur:String(5+Math.floor(_sr(seed+j*7)()*25))+":"+String(10+Math.floor(_sr(seed+j*9)()*50)).padStart(2,"0"),ty:_sr(seed+j*11)()>0.5?"Outbound":"Inbound",ag:XAGS[ai],rc:_sr(seed+j*9)()>0.15});}
    NT_INIT[id]=nArr;
    CALLS_INIT[id]=cArr;
    const XPRODS=["Enterprise Plan","Pro Upgrade","Starter Package","Add-on Bundle","Annual Contract","Consulting","Training","Support Tier"];
    const XQUAL=["Premium","Standard","Basic","Enterprise","Custom"];
    const XSTYPE=["New Business","Upsell","Cross-sell","Renewal","Referral","Inbound"];
    const sArr=[];
    if(r()>0.7){const sc=1+Math.floor(r()*3);for(let j=0;j<sc;j++){const ai=Math.floor(_sr(seed+j+80)()*6);const baseAmt=Math.round((500+_sr(seed+j+90)()*24500)*100)/100;const grossP=Math.round(baseAmt*(_sr(seed+j+91)()*0.3+0.6)*100)/100;const netP=Math.round(grossP*(_sr(seed+j+92)()*0.3+0.4)*100)/100;const isRec=_sr(seed+j+98)()>0.6;const freqs=["monthly","quarterly","annually"];sArr.push({id:j+1,d:_rd(seed+j*19,60),amt:baseAmt,product:XPRODS[Math.floor(_sr(seed+j+95)()*XPRODS.length)],ag:XAGS[ai],quality:XQUAL[Math.floor(_sr(seed+j+96)()*XQUAL.length)],saleType:XSTYPE[Math.floor(_sr(seed+j+97)()*XSTYPE.length)],netProfit:netP,grossProfit:grossP,recurring:isRec,recurringFreq:isRec?freqs[Math.floor(_sr(seed+j+99)()*3)]:"",recurringAmt:isRec?baseAmt:0});}}
    SALES_INIT[id]=sArr;
    // Assign client to team member who made last contact
    const XTIDS=["t1","t2","t3","t4","t5","t6"];
    const allContacts=[...nArr.map(n=>({d:n.d,ag:n.a})),...cArr.map(c=>({d:c.d,ag:c.ag}))];
    allContacts.sort((a,b)=>b.d.localeCompare(a.d));
    const lastAg=allContacts.length?allContacts[0].ag:XAGS[Math.floor(r()*6)];
    const agIdx=XAGS.indexOf(lastAg);
    CL_INIT[CL_INIT.length-1].assignedTo=XTIDS[agIdx>=0?agIdx:0];
    CL_INIT[CL_INIT.length-1].lc=allContacts.length?allContacts[0].d:CL_INIT[CL_INIT.length-1].lc;
  }
})();

/* ══════════════════════════════════════════════════════════
   §4 — ICON COMPONENT & UTILITY FUNCTIONS
   Standalone: Icons.jsx + utils.js — depends on: React
   ══════════════════════════════════════════════════════════ */
const Ic=({t,s=18})=>{const p={width:s,height:s,strokeWidth:1.8,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"};return({
  users:<svg viewBox="0 0 24 24" style={p}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
  phone:<svg viewBox="0 0 24 24" style={p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.12 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.13.96.36 1.9.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.91.34 1.85.57 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
  note:<svg viewBox="0 0 24 24" style={p}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
  play:<svg viewBox="0 0 24 24" style={p}><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16" fill="currentColor" stroke="none"/></svg>,
  search:<svg viewBox="0 0 24 24" style={p}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
  chev:<svg viewBox="0 0 24 24" style={p}><polyline points="9 18 15 12 9 6"/></svg>,
  home:<svg viewBox="0 0 24 24" style={p}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
  gear:<svg viewBox="0 0 24 24" style={p}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
  x:<svg viewBox="0 0 24 24" style={p}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
  mic:<svg viewBox="0 0 24 24" style={p}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/></svg>,
  shield:<svg viewBox="0 0 24 24" style={p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
  paw:<svg viewBox="0 0 100 100" style={{width:s,height:s}}><ellipse cx="50" cy="62" rx="22" ry="17" fill="currentColor"/><ellipse cx="22" cy="44" rx="9" ry="12" fill="currentColor"/><ellipse cx="38" cy="26" rx="9" ry="12" fill="currentColor"/><ellipse cx="62" cy="26" rx="9" ry="12" fill="currentColor"/><ellipse cx="78" cy="44" rx="9" ry="12" fill="currentColor"/></svg>,
  link:<svg viewBox="0 0 24 24" style={p}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
  team:<svg viewBox="0 0 24 24" style={p}><path d="M12 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10z"/><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/></svg>,
  clock:<svg viewBox="0 0 24 24" style={p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
  key:<svg viewBox="0 0 24 24" style={p}><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.78 7.78 5.5 5.5 0 0 1 7.78-7.78zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>,
  trash:<svg viewBox="0 0 24 24" style={p}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
  edit:<svg viewBox="0 0 24 24" style={p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
  log:<svg viewBox="0 0 24 24" style={p}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>,
  dollar:<svg viewBox="0 0 24 24" style={p}><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
  camera:<svg viewBox="0 0 24 24" style={p}><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>,
  post:<svg viewBox="0 0 24 24" style={p}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
  check:<svg viewBox="0 0 24 24" style={p}><polyline points="20 6 9 17 4 12"/></svg>,
  signal:<svg viewBox="0 0 24 24" style={p}><path d="M2 20h.01"/><path d="M7 20v-4"/><path d="M12 20v-8"/><path d="M17 20V8"/><path d="M22 4v16"/></svg>,
  save:<svg viewBox="0 0 24 24" style={p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
  flame:<svg viewBox="0 0 24 24" style={p}><path d="M12 12c2-2.96 0-7-1-8 0 3.04-4 6.47-4 9.5C7 17.09 9.24 19 12 19c2.76 0 5-1.91 5-5.5 0-1.73-.57-3.18-1-4C15.27 11.33 14 12.5 12 12z"/></svg>,
  upload:<svg viewBox="0 0 24 24" style={p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
  download:<svg viewBox="0 0 24 24" style={p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
  plus:<svg viewBox="0 0 24 24" style={p}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
  db:<svg viewBox="0 0 24 24" style={p}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
  assign:<svg viewBox="0 0 24 24" style={p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>,
  activity:<svg viewBox="0 0 24 24" style={p}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
  email:<svg viewBox="0 0 24 24" style={p}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>,
  target:<svg viewBox="0 0 24 24" style={p}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
  arrowUp:<svg viewBox="0 0 24 24" style={p}><polyline points="18 15 12 9 6 15"/></svg>,
  arrowDown:<svg viewBox="0 0 24 24" style={p}><polyline points="6 9 12 15 18 9"/></svg>,
})[t]||null;};

const roleBg=r=>({Master:"#1a1a2e",Admin:"#3b5bdb",Manager:"#7c3aed","Asst. Manager":"#0891b2",Specialist:"#059669",Client:"#94a3b8"})[r]||"#94a3b8";
const stColor=s=>s==="Active"?"#22c55e":s==="Pending"?"#f59e0b":"#94a3b8";
const leadColor=l=>l==="Hot"?"#ef4444":l==="Warm"?"#f59e0b":l==="DNC"?"#7c3aed":"#64748b";
const leadBg=l=>l==="Hot"?"#fef2f2":l==="Warm"?"#fffbeb":l==="DNC"?"#f5f3ff":"#f8fafc";
const tBg=t=>t==="Enterprise"?"#f0f4ff":t==="Pro"?"#f0fdf4":"#fffbeb";
const tC=t=>t==="Enterprise"?"#3b5bdb":t==="Pro"?"#16a34a":"#d97706";
const ini=n=>n.split(" ").map(x=>x[0]).join("");
const fmtSec=s=>`${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;

const FRENCHIE_IMG="data:image/png;base64,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GGROp5OIokhNfXZPtsThcEAQRLJ7d43v1FNPp3//+98f3LevjjjsDr569UZOKeXhSFgIBL5Kqqycn3TvPX+/cfCQIWsHDR90w8IFC6edcMLUM48//vhzOjo6+m/btu2Mpqamk9xud6ChoYE6HA6bqqqghJIklxNutzuUkpq0Ii+v8Imbbrrph9dem/2XTz755LGOjo6LH3744bbrrrtOOIQLwARB4D6f75Ls7Oy/96wSiV97DgANDQ2T6+rqut97772v+thhhTiVyf/A7aXxczgtOzubWSzS9z+vXfVAR0fnluuvv6luw4YN7p9++unlgoKCJwghxq233jpCVdXdvwfQpvth6g0QX619APJXBpv09OeqqqBXVVXgv+IoKysDIST6xhtvzPjwww+/8Hq9qbquIykpyZeWlsZ8Xp+bUIKUtFSEQkHu9wcYJUSQJAkWi4UrimIIgkAkSSK6rpNIJMIAcMMwREIITU9PrZ88efKd5eXlHx5kNyHxa0JkWc5ljPF4N35uVrFwzomp09Y0DTabzZqWluFfunTp8V1dXWJ2drZuszlEuyPm53d5uhDw+3hHVycW/bhYHz1q9ITubt9HN95449DKyg/bPB7vuTNmzJgB4I13333358LCwuFDhw59/a233ppjs9mGqqFQ2ylnnKHu2rH9+oGDh8wYNmxY+mWX/eXdZcuWXvTTTz+9MWvWrPdMluAgOQihoqLCuOOOO06NRCJNTz311GLTYvbskMQ5V7788svjPB7P64wxctNNN8kpKSnGiBEjeElJCYun9f/QfTWDPUVRprW1tdFhQwef6PMHMkePHvspAL5q1aozw+Hw/rPOOmuTIAhwuVwnMsYqRPxrDv5f3Vuu5yIrKyujV1999Yrq6urJTz/99GWBQCD57LPPfrl///6+55577tmGhoapHLCkpqQq6ekZQmdHB9c0rZtSmhyJRERT5B+XiwrxKVTVJ5xwwtv33Xffq4SQTgAHc424me7+61//+kEkErk3rjdIcOBxK811QzcikYjodrk948ePf3Pz5s3ZVkW5Y+/eWiIrImRJRvv2NtisNriTkwkVBcMiUMnC+M0NDY0sHI7+ubT0gtc+/fRT/e15b1aNGTe+9OKLLz5+3rx597jd7ttvu+22+Z9++nHuuedOf2/hws+yA0F/od1qfbOurvbM6upqfPHFFx++8sqs69ra2oT58+cbB5szmJycTAkhRiQSuXnAgAF39G6BHPefWWtr69i6ujpqt9sfi3PM2sGqw//oYbPZlv7888/TGvfvz87Pz8fOXTufra/dc+z+pqajVqxYuY1zPnHBggVXrl69yvnQQw+vIfjfc/TZQV1RFHz++ecZK1asUAYPHlyQlJSU5PP5as8888y2hx9+eGx3d/fF+/fvzzcMY7AsyxZK6dYxY8ZUVlRUvEEIiZoW61CukRnwzJ8/P8vhcEz+6KOPbgoEAqP27t0r+v1+h81mgyCKsb53hoF+BQXbv/rmm+Gc82NefuH5FQ8/+qRhc1gFiyTB092NzIwMEEmCJAjGTZdfJpx88omf61bhHarYd2anZm9hjLm//XbBdZ2dnjGECPddfPHFNUuWLLknNTV1Q0NDw8CVK1e+NH78mNMLC/t9KcsKFixYYOzcufPBN9+c96Bh6CSepDmYGyAC0G+66aZbCSEZzz///N3nnXfeAZ/fZDc++eSTv9bU1PzlrrvumvxHYqHD8aMfeughduedd54YjapzZUmU29raks4992xLR0c7avbubc7JylVCoWD72LHjLz355JNX/28CNHr7+HEL/ptUUVxbYQMgKoriM92DoqIiMV4x8bt8QM65BYBj165dyjfffJOcmpoqWywWsaGpqdAwVMlmka86atKxHYYarcvNzJh50023Oav31BBRFGGzWOEPBpCVk4WTp5zAp596MskpzN69t6O9JuALFAV9gQa702kZMXLI1CVLVouEkDK73f71tGnT3u8p6G9sbLxo794973711ddLANz5+OOPr4rXJPKDfR4TQA888MDFkUjkaovFckZFRUWoh7Eg8VhKrKio0N98840XW1vbHXfdddcVZWVlQkVFhf7/ylA1NjbaLBaL2NjY6Fq8eHGm2+0OXXrppbVXXXWVOG/ePH9cp0LE/02A7u3j91KCEbO537Zt27gZ0FZWViJe4hQyL2BRUZEQB7L+e1yl+P8R4pY9Gv91Y4+nrK6sfH9aS0uzLT0tfR7TtWM8He10+jln8z0vvEDCkQgskgWpycmYOGYsBvbrx20OO8IR1Ttm1ISLGxv3ZUS94fys3AzP7rqGMbm5uQ2TJk26ZM2aNelx+o7PmTNHaGpqMpYvXz5q7dq165988skic3FWVVUd9POYPvI999zzsiiKwy688MJ5Y8aMCe3YsaP/0KFD9/Wk3SoqKnh8Cu04r9e74Pdyy7/XXS0rK6O5MW0PAPgA7AeAyy677FfA/18F6EOV8fS+6L0DWrNFACGEH+rGH8b/0c33MtuqVVdXk+uuu444nU6yfv36zs5OT8hhU45u2N9+bpLTRY8cNQq3XHU1PvzkMxgSwaTRo2Gzykh1OwjhHJIoZdfu2/1qKBw5prOrY0u7v5t3dHTmuN0pl/3www/i+PHj281zmD17tlBRUcFuueWW4cnJyQ/GwSpXVFSohxCiCRUVFcb999//fFdX185+/fpta2pqUmbPnl2yfPnyYs75DfHki6W2tpb069cvCsD6+uuvj6aUvvCvMFQ9r+mIESNIXGlntopIaKb/vwD07wDjf/V78R5pYkII4WvXrt3X0tLIPZ0dqz3d3VtdOY57LQ776DNPP4WFohG6ZutGTD7qSORnpiOiRiHwKHzdHazfqAl37d1bM86d7J5MgTWjR4+q3bevYdT8+fM3mzd7zpw54syZM7XFixef9dVXXxVMmTLlq7jlVX+D7zX++c9/HuHxeIY//PDDcx9//PFbr7nmmucfe+yxN4cNG3YmAPqPf/wj6aWXXrp78uTJTxFC2vx+/7GMMUdXV9fK3pTe/+P7w3+L6/vP8S9aMPEKZa8sW1off/rJxtzcgs1dft8PNpfrOwg00NzSou/Ztw8bNm+BxxeARVaIv9sLmyjkdbc1vNsd8I63SJYlPl+4oKpq+azm5uak8vJyYc6cOSIhhM+cOVPjnJ9SXV39hcVieWjq1Kn6wRq59MaA2+0+QZbllFdeeeWtcePGNX755Zd/drvdm88999xaQoihqurF0WjUO3bs2DZCCOrr6x+ur6+vfuWVV+p6U3r/ncd/AP0vPMrLy7mu6zQzM/uh7Jy813bt2tWRn5O9ONWdMvDdDz92LVq+goCIxrwPPuJlTz7Hf964lTuS0pgsWVU1EvlMN5jQ1dV9i9fjGaFp2g0nnnjiiz/88IMtDmTnDz8s+uezzz73ZUtLy20PP/zwJ4fJPDAAGD169Iq6urpx27dvH1lTU3NzY2PjjYIgTPv222/P5JxfNm7cuIrGxsbpGzZsOMPj8bzV0NBw9M6dOx/jnOMwFs2/lOr6z/EvZmIqKirYLXfcck6y0/3oicVTc4I+v/ur777bUVBQMDQ7OzvWCBIcIZ8XAjhOOekkFA4ZcrMgWV7sLY4XRREff/zpZXv37C3z+rzBhobmi19//ZXNv4dGKysrow8++CB7+umnH9u1a9dRFovlhCOOOAJbt27F2WefjWHDhmHFihX4/vvvcc455yAajaKqqurF2bNn31xeXo5/F+v8H0D/Nx8ff/zxyNU/rz6KCMT/2GOPfT9r1qwzvF7vjQ67bQghnEiyjB07dpPu7s6OiRMnDCgs6AeLrDQTgW4NhUJru7u79YaGxpO6uz31LpfztQceeOD7+LiHP8IJx1gCUcScOXNOYIw5qqurB7tcrsxQKEQyMzMjTU1NnpaWlr0FBQXdTz755CLDMMjh+LX/AfT/8uPJJ588gkrSBKctbcnMmZc09/77JZdckvrZ22/DD+Dpp2eT22+f4b/66ksH5GTlnU9FYXIkErVYLFYqSVIrpfSte++99zPzfsYFRH/UYlIcvsST/DsB+T+A/m9yNx588EE2d+7cGc3NLcWDBg1e6/F0doZCodabbrrp+7i21/gDQCElJSX0vypTZ7b4eumll0jP/htmT+brr7+eH2xc8X8A/f/x0dTUlP7EE088JUlSw1NPPfVgvND0YAElAUBN0Q4QG7zz7wyu/47j/wAgvzUCAM01UwAAAABJRU5ErkJggg==";

/* ══════════════════════════════════════════════════════════
   §5 — CALENDAR PICKER COMPONENT
   Standalone: CalendarPicker.jsx — depends on: React, §4
   ══════════════════════════════════════════════════════════ */

const RANGE_OPTS=[{k:"1d",l:"Last 1 Day"},{k:"5d",l:"Last 5 Days"},{k:"15d",l:"Last 15 Days"},{k:"1m",l:"Last 1 Month"},{k:"3m",l:"Last 3 Months"},{k:"6m",l:"Last 6 Months"},{k:"1y",l:"Last 1 Year"},{k:"5y",l:"Last 5 Years"},{k:"all",l:"All Time"},{k:"custom",l:"Choose Dates..."}];
const daysInMonth=(y,m)=>new Date(y,m+1,0).getDate();
const fmtD=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
const parseD=s=>{const p=s.split("-");return p.length===3?new Date(+p[0],+p[1]-1,+p[2]):null;};

const CalendarPicker=({value,onChange,label})=>{
  const [open,setOpen]=useState(false);
  const [input,setInput]=useState(value||"");
  const cur=parseD(value)||new Date(2026,1,25);
  const [vY,setVY]=useState(cur.getFullYear());
  const [vM,setVM]=useState(cur.getMonth());
  const days=daysInMonth(vY,vM);
  const firstDay=new Date(vY,vM,1).getDay();
  const mNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const prevM=()=>{if(vM===0){setVM(11);setVY(vY-1);}else setVM(vM-1);};
  const nextM=()=>{if(vM===11){setVM(0);setVY(vY+1);}else setVM(vM+1);};
  const pick=(d)=>{const v=`${vY}-${String(vM+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;setInput(v);onChange(v);setOpen(false);};
  const handleInput=(e)=>{const v=e.target.value;setInput(v);if(/^\d{4}-\d{2}-\d{2}$/.test(v)){const p=parseD(v);if(p&&!isNaN(p)){onChange(v);setVY(p.getFullYear());setVM(p.getMonth());}}};
  const selD=parseD(value);
  return <div style={{position:"relative"}}>
    <div style={{fontSize:9.5,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,marginBottom:4}}>{label}</div>
    <div style={{display:"flex",alignItems:"center",gap:6}}>
      <input value={input} onChange={handleInput} placeholder="YYYY-MM-DD" style={{width:110,padding:"6px 10px",borderRadius:6,border:"1px solid #e2e5ea",fontSize:12,fontFamily:"inherit",outline:"none",background:"#fff",color:"#1a1a2e"}}/>
      <button onClick={()=>setOpen(!open)} style={{width:30,height:30,borderRadius:6,border:"1px solid #e2e5ea",background:open?"#f0f4ff":"#fff",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:open?"#3b5bdb":"#64748b",flexShrink:0}}><Ic t="clock" s={13}/></button>
    </div>
    {open&&<div style={{position:"absolute",top:"100%",left:0,marginTop:6,background:"#fff",borderRadius:10,border:"1px solid #e2e5ea",boxShadow:"0 8px 24px rgba(0,0,0,0.15)",padding:12,zIndex:9999,width:240}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10}}>
        <button onClick={prevM} style={{border:"none",background:"none",cursor:"pointer",color:"#64748b",fontSize:14,padding:"2px 6px",borderRadius:4,fontFamily:"inherit"}} onMouseEnter={e=>e.currentTarget.style.background="#f0f2f5"} onMouseLeave={e=>e.currentTarget.style.background="none"}>‹</button>
        <span style={{fontSize:12.5,fontWeight:700}}>{mNames[vM]} {vY}</span>
        <button onClick={nextM} style={{border:"none",background:"none",cursor:"pointer",color:"#64748b",fontSize:14,padding:"2px 6px",borderRadius:4,fontFamily:"inherit"}} onMouseEnter={e=>e.currentTarget.style.background="#f0f2f5"} onMouseLeave={e=>e.currentTarget.style.background="none"}>›</button>
      </div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,textAlign:"center",marginBottom:4}}>
        {["Su","Mo","Tu","We","Th","Fr","Sa"].map(d=><div key={d} style={{fontSize:9,fontWeight:600,color:"#94a3b8",padding:"4px 0"}}>{d}</div>)}
      </div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,textAlign:"center"}}>
        {Array.from({length:firstDay},(_,i)=><div key={"e"+i}/>)}
        {Array.from({length:days},(_,i)=>{
          const d=i+1;const isSel=selD&&selD.getFullYear()===vY&&selD.getMonth()===vM&&selD.getDate()===d;
          return <button key={d} onClick={()=>pick(d)} style={{width:28,height:28,borderRadius:"50%",border:"none",background:isSel?"#3b5bdb":"transparent",color:isSel?"#fff":"#374151",fontSize:11.5,fontWeight:isSel?700:400,cursor:"pointer",fontFamily:"inherit",transition:"all 0.1s"}} onMouseEnter={e=>{if(!isSel)e.currentTarget.style.background="#f0f4ff"}} onMouseLeave={e=>{if(!isSel)e.currentTarget.style.background="transparent"}}>{d}</button>;
        })}
      </div>
    </div>}
  </div>;
};

/* ══════════════════════════════════════════════════════════
   §6 — ENGAGEMENT SECTION COMPONENT
   Standalone: EngagementSection.jsx
   Depends on: React, §2, §4, §5
   ══════════════════════════════════════════════════════════ */
const EngagementSection=({clients,nts,cls,sales,team,Card,Avatar,setSel,setSec,setTab})=>{
  const [lbRange,setLbRange]=useState("all");
  const [lbDropOpen,setLbDropOpen]=useState(false);
  const [customFrom,setCustomFrom]=useState("2026-01-01");
  const [customTo,setCustomTo]=useState("2026-02-25");
  const [showCustom,setShowCustom]=useState(false);
  const [graphMode,setGraphMode]=useState("all");
  const dropBtnRef=useRef(null);
  const [dropPos,setDropPos]=useState({top:0,left:0});

  const TC={call:"#3b5bdb",note:"#7c3aed",email:"#0891b2",sale:"#059669"};
  const TBG={call:"#f0f4ff",note:"#f5f0ff",email:"#f0fafe",sale:"#f0fdf4"};
  const TIC={call:"phone",note:"note",email:"email",sale:"dollar"};

  // Date filter helper
  const now=new Date(2026,1,25);
  const rangeStart=(r)=>{
    if(r==="1d")return new Date(now.getTime()-1*864e5);
    if(r==="5d")return new Date(now.getTime()-5*864e5);
    if(r==="15d")return new Date(now.getTime()-15*864e5);
    if(r==="1m")return new Date(now.getFullYear(),now.getMonth()-1,now.getDate());
    if(r==="3m")return new Date(now.getFullYear(),now.getMonth()-3,now.getDate());
    if(r==="6m")return new Date(now.getFullYear(),now.getMonth()-6,now.getDate());
    if(r==="1y")return new Date(now.getFullYear()-1,now.getMonth(),now.getDate());
    if(r==="5y")return new Date(now.getFullYear()-5,now.getMonth(),now.getDate());
    if(r==="custom")return parseD(customFrom)||new Date(2020,0,1);
    return new Date(2020,0,1);
  };
  const rangeEnd=(r)=>r==="custom"?(parseD(customTo)||now):now;
  const inRange=(dateStr)=>{const d=new Date(dateStr);return d>=rangeStart(lbRange)&&d<=rangeEnd(lbRange);};

  // Agent engagement filtered by date range
  const agentEng=team.filter(t=>t.role!=="Client").map(t=>{
    const sn=t.name.split(" ")[0]+" "+t.name.split(" ")[1][0]+".";
    let ac=0,an=0,as=0;
    Object.values(cls).forEach(arr=>arr.forEach(c=>{if(c.ag===sn&&inRange(c.d))ac++;}));
    Object.values(nts).forEach(arr=>arr.forEach(n=>{if(n.a===sn&&inRange(n.d))an++;}));
    Object.values(sales).forEach(arr=>arr.forEach(s=>{if(s.ag===sn&&inRange(s.d))as++;}));
    const ae=Math.max(0,Math.floor((ac+an)*0.6));
    return {...t,ac,an,ae,as,total:ac+an+ae+as};
  }).sort((a,b)=>b.total-a.total);

  // Client + totals use all-time (no filter)
  const clientEng=clients.map(c=>{
    const cn=(nts[c.id]||[]).length;const cc=(cls[c.id]||[]).length;const cs=(sales[c.id]||[]).length;const ce=Math.max(1,Math.floor((cn+cc)*0.7));
    return {...c,cn,cc,cs,ce,total:cn+cc+cs+ce,trend:(cn+cc+cs+ce)>4?"up":"down"};
  }).sort((a,b)=>b.total-a.total);
  const totC=Object.values(cls).reduce((s,a)=>s+a.length,0);
  const totN=Object.values(nts).reduce((s,a)=>s+a.length,0);
  const totS=Object.values(sales).reduce((s,a)=>s+a.length,0);
  const totSAmt=Object.values(sales).reduce((s,a)=>s+a.reduce((ss,x)=>ss+x.amt,0),0);
  const totE=Math.max(1,Math.floor((totC+totN)*0.65));
  const totAll=totC+totN+totE+totS;
  const recent=[];
  Object.entries(nts).forEach(([cid,arr])=>arr.forEach(n=>{const cl=clients.find(x=>x.id===Number(cid));if(cl)recent.push({id:"n"+cid+n.id,type:"note",agent:n.a,client:cl.name,date:n.d,summary:n.t.slice(0,55)+(n.t.length>55?"...":"")});}));
  Object.entries(cls).forEach(([cid,arr])=>arr.forEach(c=>{const cl=clients.find(x=>x.id===Number(cid));if(cl)recent.push({id:"c"+cid+c.id,type:"call",agent:c.ag,client:cl.name,date:c.d,summary:`${c.dur} ${c.ty.toLowerCase()} call`});}));
  Object.entries(sales).forEach(([cid,arr])=>arr.forEach(s=>{const cl=clients.find(x=>x.id===Number(cid));if(cl)recent.push({id:"s"+cid+s.id,type:"sale",agent:s.ag,client:cl.name,date:s.d,summary:`$${s.amt.toLocaleString()} — ${s.product}`});}));
  recent.sort((a,b)=>b.date.localeCompare(a.date));
  const spark=(base,len=7)=>Array.from({length:len},(_,i)=>Math.max(1,Math.round(base*(0.7+Math.sin(i)*0.3))));
  const MiniBar=({data,color})=>{const mx=Math.max(...data,1);return <div style={{display:"flex",alignItems:"flex-end",gap:2,height:32}}>{data.map((v,i)=><div key={i} style={{width:4,height:Math.max(2,(v/mx)*32),background:color,borderRadius:2,opacity:i>=data.length-3?1:0.4}}/>)}</div>;};

  const curLabel=RANGE_OPTS.find(r=>r.k===lbRange)?.l||"All Time";

  return <div>
    <div style={{marginBottom:24}}>
      <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:4}}>
        <div style={{width:32,height:32,borderRadius:8,background:"linear-gradient(135deg, #3b5bdb 0%, #7c3aed 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"}}><Ic t="activity" s={16}/></div>
        <h1 style={{fontSize:22,fontWeight:700,margin:0,letterSpacing:-0.3}}>Engagement</h1>
      </div>
      <p style={{color:"#94a3b8",fontSize:13,margin:"0 0 0 42"}}>Client interaction metrics across calls, notes & emails</p>
    </div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:14,marginBottom:20}}>
      {[["Total Interactions",totAll,"signal","#1a1a2e",spark(Math.round(totAll/7))],["Calls",totC,"phone",TC.call,spark(Math.round(totC/7))],["Notes",totN,"note",TC.note,spark(Math.round(totN/7))],["Sales",totS,"dollar",TC.sale,spark(Math.max(1,Math.round(totS/7)))],["Emails",totE,"email",TC.email,spark(Math.round(totE/7))]].map(([label,val,icon,color,data])=>(
        <Card key={label} style={{padding:"18px 20px",position:"relative",overflow:"hidden"}}>
          <div style={{position:"absolute",top:0,left:0,width:"100%",height:3,background:color}}/>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
            <div>
              <div style={{display:"flex",alignItems:"center",gap:5,marginBottom:6,color:"#94a3b8"}}><Ic t={icon} s={13}/><span style={{fontSize:10.5,fontWeight:600,textTransform:"uppercase",letterSpacing:0.5}}>{label}</span></div>
              <div style={{fontSize:26,fontWeight:700,letterSpacing:-0.5}}>{val}</div>
            </div>
            <MiniBar data={data} color={color}/>
          </div>
        </Card>
      ))}
    </div>
    {/* ── Activity Over Time graph ── */}
    {(()=>{
      const allDates=[];
      Object.values(nts).forEach(arr=>arr.forEach(n=>{if(inRange(n.d))allDates.push({d:n.d,type:"note"});}));
      Object.values(cls).forEach(arr=>arr.forEach(c=>{if(inRange(c.d))allDates.push({d:c.d,type:"call"});}));
      Object.values(sales).forEach(arr=>arr.forEach(s=>{if(inRange(s.d))allDates.push({d:s.d,type:"sale"});}));
      if(allDates.length<2)return <Card style={{marginBottom:20,padding:"24px 20px"}}><div style={{textAlign:"center",color:"#94a3b8",fontSize:13}}>Not enough data for selected range</div></Card>;
      allDates.sort((a,b)=>a.d.localeCompare(b.d));
      const minD=allDates[0].d,maxD=allDates[allDates.length-1].d;
      const diffDays=(new Date(maxD)-new Date(minD))/864e5;
      const bucket=diffDays>365?"month":diffDays>60?"week":"day";
      const bk=dt=>{const dd=new Date(dt);if(bucket==="month")return dd.getFullYear()+"-"+String(dd.getMonth()+1).padStart(2,"0");if(bucket==="week"){const w=new Date(dd);w.setDate(w.getDate()-w.getDay());return w.toISOString().slice(0,10);}return dt;};
      const map={};
      allDates.forEach(a=>{const k=bk(a.d);if(!map[k])map[k]={calls:0,notes:0,emails:0,sales:0};if(a.type==="call")map[k].calls++;else if(a.type==="sale")map[k].sales++;else{map[k].notes++;map[k].emails+=((map[k].notes%3)!==0)?1:0;}});
      const pts=Object.entries(map).sort((a,b)=>a[0].localeCompare(b[0])).map(([k,v])=>({l:k,...v}));
      const gMax=Math.max(...pts.map(d=>Math.max(d.calls,d.notes,d.emails,d.sales)),1);
      const W=Math.max(pts.length*24,800),H=280,PAD=40,PH=200;
      const x=i=>PAD+i*(W-PAD-10)/Math.max(pts.length-1,1);
      const y=(v)=>H-40-v/gMax*PH;
      const TC2={calls:"#3b5bdb",notes:"#7c3aed",emails:"#0891b2",sales:"#059669"};
      const line=(key)=>pts.map((p,i)=>`${x(i)},${y(p[key])}`).join(" ");
      return <Card style={{marginBottom:20,overflow:"visible"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 20px 10px"}}>
          <div style={{display:"flex",alignItems:"center",gap:6}}><Ic t="activity" s={14}/><span style={{fontSize:13,fontWeight:700}}>Activity Over Time</span></div>
          <div style={{display:"flex",gap:5}}>
            {["all","calls","notes","emails","sales"].map(f=><button key={f} onClick={()=>setGraphMode(f)} style={{padding:"4px 10px",borderRadius:6,border:"1px solid "+(graphMode===f?"#3b5bdb":"#e2e5ea"),background:graphMode===f?"#f0f4ff":"#fff",color:graphMode===f?"#3b5bdb":"#94a3b8",fontSize:10.5,fontWeight:graphMode===f?600:400,cursor:"pointer",fontFamily:"inherit"}}>{f.charAt(0).toUpperCase()+f.slice(1)}</button>)}
          </div>
        </div>
        <div style={{height:H,padding:"0 20px 14px",overflow:"hidden"}}>
          <svg width="100%" height="100%" viewBox={`0 0 ${W} ${H}`} style={{overflow:"visible"}}>
            {[0.25,0.5,0.75,1].map(p=><line key={p} x1={PAD} y1={y(gMax*p)} x2={W-10} y2={y(gMax*p)} stroke="#f0f2f5" strokeWidth={1}/>)}
            {[0.25,0.5,0.75,1].map(p=><text key={p} x={PAD-4} y={y(gMax*p)+4} textAnchor="end" fontSize={10} fill="#b2bec3">{Math.round(gMax*p)}</text>)}
            {(graphMode==="all"||graphMode==="calls")&&<><polyline points={line("calls")} fill="none" stroke={TC2.calls} strokeWidth={2}/>{pts.map((p,i)=><circle key={i} cx={x(i)} cy={y(p.calls)} r={3} fill={TC2.calls}/>)}</>}
            {(graphMode==="all"||graphMode==="notes")&&<><polyline points={line("notes")} fill="none" stroke={TC2.notes} strokeWidth={2}/>{pts.map((p,i)=><circle key={i} cx={x(i)} cy={y(p.notes)} r={3} fill={TC2.notes}/>)}</>}
            {(graphMode==="all"||graphMode==="emails")&&<><polyline points={line("emails")} fill="none" stroke={TC2.emails} strokeWidth={2}/>{pts.map((p,i)=><circle key={i} cx={x(i)} cy={y(p.emails)} r={3} fill={TC2.emails}/>)}</>}
            {(graphMode==="all"||graphMode==="sales")&&<><polyline points={line("sales")} fill="none" stroke={TC2.sales} strokeWidth={2}/>{pts.map((p,i)=><circle key={i} cx={x(i)} cy={y(p.sales)} r={3} fill={TC2.sales}/>)}</>}
            {pts.filter((_,i)=>i%(Math.ceil(pts.length/12))===0).map((p,i)=>{const idx=pts.indexOf(p);return <text key={i} x={x(idx)} y={H-8} textAnchor="middle" fontSize={9} fill="#b2bec3">{p.l.length>7?p.l.slice(5):p.l}</text>;})}
          </svg>
        </div>
        <div style={{display:"flex",gap:16,justifyContent:"center",paddingBottom:12}}>
          <span style={{fontSize:11,color:TC2.calls}}>● Calls</span>
          <span style={{fontSize:11,color:TC2.notes}}>● Notes</span>
          <span style={{fontSize:11,color:TC2.emails}}>● Emails</span>
          <span style={{fontSize:11,color:TC2.sales}}>● Sales</span>
        </div>
      </Card>;
    })()}
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,marginBottom:20}}>
      <Card style={{overflow:"hidden",display:"flex",flexDirection:"column"}}>
        <div style={{padding:"14px 20px 10px",borderBottom:"1px solid #f0f2f5",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
          <div style={{fontSize:13,fontWeight:700}}>Recent Activity</div>
          <div style={{display:"flex",alignItems:"center",gap:3,color:"#94a3b8"}}><Ic t="clock" s={12}/><span style={{fontSize:10,fontWeight:500}}>Live</span></div>
        </div>
        <div style={{flex:1,overflowY:"auto",maxHeight:320}}>
          {recent.slice(0,15).map(a=>(
            <div key={a.id} style={{padding:"10px 20px",borderBottom:"1px solid #f8f9fb",display:"flex",gap:10,alignItems:"flex-start"}}>
              <div style={{width:28,height:28,borderRadius:"50%",background:TBG[a.type],display:"flex",alignItems:"center",justifyContent:"center",color:TC[a.type],flexShrink:0,marginTop:1}}><Ic t={TIC[a.type]} s={13}/></div>
              <div style={{flex:1,minWidth:0}}>
                <div style={{fontSize:12,fontWeight:600,marginBottom:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{a.agent} → {a.client.split(" ")[0]}</div>
                <div style={{fontSize:11,color:"#64748b",marginBottom:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{a.summary}</div>
                <div style={{fontSize:10,color:"#94a3b8"}}>{a.date}</div>
              </div>
            </div>
          ))}
        </div>
      </Card>

      {/* Agent Leaderboard with date range dropdown */}
      <Card style={{overflow:"visible",position:"relative"}}>
        <div style={{padding:"14px 20px 10px",borderBottom:"1px solid #f0f2f5",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
          <div style={{display:"flex",alignItems:"center",gap:8}}>
            <Ic t="users" s={14}/><span style={{fontSize:13,fontWeight:700}}>Agent Leaderboard</span>
          </div>
          {/* Date range dropdown */}
          <div style={{position:"relative"}}>
            <button ref={dropBtnRef} onClick={()=>{if(!lbDropOpen&&dropBtnRef.current){const r=dropBtnRef.current.getBoundingClientRect();setDropPos({top:r.bottom+6,left:r.right});}setLbDropOpen(!lbDropOpen);setShowCustom(false);}} style={{display:"flex",alignItems:"center",gap:5,padding:"5px 10px",borderRadius:6,border:"1px solid #e2e5ea",background:lbDropOpen?"#f0f4ff":"#fff",fontSize:11,fontWeight:500,color:lbDropOpen?"#3b5bdb":"#64748b",cursor:"pointer",fontFamily:"inherit",transition:"all 0.15s"}}>
              <Ic t="clock" s={11}/>{curLabel}<span style={{transform:lbDropOpen?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",display:"inline-flex"}}><Ic t="chev" s={10}/></span>
            </button>
          </div>
        </div>
        {/* Dropdown overlay rendered outside Card to avoid overflow clipping */}
        {lbDropOpen&&<>
          <div onClick={()=>{setLbDropOpen(false);setShowCustom(false);}} style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9998}}/>
          <div style={{position:"fixed",top:dropPos.top,left:dropPos.left,transform:"translateX(-100%)",background:"#fff",borderRadius:10,border:"1px solid #e2e5ea",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",zIndex:9999,width:showCustom?340:180}}>
              {!showCustom&&<div style={{padding:4}}>
                {RANGE_OPTS.map(r=>(
                  <button key={r.k} onClick={()=>{if(r.k==="custom"){setShowCustom(true);}else{setLbRange(r.k);setLbDropOpen(false);}}} style={{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",border:"none",background:lbRange===r.k&&r.k!=="custom"?"#f0f4ff":"transparent",color:lbRange===r.k&&r.k!=="custom"?"#3b5bdb":"#374151",fontSize:12,fontWeight:lbRange===r.k?600:400,cursor:"pointer",fontFamily:"inherit",borderRadius:6,transition:"all 0.1s"}} onMouseEnter={e=>{if(lbRange!==r.k)e.currentTarget.style.background="#f8f9fb"}} onMouseLeave={e=>{if(lbRange!==r.k)e.currentTarget.style.background="transparent"}}>
                    {r.l}
                    {lbRange===r.k&&r.k!=="custom"&&<span style={{color:"#3b5bdb"}}><Ic t="check" s={12}/></span>}
                    {r.k==="custom"&&<span style={{color:"#94a3b8"}}><Ic t="chev" s={10}/></span>}
                  </button>
                ))}
              </div>}
              {showCustom&&<div style={{padding:16}}>
                <button onClick={()=>setShowCustom(false)} style={{display:"flex",alignItems:"center",gap:4,border:"none",background:"none",color:"#64748b",fontSize:11,cursor:"pointer",fontFamily:"inherit",padding:0,marginBottom:12}}>
                  <span style={{transform:"rotate(180deg)",display:"inline-flex"}}><Ic t="chev" s={10}/></span>Back
                </button>
                <div style={{fontSize:13,fontWeight:700,marginBottom:12}}>Choose Date Range</div>
                <div style={{display:"flex",gap:12,marginBottom:14}}>
                  <CalendarPicker value={customFrom} onChange={setCustomFrom} label="From"/>
                  <CalendarPicker value={customTo} onChange={setCustomTo} label="To"/>
                </div>
                <button onClick={()=>{setLbRange("custom");setLbDropOpen(false);setShowCustom(false);}} style={{width:"100%",padding:"8px 0",borderRadius:8,border:"none",background:"#3b5bdb",color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit",transition:"background 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#2f4ec4"} onMouseLeave={e=>e.currentTarget.style.background="#3b5bdb"}>Apply Range</button>
              </div>}
          </div>
        </>}
        {/* Range label */}
        {lbRange!=="all"&&<div style={{padding:"6px 20px 0",fontSize:10,color:"#94a3b8"}}>
          {lbRange==="custom"?`${customFrom} → ${customTo}`:curLabel} · Filtered results
        </div>}
        <div>
          {agentEng.map((a,idx)=>{
            const mx=agentEng[0].total||1;
            return <div key={a.id} style={{padding:"12px 20px",borderBottom:"1px solid #f8f9fb",display:"flex",alignItems:"center",gap:12}}>
              <div style={{width:22,height:22,borderRadius:"50%",background:idx===0?"#fef3c7":idx===1?"#f1f5f9":idx===2?"#fef2f2":"#f8f9fb",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700,color:idx===0?"#d97706":idx===1?"#64748b":idx===2?"#dc2626":"#94a3b8",flexShrink:0}}>{idx+1}</div>
              <Avatar fallback={a.avatar} color={roleBg(a.role)} size={30}/>
              <div style={{flex:1,minWidth:0}}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4}}>
                  <div><span style={{fontSize:12.5,fontWeight:600}}>{a.name}</span><span style={{fontSize:10,color:"#94a3b8",marginLeft:6}}>{a.role}</span></div>
                  <span style={{fontSize:13,fontWeight:700}}>{a.total}</span>
                </div>
                <div style={{display:"flex",height:5,borderRadius:3,overflow:"hidden",background:"#f0f2f5"}}>
                  <div style={{width:`${(a.ac/mx)*100}%`,background:TC.call,transition:"width 0.5s"}}/>
                  <div style={{width:`${(a.an/mx)*100}%`,background:TC.note,transition:"width 0.5s"}}/>
                  <div style={{width:`${(a.ae/mx)*100}%`,background:TC.email,transition:"width 0.5s"}}/>
                </div>
                <div style={{display:"flex",gap:10,marginTop:4}}>
                  <span style={{fontSize:9.5,color:TC.call,fontWeight:600}}>{a.ac} calls</span>
                  <span style={{fontSize:9.5,color:TC.note,fontWeight:600}}>{a.an} notes</span>
                  <span style={{fontSize:9.5,color:TC.email,fontWeight:600}}>{a.ae} emails</span>
                </div>
              </div>
            </div>;
          })}
          {agentEng.every(a=>a.total===0)&&<div style={{padding:"20px",textAlign:"center",color:"#94a3b8",fontSize:12}}>No activity in this date range.</div>}
        </div>
      </Card>
    </div>
    <Card style={{overflow:"hidden"}}>
      <div style={{padding:"14px 20px 10px",borderBottom:"1px solid #f0f2f5",display:"flex",alignItems:"center",gap:8}}>
        <Ic t="target" s={14}/><span style={{fontSize:13,fontWeight:700}}>Client Engagement</span><span style={{fontSize:11,color:"#94a3b8",marginLeft:4}}>Top 25 of {clientEng.length}</span>
      </div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 60px 60px 60px 60px 52px",padding:"8px 20px",fontSize:9.5,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,borderBottom:"1px solid #f5f6f8"}}>
        <span>Client</span><span style={{textAlign:"center"}}>Calls</span><span style={{textAlign:"center"}}>Notes</span><span style={{textAlign:"center"}}>Sales</span><span style={{textAlign:"center"}}>Emails</span><span style={{textAlign:"center"}}>Trend</span>
      </div>
      {clientEng.slice(0,25).map(c=>(
        <div key={c.id} onClick={()=>{setSel(c);setSec("clients");setTab("info")}} style={{display:"grid",gridTemplateColumns:"1fr 60px 60px 60px 60px 52px",padding:"10px 20px",alignItems:"center",borderBottom:"1px solid #f8f9fb",fontSize:12,cursor:"pointer",transition:"background 0.1s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
          <div>
            <div style={{fontWeight:600,fontSize:12.5,marginBottom:2}}>{c.name}</div>
            <div style={{display:"flex",alignItems:"center",gap:6}}>
              <span style={{fontSize:10.5,color:"#64748b"}}>{c.co}</span>
              <span style={{fontSize:9.5,fontWeight:600,padding:"1px 6px",borderRadius:8,background:tBg(c.ti),color:tC(c.ti)}}>{c.ti}</span>
            </div>
          </div>
          <span style={{textAlign:"center",fontWeight:600,color:TC.call}}>{c.cc}</span>
          <span style={{textAlign:"center",fontWeight:600,color:TC.note}}>{c.cn}</span>
          <span style={{textAlign:"center",fontWeight:600,color:TC.sale}}>{c.cs}</span>
          <span style={{textAlign:"center",fontWeight:600,color:TC.email}}>{c.ce}</span>
          <div style={{display:"flex",justifyContent:"center",color:c.trend==="up"?"#16a34a":"#ef4444"}}><Ic t={c.trend==="up"?"arrowUp":"arrowDown"} s={14}/></div>
        </div>
      ))}
    </Card>
  </div>;
};

/* ══════════════════════════════════════════════════════════
   §7 — MAIN COMPONENT: STATE DECLARATIONS & HANDLERS
   This is the core TracForce function with all state.
   Standalone: handlers.js (extract pure functions)
   ══════════════════════════════════════════════════════════ */
function TracForce(){
  const [role,setRole]=useState("Master");
  const [acctDrop,setAcctDrop]=useState(false);
  const [sec,setSec]=useState("dashboard");
  const [sel,setSel]=useState(null);
  const [tab,setTab]=useState("info");
  const [q,setQ]=useState("");
  const [note,setNote]=useState("");
  const [on,setOn]=useState(false);
  const [team,setTeam]=useState(TEAM_INIT);
  const [clients,setClients]=useState(CL_INIT);
  const [nts,setNts]=useState(NT_INIT);
  const [cls,setCls]=useState(CALLS_INIT);
  const [sales,setSales]=useState(SALES_INIT);
  const [posts,setPosts]=useState(initPosts);
  const [selMember,setSelMember]=useState(null);
  const [assignModal,setAssignModal]=useState(null);
  const [settingsTab,setSettingsTab]=useState("general");
  const [textSize,setTextSize]=useState(1.1);
  const [pendingTextSize,setPendingTextSize]=useState(1.1);
  const [selRole,setSelRole]=useState(null);
  const [viewPosts,setViewPosts]=useState(null);
  const [newPost,setNewPost]=useState("");
  const [leadFilter,setLeadFilter]=useState("All");
  const [addClientModal,setAddClientModal]=useState(false);
  const [importModal,setImportModal]=useState(false);
  const [importFile,setImportFile]=useState(null);
  const [importRows,setImportRows]=useState([]);
  const [importDest,setImportDest]=useState("Main Database");
  const [importStatus,setImportStatus]=useState(null);
  const [uploadFile,setUploadFile]=useState(null);
  const [uploadDest,setUploadDest]=useState("Main Database");
  const [assignLeadModal,setAssignLeadModal]=useState(null);
  const [uploadMyLeadsModal,setUploadMyLeadsModal]=useState(false);
  const [newCl,setNewCl]=useState({name:"",co:"",em:"",ph:"",ti:"Pro",lead:"Warm",dest:"Main Database",listTag:null});
  const DESTINATIONS=["Main Database","Outbound Leads","Inbound Leads","Partner Referrals","Event Contacts"];
  const [activeList,setActiveList]=useState(null);
  const [myLeads,setMyLeads]=useState(false);
  const [listFilter,setListFilter]=useState([]);
  const [listDrop,setListDrop]=useState(false);
  const [customLists,setCustomLists]=useState([]);
  const [newListModal,setNewListModal]=useState(false);
  const [newListName,setNewListName]=useState("");
  const [newListColor,setNewListColor]=useState("#3b5bdb");
  const [kpiMember,setKpiMember]=useState(null);
  const [kpiRange,setKpiRange]=useState("1m");
  const [kpiDrop,setKpiDrop]=useState(false);
  const [kpiFrom,setKpiFrom]=useState("2026-01-01");
  const [kpiTo,setKpiTo]=useState("2026-02-25");
  const [kpiCustomView,setKpiCustomView]=useState(false);
  const [saleModal,setSaleModal]=useState(null);
  const [aqEntries,setAqEntries]=useState([
    {id:1,d:"2026-02-20",source:"Google Ads",category:"Paid Search",service:"PPC Campaign — Enterprise",cost:4500,leads:32,cpl:140.63,status:"active"},
    {id:2,d:"2026-02-18",source:"LinkedIn Ads",category:"Social Media",service:"Sponsored InMail — Decision Makers",cost:2800,leads:18,cpl:155.56,status:"active"},
    {id:3,d:"2026-02-15",source:"Trade Show",category:"Events",service:"SaaS Summit 2026 — Booth #14",cost:8500,leads:45,cpl:188.89,status:"completed"},
    {id:4,d:"2026-02-10",source:"Content Marketing",category:"Organic",service:"Whitepaper — Cloud Migration Guide",cost:1200,leads:28,cpl:42.86,status:"active"},
    {id:5,d:"2026-02-05",source:"Facebook Ads",category:"Social Media",service:"Retargeting Campaign Q1",cost:1800,leads:14,cpl:128.57,status:"active"},
    {id:6,d:"2026-01-28",source:"Referral Program",category:"Partnership",service:"Partner Incentive Tier 2",cost:3000,leads:22,cpl:136.36,status:"active"},
    {id:7,d:"2026-01-20",source:"SEO",category:"Organic",service:"Blog + Backlink Campaign",cost:950,leads:35,cpl:27.14,status:"active"},
    {id:8,d:"2026-01-15",source:"Email Campaign",category:"Direct",service:"Nurture Sequence — Cold Leads",cost:600,leads:12,cpl:50.00,status:"completed"},
    {id:9,d:"2026-01-10",source:"Webinar",category:"Events",service:"Product Demo Webinar Jan",cost:2200,leads:38,cpl:57.89,status:"completed"},
    {id:10,d:"2026-01-05",source:"Google Ads",category:"Paid Search",service:"Brand Campaign — Competitor KW",cost:3200,leads:24,cpl:133.33,status:"paused"}
  ]);
  const [aqModal,setAqModal]=useState(false);
  const [aqCsvText,setAqCsvText]=useState("");
  const [aqTab,setAqTab]=useState("manual");
  const [aqManual,setAqManual]=useState({source:"",category:"",service:"",cost:"",leads:"",d:new Date().toISOString().slice(0,10)});
  const [aqHistory,setAqHistory]=useState([
    {id:1,ts:"2026-02-20 09:15",type:"manual",count:3,entries:[1,2,3],label:"Initial seed — Google, LinkedIn, Trade Show"},
    {id:2,ts:"2026-02-15 14:30",type:"csv",count:4,entries:[4,5,6,7],label:"CSV import — Content, Facebook, Referral, SEO"},
    {id:3,ts:"2026-02-10 11:00",type:"csv",count:3,entries:[8,9,10],label:"CSV import — Email, Webinar, Google Ads"}
  ]);
  const [aqHistoryOpen,setAqHistoryOpen]=useState(false); // null or {clientId, sale} for editing, or {clientId} for new
  const BUILT_IN_LISTS=[{id:"new",name:"New",color:"#3b5bdb",icon:"plus"},{id:"pending",name:"Pending",color:"#f59e0b",icon:"clock"},{id:"past",name:"Past",color:"#94a3b8",icon:"clock"},{id:"sold",name:"Sold",color:"#059669",icon:"check"},{id:"cancelled",name:"Cancelled",color:"#ef4444",icon:"x"},{id:"dnc",name:"DNC",color:"#7c3aed",icon:null}];
  const DB_LISTS=[
    {id:"db1",name:"Database 1",dests:["Main Database"],color:"#3b5bdb",icon:"db"},
    {id:"db2",name:"Database 2",dests:["Inbound Leads","Partner Referrals"],color:"#7c3aed",icon:"signal"},
    {id:"db3",name:"Database 3",dests:["Outbound Leads","Event Contacts"],color:"#0891b2",icon:"users"},
  ];
  // Dial page
  const [dialClient,setDialClient]=useState(null);
  const [emailCopied,setEmailCopied]=useState(false);
  const [dialMethod,setDialMethod]=useState(null);
  const [dialActive,setDialActive]=useState(false);
  const [auditModal,setAuditModal]=useState(false);
  const [reportModal,setReportModal]=useState(false);
  const [reportType,setReportType]=useState("team");
  const [reportExclude,setReportExclude]=useState([]);
  const [reportInclude,setReportInclude]=useState(()=>team.filter(m=>m.role!=="Client").map(m=>m.id));
  const [roleIndividual,setRoleIndividual]=useState({});
  const [reportGenerated,setReportGenerated]=useState(false);
  const [reportRange,setReportRange]=useState("12m");
  const [reportFrom,setReportFrom]=useState("2025-03-01");
  const [reportTo,setReportTo]=useState("2026-02-25");
  const [reportDrop,setReportDrop]=useState(false);
  const [dialTimer,setDialTimer]=useState(0);
  const [editCl,setEditCl]=useState(null);
  const [playingCall,setPlayingCall]=useState(null);
  const [notesModal,setNotesModal]=useState(false);
  const [dashTab,setDashTab]=useState("appointments");
  const timerRef=useRef(null);

  // Upcoming appointments - demo data
  const [appointments,setAppointments]=useState(()=>{
    const today=new Date();const fmt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
    const addDays=(d,n)=>{const r=new Date(d);r.setDate(r.getDate()+n);return r;};
    return [
      {id:"apt1",clientId:"c1",date:fmt(addDays(today,1)),time:"10:00 AM",type:"Follow-up Call",notes:"Discuss renewal terms"},
      {id:"apt2",clientId:"c3",date:fmt(addDays(today,2)),time:"2:30 PM",type:"Product Demo",notes:"Show new dashboard features"},
      {id:"apt3",clientId:"c5",date:fmt(addDays(today,3)),time:"11:00 AM",type:"Onboarding",notes:"Initial setup walkthrough"},
      {id:"apt4",clientId:"c2",date:fmt(addDays(today,5)),time:"9:00 AM",type:"Quarterly Review",notes:"Q1 performance review"},
      {id:"apt5",clientId:"c8",date:fmt(addDays(today,7)),time:"3:00 PM",type:"Follow-up Call",notes:"Check on implementation progress"},
    ];
  });
  const [apptModal,setApptModal]=useState(null); // null or {clientId, date, time, type, notes, id?}
  const APPT_TYPES=["Follow-up Call","Product Demo","Onboarding","Quarterly Review","Strategy Session","Check-in"];
  const addAppointment=(apt)=>{const id="apt"+Date.now();setAppointments(p=>[...p,{...apt,id}]);setApptModal(null);};
  const updateAppointment=(apt)=>{setAppointments(p=>p.map(a=>a.id===apt.id?apt:a));setApptModal(null);};
  const deleteAppointment=(id)=>{setAppointments(p=>p.filter(a=>a.id!==id));setApptModal(null);};
  const openNewAppt=(clientId)=>{const today=new Date();const fmt2=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;setApptModal({clientId:clientId||null,date:fmt2(today),time:"10:00 AM",type:"Follow-up Call",notes:"",isNew:true});};

  useEffect(()=>{setOn(true)},[]);
  useEffect(()=>{if(dialActive){timerRef.current=setInterval(()=>setDialTimer(t=>t+1),1000);return()=>clearInterval(timerRef.current);}else{clearInterval(timerRef.current);}},[dialActive]);

  const curUser=team.find(m=>m.role===role);
  const curUserId=curUser?.id;
  const fc=clients.filter(c=>{const mq=c.name.toLowerCase().includes(q.toLowerCase())||c.co.toLowerCase().includes(q.toLowerCase());const ml=leadFilter==="All"||c.lead===leadFilter;const dl=!activeList||DB_LISTS.find(d=>d.id===activeList)?.dests.includes(c.dest);const myL=!myLeads||c.assignedTo===curUserId;const lf=!listFilter.length||(listFilter.includes("dnc")&&c.lead==="DNC")||(listFilter.filter(f=>f!=="dnc").some(f=>c.listTag===f));return mq&&ml&&dl&&myL&&lf;});
  const assignableRoles=ar=>ROLE_ORDER.filter((_,i)=>i>roleIdx(ar)&&i<ROLE_ORDER.length-1);
  const handleRoleChange=(mid,nr)=>{setTeam(p=>p.map(m=>m.id===mid?{...m,role:nr}:m));setAssignModal(null);};
  const handlePhoto=(id,isClient)=>{const input=document.createElement("input");input.type="file";input.accept="image/*";input.onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>{if(isClient)setClients(p=>p.map(c=>c.id===id?{...c,photo:ev.target.result}:c));else setTeam(p=>p.map(m=>m.id===id?{...m,photo:ev.target.result}:m));};r.readAsDataURL(f);}};input.click();};
  const addPost=(mid)=>{if(!newPost.trim())return;setPosts(p=>({...p,[mid]:[{id:"p"+Date.now(),date:new Date().toISOString().slice(0,16).replace("T"," "),text:newPost.trim()},...(p[mid]||[])]}));setNewPost("");};
  const parseCSV=(text)=>{const lines=text.trim().split("\n").map(l=>l.split(",").map(c=>c.trim().replace(/^"|"$/g,"")));if(lines.length<2)return[];const hdr=lines[0].map(h=>h.toLowerCase());const ni=hdr.findIndex(h=>h.includes("name"));const ci=hdr.findIndex(h=>h.includes("company")||h.includes("co"));const ei=hdr.findIndex(h=>h.includes("email")||h.includes("mail"));const pi=hdr.findIndex(h=>h.includes("phone")||h.includes("ph"));const si=hdr.findIndex(h=>h.includes("status")||h.includes("st"));const ti=hdr.findIndex(h=>h.includes("tier")||h.includes("ti"));const li=hdr.findIndex(h=>h.includes("lead"));return lines.slice(1).filter(r=>r[ni>=0?ni:0]?.trim()).map(r=>({name:r[ni>=0?ni:0]||"Unknown",co:r[ci>=0?ci:1]||"",em:r[ei>=0?ei:2]||"",ph:r[pi>=0?pi:3]||"",st:r[si>=0?si:4]||"Active",ti:r[ti>=0?ti:5]||"Pro",lead:r[li>=0?li:6]||"Warm"}));};
  const handleFileUpload=(file,cb)=>{if(!file)return;const reader=new FileReader();reader.onload=e=>{const text=e.target.result;const rows=parseCSV(text);cb(rows);};reader.readAsText(file);};
  const doImport=(rows,dest,assignTo)=>{const newClients=rows.map((r,i)=>({id:Date.now()+i,name:r.name,co:r.co,em:r.em,ph:r.ph,st:r.st,lc:new Date().toISOString().slice(0,10),ti:r.ti,photo:null,lead:r.lead,dest:dest,assignedTo:assignTo||null,listTag:null}));setClients(p=>[...p,...newClients]);return newClients.length;};
  const exportCSV=()=>{try{const hdr="Name,Company,Email,Phone,Status,Tier,Lead,Database,Last Contact,Assigned To\n";const rows=clients.map(c=>{const assigned=team.find(m=>m.id===c.assignedTo);return [c.name,c.co,c.em,c.ph,c.st,c.ti,c.lead,c.dest,c.lc,assigned?assigned.name:"Unassigned"].map(v=>'"'+String(v||"").replace(/"/g,'""')+'"').join(",");}).join("\n");const blob=new Blob([hdr+rows],{type:"text/csv;charset=utf-8;"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="tracforce_clients_"+new Date().toISOString().slice(0,10)+".csv";document.body.appendChild(a);a.click();document.body.removeChild(a);setTimeout(()=>URL.revokeObjectURL(url),100);}catch(e){console.error("Export failed:",e);}};
  const exportAuditCSV=(logs)=>{try{const hdr="Timestamp,User,Action,Category\n";const rows=logs.map(l=>[l.t,l.u,l.a,l.cat].map(v=>'"'+String(v||"").replace(/"/g,'""')+'"').join(",")).join("\n");const blob=new Blob([hdr+rows],{type:"text/csv;charset=utf-8;"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="tracforce_audit_"+new Date().toISOString().slice(0,10)+".csv";document.body.appendChild(a);a.click();document.body.removeChild(a);setTimeout(()=>URL.revokeObjectURL(url),100);}catch(e){console.error("Export failed:",e);}};
  const updateClient=(id,f,v)=>{setClients(p=>p.map(c=>c.id===id?{...c,[f]:v}:c));};
  const openDial=(c)=>{setDialClient(c);setDialMethod(null);setDialActive(false);setDialTimer(0);setEditCl(null);setPlayingCall(null);};
  const navTo=(s)=>{setSec(s);setSel(null);setSelMember(null);setSelRole(null);setViewPosts(null);setDialClient(null);setDialActive(false);setDialTimer(0);setActiveList(null);setLeadFilter("All");setMyLeads(false);setListFilter([]);setListDrop(false);setKpiMember(null);if(s==="settings")setPendingTextSize(textSize);};

  const Avatar=({src,fallback,color,size=34,click})=><div onClick={click} style={{width:size,height:size,borderRadius:"50%",background:src?"transparent":(color||"#f0f2f5"),display:"flex",alignItems:"center",justifyContent:"center",fontSize:size*0.35,fontWeight:700,color:color?"#fff":"#64748b",cursor:click?"pointer":"default",overflow:"hidden",border:src?`2px solid ${color||"#e2e5ea"}`:"none",flexShrink:0}}>{src?<img src={src} style={{width:"100%",height:"100%",objectFit:"cover"}} alt=""/>:fallback}</div>;
  const PhotoAvatar=({src,fallback,color,size=56,onClick})=><div onClick={onClick} style={{width:size,height:size,borderRadius:"50%",background:src?"transparent":(color?color+"20":"#f0f2f5"),display:"flex",alignItems:"center",justifyContent:"center",fontSize:size*0.35,fontWeight:700,color:color||"#64748b",cursor:onClick?"pointer":"default",overflow:"hidden",position:"relative",border:src?`2px solid ${color||"#d0d5dd"}`:`2px dashed ${color?color+"40":"#d0d5dd"}`,flexShrink:0}}>{src?<img src={src} style={{width:"100%",height:"100%",objectFit:"cover"}} alt=""/>:fallback}{onClick&&<div style={{position:"absolute",bottom:0,right:0,width:size*0.3,height:size*0.3,borderRadius:"50%",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #e2e5ea"}}><Ic t="camera" s={size*0.16}/></div>}</div>;
  const Back=({label,onClick})=><button onClick={onClick} style={{display:"flex",alignItems:"center",gap:5,background:"none",border:"none",color:"#64748b",fontSize:13,cursor:"pointer",fontFamily:"inherit",marginBottom:14,padding:0}}><span style={{transform:"rotate(180deg)",display:"inline-flex"}}><Ic t="chev" s={14}/></span>{label}</button>;
  const Card=({children,style:s,...rest})=><div style={{background:"#fff",borderRadius:12,border:"1px solid #eef0f2",...s}} {...rest}>{children}</div>;
  const Stat=({label,val,icon,color})=><Card style={{padding:"18px 20px",position:"relative",overflow:"hidden"}}><div style={{position:"absolute",top:0,left:0,width:"100%",height:3,background:color}}/><div style={{display:"flex",alignItems:"center",gap:5,marginBottom:6,color:"#94a3b8"}}><Ic t={icon} s={14}/><span style={{fontSize:11,fontWeight:500,textTransform:"uppercase",letterSpacing:0.5}}>{label}</span></div><div style={{fontSize:24,fontWeight:700,letterSpacing:-0.5}}>{val}</div></Card>;

  const LeadBadge=({lead,size="sm"})=><span style={{fontSize:size==="sm"?10:11,fontWeight:600,padding:size==="sm"?"2px 8px":"3px 10px",borderRadius:20,background:leadBg(lead),color:leadColor(lead),display:"inline-flex",alignItems:"center",gap:3}}><span style={{width:size==="sm"?5:6,height:size==="sm"?5:6,borderRadius:"50%",background:leadColor(lead)}}/>{lead}</span>;


  /* ════════════════════════════════════════════════════════
     §8 — DIAL PAGE COMPONENT
     Standalone: DialPage.jsx
     Depends on: React, §2, §3, §4, §7 (state)
     ════════════════════════════════════════════════════════ */
  /* ======================== DIAL PAGE ======================== */
  const DialPage=()=>{
    const c=clients.find(x=>x.id===dialClient.id)||dialClient;
    const me=team[0];
    const clientCalls=cls[c.id]||[];
    const clientNotes=nts[c.id]||[];

    return <div>
      <Back label="Back to Client" onClick={()=>{setDialClient(null);setDialActive(false);setDialTimer(0);}}/>

      {c.lead==="DNC"&&<div style={{display:"flex",alignItems:"center",gap:10,padding:"12px 18px",borderRadius:10,background:"#f5f3ff",border:"1px solid #7c3aed30",marginBottom:16}}><svg viewBox="0 0 24 24" style={{width:18,height:18,stroke:"#7c3aed",strokeWidth:2,fill:"none",flexShrink:0}}><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg><div style={{flex:1,fontSize:13,color:"#7c3aed",fontWeight:500}}>This client is on the <strong>Do Not Contact</strong> list. Remove from DNC to enable dialing.</div><button onClick={()=>{updateClient(c.id,"lead","Warm");}} style={{padding:"6px 14px",borderRadius:8,border:"1px solid #7c3aed",background:"#fff",color:"#7c3aed",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit",whiteSpace:"nowrap"}}>Remove DNC</button></div>}

      {/* Two column layout: left = call panel, right = notes & calls */}
      <div style={{display:"grid",gridTemplateColumns:"340px 1fr",gap:18,alignItems:"start"}}>

        {/* LEFT: Call panel + lead status */}
        <div style={{position:"sticky",top:0}}>
          <Card style={{overflow:"hidden",marginBottom:14}}>
            <div style={{background:dialActive?"#059669":"#1a1a2e",padding:"10px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"background 0.3s"}}>
              <div style={{display:"flex",alignItems:"center",gap:8,color:"#fff"}}><Ic t={dialActive?"signal":"phone"} s={15}/><span style={{fontWeight:600,fontSize:13}}>{dialActive?"In Progress":"Dial"}</span>{dialActive&&<span style={{color:"rgba(255,255,255,0.8)",fontSize:13,fontFamily:"monospace"}}>{fmtSec(dialTimer)}</span>}</div>
              {dialActive&&<span style={{width:6,height:6,borderRadius:"50%",background:"#4ade80",animation:"pulse 1.5s infinite"}}/>}
            </div>
            <div style={{padding:"20px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"}}>
              <div style={{display:"flex",alignItems:"center",gap:16,marginBottom:14}}>
                <div style={{display:"flex",flexDirection:"column",alignItems:"center"}}>
                  <div style={{fontSize:9,textTransform:"uppercase",letterSpacing:1,color:"#94a3b8",fontWeight:600,marginBottom:6}}>You</div>
                  <PhotoAvatar src={me.photo} fallback={me.avatar} color={roleBg(me.role)} size={48} onClick={()=>handlePhoto(me.id,false)}/>
                </div>
                <div style={{display:"flex",alignItems:"center",gap:4,color:"#94a3b8"}}><div style={{width:20,height:2,background:dialActive?"#059669":"#e2e5ea"}}/><Ic t="phone" s={12}/><div style={{width:20,height:2,background:dialActive?"#059669":"#e2e5ea"}}/></div>
                <div style={{display:"flex",flexDirection:"column",alignItems:"center"}}>
                  <div style={{fontSize:9,textTransform:"uppercase",letterSpacing:1,color:"#94a3b8",fontWeight:600,marginBottom:6}}>Client</div>
                  <PhotoAvatar src={c.photo} fallback={ini(c.name)} size={48} onClick={()=>handlePhoto(c.id,true)}/>
                </div>
              </div>
              <div style={{fontWeight:600,fontSize:15}}>{c.name}</div>
              <div style={{fontSize:12,color:"#94a3b8"}}>{c.co} · {c.ph}</div>

              {/* Dial controls */}
              <div style={{marginTop:14,width:"100%"}}>
                {!dialActive&&!dialMethod&&<div style={{display:"flex",flexDirection:"column",gap:6}}>
                  {[["phone","Own Phone"],["mic","TracForce"],["link","3rd Party"]].map(([ic,l])=>(
                    <button key={ic} onClick={()=>setDialMethod(ic)} style={{display:"flex",alignItems:"center",gap:8,padding:"9px 14px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",cursor:"pointer",fontFamily:"inherit",fontSize:12,fontWeight:500,color:"#374151",width:"100%",transition:"all 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="#fff"}><Ic t={ic} s={14}/>{l}</button>
                  ))}
                </div>}
                {dialMethod&&!dialActive&&<div style={{display:"flex",flexDirection:"column",gap:8}}>
                  <div style={{fontSize:12,color:"#64748b",textAlign:"center"}}>{dialMethod==="phone"?"Own Phone":dialMethod==="mic"?"TracForce Dialer":"3rd Party"} <button onClick={()=>setDialMethod(null)} style={{fontSize:11,color:"#94a3b8",background:"none",border:"none",cursor:"pointer",fontFamily:"inherit",textDecoration:"underline",marginLeft:4}}>change</button></div>
                  <button onClick={()=>{if(c.lead!=="DNC")setDialActive(true);}} style={{display:"flex",alignItems:"center",justifyContent:"center",gap:7,padding:"10px",borderRadius:8,border:"none",background:c.lead==="DNC"?"#e2e5ea":"#059669",color:c.lead==="DNC"?"#94a3b8":"#fff",fontSize:13,fontWeight:600,cursor:c.lead==="DNC"?"not-allowed":"pointer",fontFamily:"inherit",width:"100%"}}><Ic t="phone" s={15}/>{c.lead==="DNC"?"DNC — Cannot Dial":"Start Call"}</button>
                </div>}
                {dialActive&&<button onClick={()=>{setDialActive(false);setDialTimer(0);}} style={{display:"flex",alignItems:"center",justifyContent:"center",gap:7,padding:"10px",borderRadius:8,border:"none",background:"#ef4444",color:"#fff",fontSize:13,fontWeight:600,cursor:"pointer",fontFamily:"inherit",width:"100%"}}><Ic t="x" s={15}/>End Call</button>}
              </div>
            </div>
          </Card>

          {/* Lead Status */}
          <Card style={{padding:"16px 20px"}}>
            <div style={{fontSize:10,textTransform:"uppercase",letterSpacing:0.8,color:"#94a3b8",fontWeight:600,marginBottom:10}}>Lead Status</div>
            <div style={{display:"flex",gap:6}}>
              {["Hot","Warm","Cold","DNC"].map(l=>(
                <button key={l} onClick={()=>updateClient(c.id,"lead",l)} style={{flex:1,padding:"8px 0",borderRadius:8,border:c.lead===l?`2px solid ${leadColor(l)}`:"1px solid #e2e5ea",background:c.lead===l?leadBg(l):"#fff",cursor:"pointer",fontFamily:"inherit",fontSize:12,fontWeight:600,color:c.lead===l?leadColor(l):"#94a3b8",display:"flex",alignItems:"center",justifyContent:"center",gap:4,transition:"all 0.15s"}}>
                  {l==="Hot"&&<Ic t="flame" s={13}/>}{l}
                </button>
              ))}
            </div>
            <div style={{marginTop:12,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
              <div><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600}}>Status</div><div style={{display:"flex",alignItems:"center",gap:4,marginTop:3}}>{["Active","Pending","Inactive"].map(st=>(<button key={st} onClick={()=>setClients(p=>p.map(x=>x.id===c.id?{...x,st}:x))} style={{display:"flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:6,border:c.st===st?"1px solid "+stColor(st):"1px solid transparent",background:c.st===st?stColor(st)+"18":"transparent",color:c.st===st?stColor(st):"#cbd5e1",fontSize:11,fontWeight:c.st===st?600:400,cursor:"pointer",fontFamily:"inherit"}}><span style={{width:6,height:6,borderRadius:"50%",background:c.st===st?stColor(st):"#e2e5ea"}}/>{st}</button>))}</div></div>
              <div><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600}}>Tier</div><span style={{fontSize:11,fontWeight:600,padding:"2px 8px",borderRadius:10,background:tBg(c.ti),color:tC(c.ti),marginTop:3,display:"inline-block"}}>{c.ti}</span></div>
            </div>
            <div style={{marginTop:12}}><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:6}}>List</div><div style={{display:"flex",gap:4,flexWrap:"wrap"}}>{[{id:"none",name:"None",color:"#94a3b8"},...BUILT_IN_LISTS.filter(b=>b.id!=="dnc"),...customLists].map(lt=>(<button key={lt.id} onClick={()=>updateClient(c.id,"listTag",lt.id==="none"?null:lt.id)} style={{padding:"3px 8px",borderRadius:6,border:(c.listTag||"none")===lt.id?"1px solid "+lt.color:"1px solid #e2e5ea",background:(c.listTag||"none")===lt.id?lt.color+"18":"transparent",color:(c.listTag||"none")===lt.id?lt.color:"#cbd5e1",fontSize:11,fontWeight:(c.listTag||"none")===lt.id?600:400,cursor:"pointer",fontFamily:"inherit"}}>{lt.name}</button>))}</div></div>
          </Card>

          {/* Book Appointment */}
          <Card style={{padding:"16px 20px"}}>
            <div style={{fontSize:10,textTransform:"uppercase",letterSpacing:0.8,color:"#94a3b8",fontWeight:600,marginBottom:10}}>Appointments</div>
            <button onClick={()=>openNewAppt(c.id)} style={{display:"flex",alignItems:"center",justifyContent:"center",gap:7,padding:"9px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151",width:"100%",transition:"all 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="#fff"}><Ic t="plus" s={14}/>Book Appointment</button>
            {(()=>{const ca=appointments.filter(a=>a.clientId===c.id).sort((a,b)=>a.date.localeCompare(b.date));return ca.length?<div style={{marginTop:8}}>{ca.map(a=>(<div key={a.id} onClick={()=>setApptModal({...a,isNew:false})} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderTop:"1px solid #f5f6f8",cursor:"pointer"}}><div><div style={{fontSize:12,fontWeight:500}}>{a.type}</div><div style={{fontSize:11,color:"#94a3b8"}}>{a.notes}</div></div><div style={{textAlign:"right",flexShrink:0}}><div style={{fontSize:11,fontWeight:600,color:"#64748b"}}>{new Date(a.date+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}</div><div style={{fontSize:10,color:"#94a3b8"}}>{a.time}</div></div></div>))}</div>:null;})()}
          </Card>
        </div>

          {/* Sales */}
          <Card style={{padding:"16px 20px"}}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8}}><div style={{display:"flex",alignItems:"center",gap:6}}><Ic t="dollar" s={14}/><span style={{fontSize:10,textTransform:"uppercase",letterSpacing:0.8,color:"#94a3b8",fontWeight:600}}>Sales</span><span style={{fontSize:10,color:"#059669",fontWeight:700}}>({(sales[c.id]||[]).length})</span></div><button onClick={()=>{const me=team[0];const sn=me.name.split(" ")[0]+" "+me.name.split(" ")[1][0]+".";setSaleModal({clientId:c.id});}} style={{display:"flex",alignItems:"center",gap:4,padding:"4px 10px",borderRadius:6,border:"1px solid #e2e5ea",background:"#fff",fontSize:11,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151"}}><Ic t="plus" s={12}/>Add</button></div>
            {(sales[c.id]||[]).slice(0,3).map(s=>{const uSD=(field,val)=>setSales(p=>({...p,[c.id]:(p[c.id]||[]).map(x=>x.id===s.id?{...x,[field]:val}:x)}));return <div key={s.id} style={{padding:"8px 0",borderTop:"1px solid #f5f6f8"}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6}}><input value={s.product||""} onChange={e=>uSD("product",e.target.value)} placeholder="Product..." style={{fontSize:12,fontWeight:600,border:"none",outline:"none",background:"transparent",padding:0,fontFamily:"inherit",flex:1}}/><button onClick={()=>setSales(p=>({...p,[c.id]:(p[c.id]||[]).filter(x=>x.id!==s.id)}))} style={{padding:"2px",border:"none",background:"transparent",cursor:"pointer",color:"#cbd5e1"}}><Ic t="trash" s={11}/></button></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,marginBottom:4}}><input value={s.quality||""} onChange={e=>uSD("quality",e.target.value)} placeholder="Quality..." style={{fontSize:10.5,border:"1px solid #eef0f2",borderRadius:4,padding:"3px 6px",outline:"none",background:"#fafbfc",fontFamily:"inherit"}}/><input value={s.saleType||""} onChange={e=>uSD("saleType",e.target.value)} placeholder="Sale type..." style={{fontSize:10.5,border:"1px solid #eef0f2",borderRadius:4,padding:"3px 6px",outline:"none",background:"#fafbfc",fontFamily:"inherit"}}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4}}>{[["amt","Amt"],["grossProfit","Gross"],["netProfit","Net"]].map(([f,lb])=><div key={f} style={{display:"flex",alignItems:"center",border:"1px solid #eef0f2",borderRadius:4,background:"#fafbfc",overflow:"hidden"}}><span style={{fontSize:9,color:"#059669",fontWeight:700,padding:"3px 0 3px 5px"}}>$</span><input type="number" value={s[f]||""} onChange={e=>uSD(f,Number(e.target.value)||0)} placeholder={lb} style={{fontSize:10.5,fontWeight:600,color:"#059669",border:"none",outline:"none",background:"transparent",padding:"3px 4px 3px 2px",fontFamily:"inherit",width:"100%"}}/></div>)}</div></div>})}
            {!(sales[c.id]||[]).length&&<div style={{fontSize:11,color:"#cbd5e1",textAlign:"center",padding:6}}>No sales</div>}
          </Card>

        {/* RIGHT: Previous notes (clickable) → Add note → Recent calls */}
        <div>
          {/* Previous Activity — notes + calls merged, sorted most recent first */}
          {(()=>{
            const items=[
              ...clientNotes.map(n=>({type:"note",d:n.d,data:n})),
              ...clientCalls.map(c2=>({type:"call",d:c2.d,data:c2}))
            ].sort((a,b)=>b.d.localeCompare(a.d));
            const totalCount=items.length;
            const mostRecent=items[0];

            return <Card style={{marginBottom:10,overflow:"hidden"}}>
              <div onClick={()=>{if(totalCount)setNotesModal(!notesModal)}} style={{padding:"12px 18px",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:totalCount?"pointer":"default",userSelect:"none"}}>
                <div style={{display:"flex",alignItems:"center",gap:8}}>
                  <Ic t="note" s={15}/>
                  <span style={{fontSize:13,fontWeight:600,color:notesModal?"#3b5bdb":"#1a1a2e",textDecoration:totalCount?"underline":"none",textUnderlineOffset:3,transition:"color 0.15s"}}>Previous Notes</span>
                  <span style={{fontSize:11,color:"#94a3b8",fontWeight:400}}>({totalCount})</span>
                </div>
                {totalCount>0&&<div style={{transform:notesModal?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",color:"#94a3b8"}}><Ic t="chev" s={14}/></div>}
              </div>

              {/* Collapsed: most recent item preview */}
              {!notesModal&&mostRecent&&<div style={{padding:"0 18px 14px"}}>
                {mostRecent.type==="note"?<div style={{padding:"10px 14px",borderRadius:8,background:"#fafbfc",border:"1px solid #eef0f2"}}>
                  <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}><span style={{fontSize:9,fontWeight:600,padding:"1px 5px",borderRadius:8,background:"#f0f4ff",color:"#3b5bdb"}}>Note</span><span style={{fontSize:11,fontWeight:600,color:"#3b5bdb"}}>{mostRecent.data.a}</span><span style={{fontSize:9,padding:"1px 5px",borderRadius:8,background:roleBg(mostRecent.data.aRole)+"15",color:roleBg(mostRecent.data.aRole),fontWeight:600}}>{mostRecent.data.aRole}</span><span style={{fontSize:10,color:"#94a3b8"}}>{mostRecent.data.d}</span></div>
                  <div style={{fontSize:12.5,lineHeight:1.5,color:"#374151",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"}}>{mostRecent.data.t}</div>
                </div>
                :<div style={{padding:"10px 14px",borderRadius:8,background:"#fafbfc",border:"1px solid #eef0f2",display:"flex",alignItems:"center",gap:10}}>
                  {(()=>{const ag2=team.find(m=>m.name.startsWith(mostRecent.data.ag.split(" ")[0]));return <Avatar src={ag2?.photo} fallback={ag2?.avatar||"?"} color={ag2?roleBg(ag2.role)+"30":null} size={28}/>;})()}
                  <div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:9,fontWeight:600,padding:"1px 5px",borderRadius:8,background:mostRecent.data.ty==="Inbound"?"#f0fdf4":"#f0f4ff",color:mostRecent.data.ty==="Inbound"?"#16a34a":"#3b5bdb"}}>Call</span><span style={{fontSize:11,fontWeight:500}}>by {mostRecent.data.ag}</span><span style={{fontSize:10,color:"#94a3b8"}}>{mostRecent.data.d}</span><span style={{fontSize:10,color:"#64748b"}}>{mostRecent.data.dur}</span></div></div>
                  {mostRecent.data.rc&&<button onClick={e=>{e.stopPropagation();setPlayingCall(playingCall===mostRecent.data.id?null:mostRecent.data.id)}} style={{display:"flex",alignItems:"center",gap:3,padding:"3px 8px",borderRadius:5,border:"1px solid #e2e5ea",background:"#fff",fontSize:10,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}><Ic t="play" s={10}/>Play</button>}
                </div>}
                {totalCount>1&&<div style={{fontSize:10,color:"#94a3b8",marginTop:6}}>+ {totalCount-1} more</div>}
              </div>}
              {!totalCount&&<div style={{padding:"0 18px 14px",fontSize:12,color:"#94a3b8"}}>No activity yet.</div>}

              {/* Expanded: full timeline sorted most recent first, scrollable */}
              {notesModal&&totalCount>0&&<div style={{maxHeight:380,overflowY:"auto",borderTop:"1px solid #eef0f2"}}>
                {items.map((item,i)=>{
                  if(item.type==="note"){
                    const n=item.data;const ce=canEditDeleteNote(role,n.aRole);
                    return <div key={"n"+n.id} style={{padding:"12px 18px",borderBottom:"1px solid #f5f6f8",borderLeft:"3px solid #3b5bdb"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:5}}>
                        <div style={{display:"flex",alignItems:"center",gap:6}}>
                          <span style={{fontSize:9,fontWeight:600,padding:"1px 5px",borderRadius:8,background:"#f0f4ff",color:"#3b5bdb"}}>Note</span>
                          <span style={{fontSize:11,fontWeight:600,color:"#3b5bdb"}}>{n.a}</span>
                          <span style={{fontSize:9,padding:"1px 5px",borderRadius:8,background:roleBg(n.aRole)+"15",color:roleBg(n.aRole),fontWeight:600}}>{n.aRole}</span>
                          <span style={{fontSize:10,color:"#94a3b8"}}>{n.d}</span>
                        </div>
                        {ce&&<div style={{display:"flex",gap:4}}>
                          <button style={{padding:"1px 5px",borderRadius:3,border:"1px solid #e2e5ea",background:"#fff",fontSize:9,cursor:"pointer",color:"#64748b"}}><Ic t="edit" s={9}/></button>
                          <button style={{padding:"1px 5px",borderRadius:3,border:"1px solid #fecaca",background:"#fff",fontSize:9,cursor:"pointer",color:"#ef4444"}}><Ic t="trash" s={9}/></button>
                        </div>}
                      </div>
                      <div style={{fontSize:13,lineHeight:1.5,color:"#374151",paddingLeft:2}}>{n.t}</div>
                    </div>;
                  } else {
                    const call=item.data;
                    const ag=team.find(m=>m.name.startsWith(call.ag.split(" ")[0]));
                    const isPlaying=playingCall===call.id;
                    return <div key={"c"+call.id} style={{padding:"12px 18px",borderBottom:"1px solid #f5f6f8",borderLeft:"3px solid "+(call.ty==="Inbound"?"#16a34a":"#3b5bdb")}}>
                      <div style={{display:"flex",alignItems:"center",gap:10}}>
                        <Avatar src={ag?.photo} fallback={ag?.avatar||"?"} color={ag?roleBg(ag.role)+"30":null} size={30}/>
                        <div style={{flex:1}}>
                          <div style={{display:"flex",alignItems:"center",gap:6}}>
                            <span style={{fontSize:9,fontWeight:600,padding:"1px 5px",borderRadius:8,background:call.ty==="Inbound"?"#f0fdf4":"#f0f4ff",color:call.ty==="Inbound"?"#16a34a":"#3b5bdb"}}>{call.ty} Call</span>
                            <span style={{fontWeight:500,fontSize:11}}>by {call.ag}</span>
                            {ag&&<span style={{fontSize:9,fontWeight:600,padding:"1px 5px",borderRadius:8,background:roleBg(ag.role)+"15",color:roleBg(ag.role)}}>{ag.role}</span>}
                          </div>
                          <div style={{display:"flex",alignItems:"center",gap:8,marginTop:2}}><span style={{fontSize:10,color:"#94a3b8"}}>{call.d}</span><span style={{fontSize:10,color:"#64748b"}}>{call.dur}</span>{!call.rc&&<span style={{fontSize:9,color:"#cbd5e1"}}>No recording</span>}</div>
                        </div>
                        {call.rc&&<button onClick={e=>{e.stopPropagation();setPlayingCall(isPlaying?null:call.id)}} style={{display:"flex",alignItems:"center",gap:3,padding:"4px 10px",borderRadius:6,border:isPlaying?"1px solid #059669":"1px solid #e2e5ea",background:isPlaying?"#f0fdf4":"#fff",fontSize:10,cursor:"pointer",fontFamily:"inherit",color:isPlaying?"#059669":"#64748b",fontWeight:isPlaying?600:400}}><Ic t="play" s={11}/>{isPlaying?"Playing...":"Play"}</button>}
                      </div>
                      {isPlaying&&<div style={{marginTop:8,padding:"8px 12px",background:"#f0fdf4",borderRadius:8,display:"flex",alignItems:"center",gap:8}}>
                        <div style={{flex:1,height:4,background:"#d1fae5",borderRadius:2,overflow:"hidden"}}><div style={{width:"45%",height:"100%",background:"#059669",borderRadius:2,animation:"grow 3s linear infinite"}}/></div>
                        <span style={{fontSize:10,color:"#059669",fontWeight:500}}>{call.dur}</span>
                        <button onClick={()=>setPlayingCall(null)} style={{background:"none",border:"none",cursor:"pointer",color:"#059669",padding:0}}><Ic t="x" s={12}/></button>
                      </div>}
                    </div>;
                  }
                })}
              </div>}
            </Card>;
          })()}

          {/* Add note */}
          <Card style={{padding:"14px 18px",marginBottom:14}}>
            <div style={{display:"flex",gap:10}}>
              <textarea placeholder="Add a note..." value={note} onChange={e=>setNote(e.target.value)} rows={2} style={{flex:1,border:"1px solid #e2e5ea",borderRadius:8,padding:"9px 12px",fontSize:13,fontFamily:"inherit",resize:"none",outline:"none",boxSizing:"border-box"}}/>
              <button onClick={()=>{if(!note.trim())return;setNts(p=>({...p,[c.id]:[{id:Date.now(),d:new Date().toISOString().slice(0,10),a:team[0].name.split(" ")[0]+" "+team[0].name.split(" ")[1][0]+".",aRole:role,t:note.trim()},...(p[c.id]||[])]}));setNote("");}} style={{padding:"0 16px",borderRadius:8,border:"none",background:"#1a1a2e",color:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",alignSelf:"stretch"}}>Save</button>
            </div>
          </Card>

          {/* Recent Calls */}
          <Card style={{overflow:"hidden"}}>
            <div style={{padding:"12px 18px",borderBottom:"1px solid #eef0f2",fontSize:13,fontWeight:600,display:"flex",justifyContent:"space-between"}}><span>Recent Calls</span><span style={{fontSize:11,color:"#94a3b8",fontWeight:400}}>{clientCalls.length} call{clientCalls.length!==1?"s":""}</span></div>
            <div style={{maxHeight:240,overflowY:"auto"}}>
              {!clientCalls.length&&<div style={{textAlign:"center",padding:24,color:"#94a3b8",fontSize:13}}>No calls recorded.</div>}
              {clientCalls.map((call,idx)=>{
                const ag=team.find(m=>m.name.startsWith(call.ag.split(" ")[0]));
                const isP=playingCall===call.id;
                return <div key={"rc"+idx} style={{padding:"12px 18px",borderBottom:"1px solid #f5f6f8"}}>
                  <div style={{display:"flex",alignItems:"center",gap:10}}>
                    <Avatar src={ag?.photo} fallback={ag?.avatar||"?"} color={ag?roleBg(ag.role)+"30":null} size={30}/>
                    <div style={{flex:1}}>
                      <div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:500,fontSize:12}}>Called by {call.ag}</span>{ag&&<span style={{fontSize:9,fontWeight:600,padding:"1px 5px",borderRadius:8,background:roleBg(ag.role)+"15",color:roleBg(ag.role)}}>{ag.role}</span>}</div>
                      <div style={{display:"flex",alignItems:"center",gap:8,marginTop:2}}><span style={{fontSize:11,color:"#94a3b8"}}>{call.d}</span><span style={{fontSize:10,fontWeight:600,padding:"1px 6px",borderRadius:8,background:call.ty==="Inbound"?"#f0fdf4":"#f0f4ff",color:call.ty==="Inbound"?"#16a34a":"#3b5bdb"}}>{call.ty}</span><span style={{fontSize:11,color:"#64748b"}}>{call.dur}</span></div>
                    </div>
                    {call.rc&&<button onClick={()=>setPlayingCall(isP?null:call.id)} style={{display:"flex",alignItems:"center",gap:3,padding:"4px 10px",borderRadius:6,border:isP?"1px solid #059669":"1px solid #e2e5ea",background:isP?"#f0fdf4":"#fff",fontSize:10,cursor:"pointer",fontFamily:"inherit",color:isP?"#059669":"#64748b",fontWeight:isP?600:400}}><Ic t="play" s={11}/>{isP?"Playing...":"Play"}</button>}
                  </div>
                  {isP&&<div style={{marginTop:8,padding:"8px 12px",background:"#f0fdf4",borderRadius:8,display:"flex",alignItems:"center",gap:8}}>
                    <div style={{flex:1,height:4,background:"#d1fae5",borderRadius:2,overflow:"hidden"}}><div style={{width:"45%",height:"100%",background:"#059669",borderRadius:2,animation:"grow 3s linear infinite"}}/></div>
                    <span style={{fontSize:10,color:"#059669",fontWeight:500}}>{call.dur}</span>
                    <button onClick={()=>setPlayingCall(null)} style={{background:"none",border:"none",cursor:"pointer",color:"#059669",padding:0}}><Ic t="x" s={12}/></button>
                  </div>}
                </div>;
              })}
            </div>
          </Card>
        </div>
      </div>
    </div>;
  };

  /* ======================== MAIN RENDER ======================== */
  return(
    <div style={{display:"flex",height:"100vh",fontFamily:"'DM Sans','Segoe UI',sans-serif",background:"#fafbfc",color:"#1a1a2e",overflow:"hidden",opacity:on?1:0,transition:"opacity 0.5s"}}>
      {/* SIDEBAR */}
      <div style={{width:Math.round(240*textSize),background:"#fff",borderRight:"1px solid #eef0f2",display:"flex",flexDirection:"column",flexShrink:0}}>
        <div style={{display:"flex",flexDirection:"column",flex:1,overflow:"hidden",zoom:textSize}}>
        <div style={{padding:"20px 16px 12px"}}><div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:90,height:90,minWidth:90,borderRadius:18,background:"#1a1a2e",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,position:"relative",overflow:"hidden"}}><div style={{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"75%",height:"75%",borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.05) 40%, transparent 70%)",mixBlendMode:"soft-light"}}/><svg viewBox="0 0 100 100" style={{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%) rotate(-45deg) scale(0.9)",opacity:0.45,width:"100%",height:"100%"}}><ellipse cx="50" cy="62" rx="26" ry="20" fill="#fff"/><ellipse cx="20" cy="44" rx="10" ry="13" fill="#fff"/><ellipse cx="40" cy="24" rx="10" ry="13" fill="#fff"/><ellipse cx="64" cy="24" rx="10" ry="13" fill="#fff"/><ellipse cx="82" cy="44" rx="10" ry="13" fill="#fff"/></svg><span style={{color:"#fff",fontWeight:800,fontSize:48,letterSpacing:1,position:"relative",zIndex:1}}>TF</span></div><div style={{flex:1}}><div style={{fontWeight:700,fontSize:22,letterSpacing:-0.5,color:"#1a1a2e",textAlign:"center"}}>TracForce</div><div style={{fontSize:11,color:"#94a3b8",letterSpacing:1.5,textTransform:"uppercase",whiteSpace:"nowrap",textAlign:"center"}}>Client Tracking</div><div style={{display:"flex",justifyContent:"flex-start",marginTop:4}}><img src={FRENCHIE_IMG} alt="Frenchies" style={{width:110,height:"auto",opacity:0.88}} onError={(e)=>{e.target.style.display="none"}}/></div></div></div><div style={{borderBottom:"1px solid #eef0f2",marginLeft:30,marginTop:12}}/></div>
        <div style={{padding:"14px 16px 8px"}}><div style={{fontSize:9.5,textTransform:"uppercase",letterSpacing:1,color:"#94a3b8",marginBottom:5,fontWeight:600}}>Viewing as</div><select value={role} onChange={e=>setRole(e.target.value)} style={{width:"100%",padding:"7px 10px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fafbfc",fontSize:13,fontFamily:"inherit",color:"#1a1a2e",cursor:"pointer",outline:"none"}}>{ROLE_ORDER.filter(r=>r!=="Client").map(r=><option key={r}>{r}</option>)}</select></div>
        <nav style={{padding:"8px 12px",flex:1}}>
          {[["dashboard","Dashboard","home"],["team","Team","team"],["clients","Clients","users"],["engagement","Engagement","activity"],["kpi","KPI","signal"],["acquisition","Acquisition","target"],["settings","Settings","gear"]].map(([k,l,ic])=>(
            <button key={k} onClick={()=>navTo(k)} style={{display:"flex",alignItems:"center",gap:10,width:"100%",padding:"10px 12px",borderRadius:8,border:"none",background:(sec===k&&!dialClient)?"#f0f2f5":"transparent",color:(sec===k&&!dialClient)?"#1a1a2e":"#64748b",fontWeight:(sec===k&&!dialClient)?600:400,fontSize:13.5,cursor:"pointer",fontFamily:"inherit",transition:"all 0.15s",marginBottom:2}}><Ic t={ic} s={17}/>{l}</button>
          ))}
        </nav>
        {(role==="Master"||role==="Admin")&&<div style={{padding:"0 12px 8px"}}><div style={{fontSize:9.5,textTransform:"uppercase",letterSpacing:1,color:"#94a3b8",padding:"8px 12px 4px",fontWeight:600}}>{role==="Master"?"Master Only":"Admin"}</div>{[["audit","Audit Logs","log"],...(role==="Master"?[["billing","Billing","dollar"]]:[])].map(([k,l,ic])=>(<button key={k} onClick={()=>navTo(k)} style={{display:"flex",alignItems:"center",gap:10,width:"100%",padding:"10px 12px",borderRadius:8,border:"none",background:sec===k?"#f0f2f5":"transparent",color:sec===k?"#1a1a2e":"#64748b",fontWeight:sec===k?600:400,fontSize:13.5,cursor:"pointer",fontFamily:"inherit",transition:"all 0.15s",marginBottom:2}}><Ic t={ic} s={17}/>{l}</button>))}</div>}
        <div style={{padding:"16px 20px",borderTop:"1px solid #eef0f2",fontSize:11,color:"#94a3b8"}}>TracForce v1.0</div>
        </div>
      </div>

      {/* MAIN */}
      <div style={{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",zoom:textSize}}>
        <div style={{height:58,background:"#fff",borderBottom:"1px solid #eef0f2",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 28px",flexShrink:0}}>
          <div style={{display:"flex",alignItems:"center",gap:8,padding:"7px 14px",background:"#f5f6f8",borderRadius:8,width:280}}><Ic t="search" s={15}/><input placeholder="Search..." value={q} onChange={e=>setQ(e.target.value)} style={{border:"none",background:"transparent",outline:"none",fontSize:13,fontFamily:"inherit",color:"#1a1a2e",width:"100%"}}/></div>
          <div style={{display:"flex",alignItems:"center",gap:14}}>
            {dialActive&&<div style={{display:"flex",alignItems:"center",gap:6,padding:"5px 12px",background:"#05966818",borderRadius:20,fontSize:11.5,fontWeight:600,color:"#059669"}}><span style={{width:6,height:6,borderRadius:"50%",background:"#059669"}}/> {fmtSec(dialTimer)}</div>}
            <div style={{display:"flex",alignItems:"center",gap:6,padding:"5px 12px",background:roleBg(role)+"18",borderRadius:20,fontSize:11.5,fontWeight:600,color:roleBg(role)}}><Ic t="key" s={13}/>{role}</div>
            <div style={{position:"relative"}}><div onClick={()=>setAcctDrop(!acctDrop)} style={{width:32,height:32,borderRadius:"50%",background:roleBg(role),display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer",border:acctDrop?"2px solid "+roleBg(role):"2px solid transparent",boxShadow:acctDrop?"0 0 0 3px "+roleBg(role)+"30":"none",transition:"all 0.15s"}}>{(team.find(m=>m.role===role)?.name||"SM").split(" ").map(w=>w[0]).join("").slice(0,2)}</div>{acctDrop&&<div style={{position:"absolute",top:"calc(100% + 8px)",right:0,width:240,background:"#fff",borderRadius:12,border:"1px solid #eef0f2",boxShadow:"0 12px 32px rgba(0,0,0,0.12)",zIndex:999,overflow:"hidden"}}><div style={{padding:"12px 14px",borderBottom:"1px solid #eef0f2",fontSize:10,fontWeight:700,color:"#94a3b8",textTransform:"uppercase",letterSpacing:1}}>Switch Account</div>{team.filter(m=>m.role!=="Client").map(m=>{const active=m.role===role;return <div key={m.id} onClick={()=>{setRole(m.role);setAcctDrop(false);}} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",cursor:"pointer",background:active?roleBg(m.role)+"10":"transparent",borderLeft:active?"3px solid "+roleBg(m.role):"3px solid transparent",transition:"all 0.1s"}} onMouseEnter={e=>{if(!active)e.currentTarget.style.background="#fafbfc"}} onMouseLeave={e=>{if(!active)e.currentTarget.style.background="transparent"}}><div style={{width:28,height:28,borderRadius:"50%",background:roleBg(m.role)+"20",display:"flex",alignItems:"center",justifyContent:"center",color:roleBg(m.role),fontSize:10,fontWeight:700,border:active?"2px solid "+roleBg(m.role):"2px solid transparent"}}>{m.name.split(" ").map(w=>w[0]).join("")}</div><div style={{flex:1}}><div style={{fontSize:12,fontWeight:active?700:500,color:active?"#1a1a2e":"#374151"}}>{m.name}</div><div style={{fontSize:10,color:roleBg(m.role),fontWeight:600}}>{m.role}</div></div>{active&&<div style={{width:6,height:6,borderRadius:"50%",background:roleBg(m.role)}}/> }</div>})}</div>}</div>
          </div>
        </div>

        <div style={{flex:1,overflow:"auto",padding:28}}>
          {dialClient&&<DialPage/>}

          {/* DASHBOARD */}
          {!dialClient&&sec==="dashboard"&&<div>
            <div style={{marginBottom:24}}><h1 style={{fontSize:24,fontWeight:700,margin:0,letterSpacing:-0.5}}>Dashboard</h1><p style={{color:"#94a3b8",fontSize:14,margin:"4px 0 0"}}>Overview of your client activity.</p></div>
            <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:16,marginBottom:24}}>
              {[["Total Clients",String(clients.length),"+2 this month","#3b5bdb"],["Active",String(clients.filter(c=>c.st==="Active").length),"of total","#22c55e"],["Hot Leads",String(clients.filter(c=>c.lead==="Hot").length),"high priority","#ef4444"],["Team",String(team.length),ROLE_ORDER.filter(r=>r!=="Client"&&team.some(m=>m.role===r)).length+" roles","#8b5cf6"]].map(([l,v,s,a],i)=>(
                <Card key={i} onClick={l==="Total Clients"?()=>navTo("clients"):undefined} style={{padding:"20px 22px",position:"relative",overflow:"hidden",cursor:l==="Total Clients"?"pointer":"default"}}><div style={{position:"absolute",top:0,left:0,width:"100%",height:3,background:a}}/><div style={{fontSize:11.5,color:"#94a3b8",fontWeight:500,textTransform:"uppercase",letterSpacing:0.5}}>{l}</div><div style={{fontSize:28,fontWeight:700,margin:"6px 0 2px",letterSpacing:-1}}>{v}</div><div style={{fontSize:12,color:"#64748b"}}>{s}</div></Card>
              ))}
            </div>
            <Card style={{overflow:"hidden"}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #eef0f2"}}><div style={{display:"flex",alignItems:"center"}}>
              {[["appointments","Upcoming Appointments","clock"],["recent","Recent Clients","activity"]].map(([k,l,ic])=>(<button key={k} onClick={()=>setDashTab(k)} style={{display:"flex",alignItems:"center",gap:7,padding:"13px 22px",fontSize:13.5,fontWeight:dashTab===k?600:400,color:dashTab===k?"#1a1a2e":"#94a3b8",background:"transparent",border:"none",borderBottom:dashTab===k?"2px solid #1a1a2e":"2px solid transparent",cursor:"pointer",fontFamily:"inherit",transition:"all 0.15s"}}><Ic t={ic} s={14}/>{l}</button>))}
            </div>{dashTab==="appointments"&&<button onClick={()=>openNewAppt(null)} style={{display:"flex",alignItems:"center",gap:6,padding:"7px 14px",borderRadius:8,border:"none",background:"#3b5bdb",color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer",marginRight:16,fontFamily:"inherit",transition:"all 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#2b4bc6"} onMouseLeave={e=>e.currentTarget.style.background="#3b5bdb"}><Ic t="plus" s={14}/>New</button>}</div>
              {dashTab==="appointments"&&(()=>{const upcoming=appointments.sort((a,b)=>a.date.localeCompare(b.date)||a.time.localeCompare(b.time));const apptTypeColor=t=>t==="Follow-up Call"?"#3b5bdb":t==="Product Demo"?"#7c3aed":t==="Onboarding"?"#059669":t==="Quarterly Review"?"#f59e0b":"#64748b";const apptTypeBg=t=>t==="Follow-up Call"?"#f0f4ff":t==="Product Demo"?"#f5f3ff":t==="Onboarding"?"#f0fdf4":t==="Quarterly Review"?"#fffbeb":"#f8fafc";const today=new Date();const fmt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;const todayStr=fmt(today);const tomorrowStr=fmt(new Date(today.getTime()+86400000));const dayLabel=d=>d===todayStr?"Today":d===tomorrowStr?"Tomorrow":new Date(d+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return !upcoming.length?<div style={{textAlign:"center",padding:36,color:"#94a3b8",fontSize:13}}>No upcoming appointments.</div>:upcoming.map(apt=>{const c=clients.find(x=>x.id===apt.clientId);return c?<div key={apt.id} onClick={()=>{setSel(c);setSec("clients");setTab("info")}} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"13px 22px",borderBottom:"1px solid #f5f6f8",cursor:"pointer",transition:"background 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}><div style={{display:"flex",alignItems:"center",gap:12}}><div style={{width:40,height:40,borderRadius:10,background:apptTypeBg(apt.type),display:"flex",alignItems:"center",justifyContent:"center",color:apptTypeColor(apt.type)}}><Ic t={apt.type==="Follow-up Call"?"phone":apt.type==="Product Demo"?"target":apt.type==="Onboarding"?"users":"activity"} s={17}/></div><div><div style={{fontWeight:500,fontSize:13.5}}>{c.name} <span style={{fontWeight:400,color:"#94a3b8",fontSize:12}}>— {apt.type}</span></div><div style={{fontSize:11.5,color:"#94a3b8"}}>{apt.notes}</div></div></div><div style={{display:"flex",alignItems:"center",gap:10,flexShrink:0}}><div style={{textAlign:"right"}}><div style={{fontSize:12,fontWeight:600,color:apt.date===todayStr?"#059669":apt.date===tomorrowStr?"#f59e0b":"#64748b"}}>{dayLabel(apt.date)}</div><div style={{fontSize:11,color:"#94a3b8"}}>{apt.time}</div></div><Ic t="chev" s={14}/></div></div>:null;});})()}
              {dashTab==="recent"&&(()=>{const withLastActivity=clients.map(c=>{const cNotes=(nts[c.id]||[]).map(n=>n.d);const cCalls=(cls[c.id]||[]).map(cl=>cl.d);const allDates=[c.lc,...cNotes,...cCalls].filter(Boolean);allDates.sort((a,b)=>b.localeCompare(a));return{...c,_lastActivity:allDates[0]||c.lc};});withLastActivity.sort((a,b)=>b._lastActivity.localeCompare(a._lastActivity));return withLastActivity.slice(0,4).map(c=>(<div key={c.id} onClick={()=>{setSel(c);setSec("clients");setTab("info")}} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"13px 22px",borderBottom:"1px solid #f5f6f8",cursor:"pointer",transition:"background 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}><div style={{display:"flex",alignItems:"center",gap:12}}><Avatar src={c.photo} fallback={ini(c.name)} size={34}/><div><div style={{fontWeight:500,fontSize:13.5}}>{c.name}</div><div style={{fontSize:11.5,color:"#94a3b8"}}>{c.co}</div></div></div><div style={{display:"flex",alignItems:"center",gap:10}}><LeadBadge lead={c.lead}/><span style={{width:7,height:7,borderRadius:"50%",background:stColor(c.st)}}/><span style={{fontSize:12,color:"#94a3b8"}}>{c._lastActivity}</span><Ic t="chev" s={14}/></div></div>))})()}
            </Card>
          </div>}

          {/* ENGAGEMENT */}
          {!dialClient&&sec==="engagement"&&<EngagementSection clients={clients} nts={nts} cls={cls} sales={sales} team={team} Card={Card} Avatar={Avatar} setSel={setSel} setSec={setSec} setTab={setTab}/>}

          {/* TEAM */}
          {!dialClient&&sec==="team"&&!selMember&&!viewPosts&&<div>
            <h1 style={{fontSize:22,fontWeight:700,margin:"0 0 18px",letterSpacing:-0.5}}>Team</h1>
            <div style={{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"}}>{ROLE_ORDER.filter(r=>r!=="Client").map(r=><div key={r} style={{padding:"8px 16px",borderRadius:10,background:"#fff",border:"1px solid #eef0f2",display:"flex",alignItems:"center",gap:8}}><span style={{width:8,height:8,borderRadius:"50%",background:roleBg(r)}}/><span style={{fontSize:13,fontWeight:500}}>{r}</span><span style={{fontSize:12,color:"#94a3b8",fontWeight:600}}>{team.filter(m=>m.role===r).length}</span></div>)}</div>
            <Card style={{overflow:"hidden"}}>
              <div style={{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr"+(canAssignKeys(role)?" 90px":""),padding:"11px 22px",borderBottom:"1px solid #eef0f2",fontSize:10.5,textTransform:"uppercase",letterSpacing:0.8,color:"#94a3b8",fontWeight:600}}><span>Member</span><span>Role</span><span>Phone Time</span><span>Notes</span><span>Calls</span>{canAssignKeys(role)&&<span>Actions</span>}</div>
              {team.map(m=>(<div key={m.id} onClick={()=>setSelMember(m)} style={{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr"+(canAssignKeys(role)?" 90px":""),padding:"13px 22px",borderBottom:"1px solid #f5f6f8",alignItems:"center",cursor:"pointer",transition:"background 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
                <div style={{display:"flex",alignItems:"center",gap:10}}><Avatar src={m.photo} fallback={m.avatar} color={roleBg(m.role)+"30"} size={34}/><div><div style={{fontWeight:500,fontSize:13}}>{m.name}</div><div style={{fontSize:11,color:"#94a3b8"}}>{m.email}</div></div></div>
                <span style={{fontSize:11,fontWeight:600,padding:"3px 10px",borderRadius:20,background:roleBg(m.role)+"15",color:roleBg(m.role),width:"fit-content"}}>{m.role}</span>
                <span style={{fontSize:13,color:"#64748b"}}>{m.phoneTime}h</span>
                <span style={{fontSize:13,color:"#64748b"}}>{m.noteCount}</span>
                <span style={{fontSize:13,color:"#64748b"}}>{m.callCount}</span>
                {canAssignKeys(role)&&<div style={{display:"flex",gap:6}} onClick={e=>e.stopPropagation()}>
                  {isAbove(role,m.role)&&<button onClick={()=>setAssignModal(m)} style={{padding:"4px 8px",borderRadius:6,border:"1px solid #e2e5ea",background:"#fff",fontSize:10,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}><Ic t="key" s={12}/></button>}
                  {canDeleteBelow(role,m.role)&&isAbove(role,m.role)&&<button style={{padding:"4px 8px",borderRadius:6,border:"1px solid #fecaca",background:"#fff",fontSize:10,cursor:"pointer",fontFamily:"inherit",color:"#ef4444"}}><Ic t="trash" s={12}/></button>}
                </div>}
              </div>))}
            </Card>
          </div>}

          {/* MEMBER PROFILE */}
          {!dialClient&&sec==="team"&&selMember&&!viewPosts&&<div>
            <Back label="Back to Team" onClick={()=>setSelMember(null)}/>
            <Card style={{padding:28,marginBottom:20}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}><div style={{display:"flex",alignItems:"center",gap:18}}><PhotoAvatar src={selMember.photo} fallback={selMember.avatar} color={roleBg(selMember.role)} size={72} onClick={()=>handlePhoto(selMember.id,false)}/><div><h2 style={{margin:0,fontSize:22,fontWeight:700}}>{selMember.name}</h2><div style={{display:"flex",alignItems:"center",gap:8,marginTop:5}}><span style={{fontSize:11,fontWeight:600,padding:"3px 12px",borderRadius:20,background:roleBg(selMember.role)+"15",color:roleBg(selMember.role)}}>{selMember.role}</span><span style={{fontSize:13,color:"#94a3b8"}}>{selMember.email}</span></div><div style={{fontSize:12,color:"#94a3b8",marginTop:4}}>Last active: <span style={{fontWeight:500,color:"#64748b"}}>{selMember.lastActive}</span></div></div></div>{canAssignKeys(role)&&isAbove(role,selMember.role)&&<button onClick={()=>setAssignModal(selMember)} style={{display:"flex",alignItems:"center",gap:7,padding:"9px 18px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#1a1a2e"}}><Ic t="key" s={15}/>Change Role</button>}</div></Card>
            <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:14,marginBottom:20}}><Stat label="Phone Time" val={selMember.phoneTime+"h"} icon="clock" color="#3b5bdb"/><Stat label="Notes" val={String(selMember.noteCount)} icon="note" color="#059669"/><Stat label="Calls" val={String(selMember.callCount)} icon="phone" color="#f59e0b"/><Stat label="Posts" val={String((posts[selMember.id]||[]).length)} icon="post" color="#8b5cf6"/></div>
            <Card style={{padding:"22px 26px",marginBottom:20}}><h3 style={{fontSize:15,fontWeight:600,margin:"0 0 14px"}}>Profile Information</h3><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px 36px"}}>{[["Full Name",selMember.name],["Email",selMember.email],["Phone",selMember.phone],["Role",selMember.role],["Joined",selMember.joined],["Last Active",selMember.lastActive]].map(([l,v],i)=>(<div key={i}><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:3}}>{l}</div><div style={{fontSize:14,fontWeight:500}}>{v}</div></div>))}</div></Card>
            {(()=>{const ml=clients.filter(c=>c.assignedTo===selMember.id);return <Card style={{padding:"22px 26px",marginBottom:20}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:15,fontWeight:600,margin:0}}>Assigned Leads <span style={{fontSize:12,fontWeight:400,color:"#94a3b8"}}>({ml.length})</span></h3></div>{!ml.length&&<div style={{textAlign:"center",padding:20,color:"#94a3b8",fontSize:13}}>No leads assigned.</div>}{ml.map(c=><div key={c.id} onClick={()=>{setSec("clients");setSel(c);setTab("info");setSelMember(null)}} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",borderRadius:10,border:"1px solid #eef0f2",marginBottom:6,cursor:"pointer"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}><div style={{display:"flex",alignItems:"center",gap:10}}><Avatar src={c.photo} fallback={ini(c.name)} size={28}/><div><div style={{fontWeight:500,fontSize:13}}>{c.name}</div><div style={{fontSize:11,color:"#94a3b8"}}>{c.co}</div></div></div><div style={{display:"flex",alignItems:"center",gap:8}}><LeadBadge lead={c.lead}/><span style={{fontSize:11,fontWeight:600,padding:"3px 10px",borderRadius:20,background:tBg(c.ti),color:tC(c.ti)}}>{c.ti}</span><Ic t="chev" s={12}/></div></div>)}</Card>;})()}
            <Card style={{padding:"22px 26px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:15,fontWeight:600,margin:0}}>Posts</h3>{(posts[selMember.id]||[]).length>1&&<button onClick={()=>setViewPosts(selMember.id)} style={{display:"flex",alignItems:"center",gap:5,padding:"6px 14px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#3b5bdb"}}>View All <Ic t="chev" s={12}/></button>}</div><div style={{display:"flex",gap:10,marginBottom:16}}><input value={newPost} onChange={e=>setNewPost(e.target.value)} placeholder="Write a post..." onKeyDown={e=>e.key==="Enter"&&addPost(selMember.id)} style={{flex:1,border:"1px solid #e2e5ea",borderRadius:8,padding:"9px 14px",fontSize:13,fontFamily:"inherit",outline:"none"}}/><button onClick={()=>addPost(selMember.id)} style={{padding:"9px 16px",borderRadius:8,border:"none",background:"#1a1a2e",color:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit"}}>Post</button></div>
              {!(posts[selMember.id]||[]).length&&<div style={{textAlign:"center",padding:20,color:"#94a3b8",fontSize:13}}>No posts yet.</div>}
              {(posts[selMember.id]||[]).slice(0,1).map(p=>(<div key={p.id} style={{padding:"14px 16px",borderRadius:10,background:"#fafbfc",border:"1px solid #eef0f2"}}><div style={{fontSize:11,color:"#94a3b8",marginBottom:6,fontFamily:"monospace"}}>{p.date}</div><div style={{fontSize:13.5,lineHeight:1.6,color:"#374151"}}>{p.text}</div></div>))}
            </Card>
          </div>}

          {/* POST HISTORY */}
          {!dialClient&&sec==="team"&&viewPosts&&(()=>{const m=team.find(x=>x.id===viewPosts);const mp=posts[viewPosts]||[];return <div><Back label={"Back to "+m.name} onClick={()=>setViewPosts(null)}/><div style={{display:"flex",alignItems:"center",gap:14,marginBottom:20}}><Avatar src={m.photo} fallback={m.avatar} color={roleBg(m.role)+"30"} size={40}/><div><h1 style={{fontSize:20,fontWeight:700,margin:0}}>{m.name}'s Posts</h1><div style={{fontSize:13,color:"#94a3b8"}}>{mp.length} post{mp.length!==1?"s":""}</div></div></div><div style={{display:"flex",gap:10,marginBottom:20}}><input value={newPost} onChange={e=>setNewPost(e.target.value)} placeholder="Write a new post..." onKeyDown={e=>e.key==="Enter"&&addPost(viewPosts)} style={{flex:1,border:"1px solid #e2e5ea",borderRadius:8,padding:"9px 14px",fontSize:13,fontFamily:"inherit",outline:"none",background:"#fff"}}/><button onClick={()=>addPost(viewPosts)} style={{padding:"9px 16px",borderRadius:8,border:"none",background:"#1a1a2e",color:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit"}}>Post</button></div>{mp.map(p=>(<Card key={p.id} style={{padding:"18px 22px",marginBottom:10}}><div style={{fontSize:11,color:"#94a3b8",marginBottom:8,fontFamily:"monospace"}}>{p.date}</div><div style={{fontSize:14,lineHeight:1.6,color:"#374151"}}>{p.text}</div></Card>))}{!mp.length&&<div style={{textAlign:"center",padding:40,color:"#94a3b8",fontSize:14}}>No posts yet.</div>}</div>})()}

          {/* CLIENTS LIST with Lead Group Filter + Import + Add */}
          {!dialClient&&sec==="kpi"&&(()=>{
            const now2=new Date(2026,1,25);
            const rangeD={"1d":1,"7d":7,"1m":30,"3m":90,"6m":180,"12m":365,"custom":0,"all":9999}[kpiRange]||30;
            const kpiStart=kpiRange==="custom"?(parseD(kpiFrom)||new Date(2020,0,1)):new Date(now2);if(kpiRange!=="custom")kpiStart.setDate(kpiStart.getDate()-rangeD);
            const kpiStartStr=kpiStart.toISOString().slice(0,10);
            const kpiEndStr=kpiRange==="custom"?kpiTo:"2026-02-25";
            const agents=team.filter(m=>m.role!=="Client");
            const getKpi=(member)=>{
              const sn=member.name.split(" ")[0]+" "+member.name.split(" ")[1][0]+".";
              let totalCalls=0,totalMins=0,inbound=0,outbound=0,reached=0;
              Object.values(cls).forEach(arr=>arr.forEach(c=>{if(c.ag===sn&&c.d>=kpiStartStr&&c.d<=kpiEndStr){totalCalls++;const pts=c.dur.split(":");totalMins+=parseInt(pts[0]||0)+(parseInt(pts[1]||0)/60);if(c.ty==="Inbound")inbound++;else outbound++;if(c.rc)reached++;}}));
              let totalNotes=0;Object.values(nts).forEach(arr=>arr.forEach(n=>{if(n.a===sn&&n.d>=kpiStartStr&&n.d<=kpiEndStr)totalNotes++;}));
              let totalSales=0,totalRev=0;Object.values(sales).forEach(arr=>arr.forEach(s=>{if(s.ag===sn&&s.d>=kpiStartStr&&s.d<=kpiEndStr){totalSales++;totalRev+=s.amt;}}));
              const assignedClients=clients.filter(c=>c.assignedTo===member.id).length;
              const reachRate=totalCalls>0?Math.round(reached/totalCalls*100):0;
              return{totalCalls,totalMins:Math.round(totalMins*10)/10,inbound,outbound,reached,reachRate,totalNotes,totalSales,totalRev,assignedClients};
            };
            const teamKpi=agents.map(m=>({...m,kpi:getKpi(m)}));
            const totals={calls:teamKpi.reduce((s,m)=>s+m.kpi.totalCalls,0),mins:Math.round(teamKpi.reduce((s,m)=>s+m.kpi.totalMins,0)*10)/10,notes:teamKpi.reduce((s,m)=>s+m.kpi.totalNotes,0),sales:teamKpi.reduce((s,m)=>s+m.kpi.totalSales,0),rev:teamKpi.reduce((s,m)=>s+m.kpi.totalRev,0),reached:teamKpi.reduce((s,m)=>s+m.kpi.reached,0)};
            const reachRate=totals.calls>0?Math.round(totals.reached/totals.calls*100):0;
            const selM=kpiMember?teamKpi.find(m=>m.id===kpiMember):null;
            const fmtRev=v=>"$"+v.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0});
            const fmtHrs=v=>{const h=Math.floor(v/60);const m=Math.round(v%60);return h>0?h+"h "+m+"m":m+"m";};
            const StatBox=({label,value,sub,color,icon})=><Card style={{padding:"18px 22px"}}><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:8}}><div style={{width:32,height:32,borderRadius:8,background:color+"18",display:"flex",alignItems:"center",justifyContent:"center",color}}><Ic t={icon} s={16}/></div><span style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600}}>{label}</span></div><div style={{fontSize:26,fontWeight:700,color:"#1a1a2e"}}>{value}</div>{sub&&<div style={{fontSize:12,color:"#64748b",marginTop:2}}>{sub}</div>}</Card>;
            const BarRow=({label,value,max,color})=><div style={{display:"flex",alignItems:"center",gap:12,padding:"8px 0"}}><span style={{fontSize:12,fontWeight:500,width:100,flexShrink:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{label}</span><div style={{flex:1,height:22,background:"#f5f6f8",borderRadius:6,overflow:"hidden"}}><div style={{height:"100%",background:color,borderRadius:6,width:max>0?(value/max*100)+"%":"0%",transition:"width 0.3s"}}/></div><span style={{fontSize:12,fontWeight:700,width:50,textAlign:"right",flexShrink:0}}>{value}</span></div>;
            return <div>
              <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20}}>
                <div style={{display:"flex",alignItems:"center",gap:10}}>
                  {selM&&<Back label="Team KPI" onClick={()=>setKpiMember(null)}/>}
                  {!selM&&<><div style={{width:32,height:32,borderRadius:8,background:"linear-gradient(135deg, #3b5bdb 0%, #059669 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"}}><Ic t="signal" s={16}/></div><h1 style={{fontSize:22,fontWeight:700,margin:0}}>Key Performance Indicators</h1></>}
                  {selM&&<div style={{display:"flex",alignItems:"center",gap:10}}><Avatar src={selM.photo} fallback={selM.avatar} color={roleBg(selM.role)+"30"} size={36}/><div><h1 style={{fontSize:20,fontWeight:700,margin:0}}>{selM.name}</h1><div style={{fontSize:12,color:roleBg(selM.role),fontWeight:600}}>{selM.role}</div></div></div>}
                </div>
                <div style={{position:"relative"}}><button onClick={()=>{setKpiDrop(!kpiDrop);setKpiCustomView(false);}} style={{display:"flex",alignItems:"center",gap:6,padding:"7px 14px",borderRadius:8,border:kpiDrop?"2px solid #3b5bdb":"1px solid #e2e5ea",background:kpiDrop?"#f0f4ff":"#fff",fontSize:12,fontWeight:600,color:kpiDrop?"#3b5bdb":"#374151",cursor:"pointer",fontFamily:"inherit"}}><Ic t="clock" s={13}/>{kpiRange==="custom"?kpiFrom+" → "+kpiTo:{"1d":"1 Day","7d":"7 Days","1m":"1 Month","3m":"3 Months","6m":"6 Months","12m":"1 Year","all":"All Time"}[kpiRange]||"1 Month"}<span style={{transform:kpiDrop?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",display:"inline-flex"}}><Ic t="chev" s={11}/></span></button>{kpiDrop&&<><div onClick={()=>{setKpiDrop(false);setKpiCustomView(false);}} style={{position:"fixed",inset:0,zIndex:98}}/><div style={{position:"absolute",top:"calc(100% + 4px)",right:0,width:kpiCustomView?340:200,background:"#fff",borderRadius:10,border:"1px solid #eef0f2",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",zIndex:99}}>{!kpiCustomView&&<div style={{padding:4}}>{[["1d","1 Day"],["7d","7 Days"],["1m","1 Month"],["3m","3 Months"],["6m","6 Months"],["12m","1 Year"],["all","All Time"]].map(([k,l])=><button key={k} onClick={()=>{setKpiRange(k);setKpiDrop(false);}} style={{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",border:"none",background:kpiRange===k?"#f0f4ff":"transparent",color:kpiRange===k?"#3b5bdb":"#374151",fontSize:12,fontWeight:kpiRange===k?600:400,cursor:"pointer",fontFamily:"inherit",borderRadius:6}} onMouseEnter={e=>{if(kpiRange!==k)e.currentTarget.style.background="#f8f9fb"}} onMouseLeave={e=>{if(kpiRange!==k)e.currentTarget.style.background="transparent"}}>{l}{kpiRange===k&&<Ic t="check" s={12}/>}</button>)}<div style={{borderTop:"1px solid #eef0f2",margin:"4px 0"}}/><button onClick={()=>setKpiCustomView(true)} style={{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",border:"none",background:kpiRange==="custom"?"#f0f4ff":"transparent",color:kpiRange==="custom"?"#3b5bdb":"#374151",fontSize:12,fontWeight:kpiRange==="custom"?600:400,cursor:"pointer",fontFamily:"inherit",borderRadius:6}} onMouseEnter={e=>e.currentTarget.style.background="#f8f9fb"} onMouseLeave={e=>e.currentTarget.style.background=kpiRange==="custom"?"#f0f4ff":"transparent"}>Custom Range<Ic t="chev" s={10}/></button></div>}{kpiCustomView&&<div style={{padding:16}}><button onClick={()=>setKpiCustomView(false)} style={{display:"flex",alignItems:"center",gap:4,border:"none",background:"none",color:"#64748b",fontSize:11,cursor:"pointer",fontFamily:"inherit",padding:0,marginBottom:12}}><span style={{transform:"rotate(180deg)",display:"inline-flex"}}><Ic t="chev" s={10}/></span>Back</button><div style={{fontSize:13,fontWeight:700,marginBottom:12}}>Choose Date Range</div><div style={{display:"flex",gap:12,marginBottom:14}}><CalendarPicker value={kpiFrom} onChange={setKpiFrom} label="From"/><CalendarPicker value={kpiTo} onChange={setKpiTo} label="To"/></div><button onClick={()=>{setKpiRange("custom");setKpiDrop(false);setKpiCustomView(false);}} style={{width:"100%",padding:"8px 0",borderRadius:8,border:"none",background:"#3b5bdb",color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit"}} onMouseEnter={e=>e.currentTarget.style.background="#2f4ec4"} onMouseLeave={e=>e.currentTarget.style.background="#3b5bdb"}>Apply Range</button></div>}</div></>}</div>
              </div>

              {!selM&&<><div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:14,marginBottom:20}}>
                <StatBox label="Total Calls" value={totals.calls} sub={reachRate+"% reach rate"} color="#3b5bdb" icon="phone"/>
                <StatBox label="Phone Time" value={fmtHrs(totals.mins)} sub={Math.round(totals.mins/Math.max(totals.calls,1))+"m avg/call"} color="#0891b2" icon="clock"/>
                <StatBox label="Sales" value={totals.sales} sub={fmtRev(totals.rev)+" revenue"} color="#059669" icon="dollar"/>
                <StatBox label="Notes" value={totals.notes} sub={agents.length+" active agents"} color="#7c3aed" icon="note"/>
              </div>

              {(()=>{
                const pipeline=[
                  {label:"Active",id:"active",color:"#3b5bdb"},
                  {label:"New",id:"new",color:"#0891b2"},
                  {label:"Pending",id:"pending",color:"#f59e0b"},
                  {label:"Sold",id:"sold",color:"#059669"},
                  {label:"Cancelled",id:"cancelled",color:"#ef4444"},
                  {label:"Past",id:"past",color:"#94a3b8"}
                ];
                const pipeData=pipeline.map(p=>{
                  let count=0,rev=0;
                  if(p.id==="active")clients.forEach(c=>{if(!c.listTag&&c.lead!=="DNC"){count++;rev+=(sales[c.id]||[]).filter(x=>x.d>=kpiStartStr&&x.d<=kpiEndStr).reduce((s,x)=>s+x.amt,0);}});
                  else clients.forEach(c=>{if(c.listTag===p.id){count++;rev+=(sales[c.id]||[]).filter(x=>x.d>=kpiStartStr&&x.d<=kpiEndStr).reduce((s,x)=>s+x.amt,0);}});
                  return {...p,count,rev};
                }).filter(p=>p.count>0);
                const totalPipeCount=pipeData.reduce((s,p)=>s+p.count,0);
                const totalPipeRev=pipeData.reduce((s,p)=>s+p.rev,0);
                const PieChart=({data,total,valueKey,fmt,size=180})=>{
                  if(!total)return <div style={{width:size,height:size,display:"flex",alignItems:"center",justifyContent:"center",color:"#cbd5e1",fontSize:12}}>No data</div>;
                  let cum=0;
                  const slices=data.map(d=>{const pct=d[valueKey]/total;const start=cum;cum+=pct;return {...d,pct,start};});
                  const r=size/2-4;const cx=size/2;const cy=size/2;
                  const arc=(startAngle,endAngle)=>{const s=startAngle*2*Math.PI-Math.PI/2;const e=endAngle*2*Math.PI-Math.PI/2;const lg=endAngle-startAngle>0.5?1:0;return `M ${cx+r*Math.cos(s)} ${cy+r*Math.sin(s)} A ${r} ${r} 0 ${lg} 1 ${cx+r*Math.cos(e)} ${cy+r*Math.sin(e)} L ${cx} ${cy} Z`;};
                  return <svg width={size} height={size} style={{display:"block"}}>
                    {slices.length===1?<circle cx={cx} cy={cy} r={r} fill={slices[0].color}/>:slices.map((sl,i)=>sl.pct>0.001&&<path key={i} d={arc(sl.start,sl.start+sl.pct-0.003)} fill={sl.color} stroke="#fff" strokeWidth={2}/>)}
                    <circle cx={cx} cy={cy} r={r*0.55} fill="#fff"/>
                    <text x={cx} y={cy-6} textAnchor="middle" fontSize={18} fontWeight="700" fill="#1a1a2e">{fmt(total)}</text>
                    <text x={cx} y={cy+10} textAnchor="middle" fontSize={10} fill="#94a3b8">Total</text>
                  </svg>;
                };
                const Legend=({data,total,valueKey,fmt})=><div style={{display:"flex",flexDirection:"column",gap:6,flex:1}}>{data.map(d=><div key={d.id} style={{display:"flex",alignItems:"center",gap:10,padding:"6px 10px",borderRadius:8,background:d.color+"08"}}><div style={{width:10,height:10,borderRadius:3,background:d.color,flexShrink:0}}/><span style={{fontSize:12,fontWeight:500,flex:1}}>{d.label}</span><span style={{fontSize:12,fontWeight:700,color:d.color}}>{fmt(d[valueKey])}</span><span style={{fontSize:10,color:"#94a3b8"}}>{total>0?Math.round(d[valueKey]/total*100):0}%</span></div>)}</div>;
                return <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,marginBottom:20}}>
                  <Card style={{padding:"22px 26px"}}><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:16}}><div style={{width:28,height:28,borderRadius:8,background:"#3b5bdb18",display:"flex",alignItems:"center",justifyContent:"center",color:"#3b5bdb"}}><Ic t="users" s={14}/></div><span style={{fontSize:14,fontWeight:700}}>Pipeline by Status</span></div>
                    <div style={{display:"flex",alignItems:"center",gap:24}}>
                      <PieChart data={pipeData} total={totalPipeCount} valueKey="count" fmt={v=>String(v)} size={170}/>
                      <Legend data={pipeData} total={totalPipeCount} valueKey="count" fmt={v=>String(v)}/>
                    </div>
                  </Card>
                  <Card style={{padding:"22px 26px"}}><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:16}}><div style={{width:28,height:28,borderRadius:8,background:"#05966918",display:"flex",alignItems:"center",justifyContent:"center",color:"#059669"}}><Ic t="dollar" s={14}/></div><span style={{fontSize:14,fontWeight:700}}>Revenue by Status</span></div>
                    <div style={{display:"flex",alignItems:"center",gap:24}}>
                      <PieChart data={pipeData.filter(d=>d.rev>0)} total={totalPipeRev} valueKey="rev" fmt={v=>fmtRev(v)} size={170}/>
                      <Legend data={pipeData.filter(d=>d.rev>0)} total={totalPipeRev} valueKey="rev" fmt={v=>fmtRev(v)}/>
                    </div>
                  </Card>
                </div>;
              })()}

              <Card style={{overflow:"hidden",marginBottom:20}}>
                <div style={{padding:"14px 20px",borderBottom:"1px solid #eef0f2",display:"flex",alignItems:"center",gap:8}}><Ic t="users" s={15}/><span style={{fontSize:14,fontWeight:700}}>Team Performance</span></div>
                <div style={{display:"grid",gridTemplateColumns:"1.6fr 0.7fr 0.7fr 0.7fr 0.7fr 0.7fr 0.5fr",padding:"10px 20px",fontSize:9.5,textTransform:"uppercase",letterSpacing:0.8,color:"#94a3b8",fontWeight:600,borderBottom:"1px solid #f5f6f8"}}><span>Agent</span><span style={{textAlign:"center"}}>Calls</span><span style={{textAlign:"center"}}>Phone Time</span><span style={{textAlign:"center"}}>Sales</span><span style={{textAlign:"center"}}>Revenue</span><span style={{textAlign:"center"}}>Notes</span><span style={{textAlign:"center"}}>Reach %</span></div>
                {teamKpi.sort((a,b)=>b.kpi.totalCalls-a.kpi.totalCalls).map(m=>(<div key={m.id} onClick={()=>setKpiMember(m.id)} style={{display:"grid",gridTemplateColumns:"1.6fr 0.7fr 0.7fr 0.7fr 0.7fr 0.7fr 0.5fr",padding:"13px 20px",borderBottom:"1px solid #f5f6f8",alignItems:"center",cursor:"pointer",transition:"background 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
                  <div style={{display:"flex",alignItems:"center",gap:10}}><Avatar src={m.photo} fallback={m.avatar} color={roleBg(m.role)+"30"} size={32}/><div><div style={{fontWeight:600,fontSize:13}}>{m.name}</div><div style={{fontSize:11,color:roleBg(m.role)}}>{m.role}</div></div></div>
                  <div style={{textAlign:"center",fontWeight:700,fontSize:14,color:"#3b5bdb"}}>{m.kpi.totalCalls}</div>
                  <div style={{textAlign:"center",fontSize:12,fontWeight:600,color:"#0891b2"}}>{fmtHrs(m.kpi.totalMins)}</div>
                  <div style={{textAlign:"center",fontWeight:700,fontSize:14,color:"#059669"}}>{m.kpi.totalSales}</div>
                  <div style={{textAlign:"center",fontSize:12,fontWeight:600,color:"#059669"}}>{fmtRev(m.kpi.totalRev)}</div>
                  <div style={{textAlign:"center",fontSize:13,fontWeight:600,color:"#7c3aed"}}>{m.kpi.totalNotes}</div>
                  <div style={{textAlign:"center"}}><span style={{fontSize:11,fontWeight:700,padding:"3px 8px",borderRadius:10,background:m.kpi.reachRate>=70?"#f0fdf4":m.kpi.reachRate>=40?"#fffbeb":"#fef2f2",color:m.kpi.reachRate>=70?"#059669":m.kpi.reachRate>=40?"#f59e0b":"#ef4444"}}>{m.kpi.reachRate}%</span></div>
                </div>))}
              </Card>

              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14}}>
                <Card style={{padding:"18px 22px"}}><div style={{fontSize:13,fontWeight:700,marginBottom:14}}>Calls by Agent</div>{teamKpi.sort((a,b)=>b.kpi.totalCalls-a.kpi.totalCalls).map(m=><BarRow key={m.id} label={m.name.split(" ")[0]} value={m.kpi.totalCalls} max={Math.max(...teamKpi.map(x=>x.kpi.totalCalls),1)} color="#3b5bdb"/>)}</Card>
                <Card style={{padding:"18px 22px"}}><div style={{fontSize:13,fontWeight:700,marginBottom:14}}>Revenue by Agent</div>{teamKpi.sort((a,b)=>b.kpi.totalRev-a.kpi.totalRev).map(m=><BarRow key={m.id} label={m.name.split(" ")[0]} value={fmtRev(m.kpi.totalRev)} max={Math.max(...teamKpi.map(x=>x.kpi.totalRev),1)} color="#059669"/>)}</Card>
              </div></>}

              {selM&&<><div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:14,marginBottom:20}}>
                <StatBox label="Calls Made" value={selM.kpi.totalCalls} sub={selM.kpi.inbound+" in / "+selM.kpi.outbound+" out"} color="#3b5bdb" icon="phone"/>
                <StatBox label="Phone Time" value={fmtHrs(selM.kpi.totalMins)} sub={selM.kpi.totalCalls>0?Math.round(selM.kpi.totalMins/selM.kpi.totalCalls)+"m avg":"—"} color="#0891b2" icon="clock"/>
                <StatBox label="Sales Closed" value={selM.kpi.totalSales} sub={fmtRev(selM.kpi.totalRev)+" revenue"} color="#059669" icon="dollar"/>
                <StatBox label="Reach Rate" value={selM.kpi.reachRate+"%"} sub={selM.kpi.reached+" of "+selM.kpi.totalCalls+" reached"} color={selM.kpi.reachRate>=70?"#059669":selM.kpi.reachRate>=40?"#f59e0b":"#ef4444"} icon="phone"/>
              </div>

              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,marginBottom:20}}>
                <Card style={{padding:"18px 22px"}}><div style={{fontSize:13,fontWeight:700,marginBottom:14}}>Call Breakdown</div>
                  <div style={{display:"flex",gap:20,marginBottom:16}}>
                    <div style={{textAlign:"center",flex:1,padding:"14px",borderRadius:10,background:"#f0f4ff"}}><div style={{fontSize:22,fontWeight:700,color:"#3b5bdb"}}>{selM.kpi.outbound}</div><div style={{fontSize:11,color:"#64748b",marginTop:2}}>Outbound</div></div>
                    <div style={{textAlign:"center",flex:1,padding:"14px",borderRadius:10,background:"#f0fafe"}}><div style={{fontSize:22,fontWeight:700,color:"#0891b2"}}>{selM.kpi.inbound}</div><div style={{fontSize:11,color:"#64748b",marginTop:2}}>Inbound</div></div>
                    <div style={{textAlign:"center",flex:1,padding:"14px",borderRadius:10,background:"#f0fdf4"}}><div style={{fontSize:22,fontWeight:700,color:"#059669"}}>{selM.kpi.reached}</div><div style={{fontSize:11,color:"#64748b",marginTop:2}}>Reached</div></div>
                  </div>
                </Card>
                <Card style={{padding:"18px 22px"}}><div style={{fontSize:13,fontWeight:700,marginBottom:14}}>Activity Summary</div>
                  <div style={{display:"flex",flexDirection:"column",gap:8}}>
                    <div style={{display:"flex",justifyContent:"space-between",padding:"10px 14px",borderRadius:8,background:"#f8fafc"}}><span style={{fontSize:12,color:"#64748b"}}>Assigned Clients</span><span style={{fontSize:13,fontWeight:700}}>{selM.kpi.assignedClients}</span></div>
                    <div style={{display:"flex",justifyContent:"space-between",padding:"10px 14px",borderRadius:8,background:"#f8fafc"}}><span style={{fontSize:12,color:"#64748b"}}>Notes Written</span><span style={{fontSize:13,fontWeight:700,color:"#7c3aed"}}>{selM.kpi.totalNotes}</span></div>
                    <div style={{display:"flex",justifyContent:"space-between",padding:"10px 14px",borderRadius:8,background:"#f8fafc"}}><span style={{fontSize:12,color:"#64748b"}}>Avg Call Length</span><span style={{fontSize:13,fontWeight:700,color:"#0891b2"}}>{selM.kpi.totalCalls>0?Math.round(selM.kpi.totalMins/selM.kpi.totalCalls)+"m":"—"}</span></div>
                    <div style={{display:"flex",justifyContent:"space-between",padding:"10px 14px",borderRadius:8,background:"#f0fdf4"}}><span style={{fontSize:12,color:"#64748b"}}>Revenue Generated</span><span style={{fontSize:13,fontWeight:700,color:"#059669"}}>{fmtRev(selM.kpi.totalRev)}</span></div>
                  </div>
                </Card>
              </div>

              {(()=>{
                const agPipeline=[
                  {label:"Active",id:"active",color:"#3b5bdb"},
                  {label:"New",id:"new",color:"#0891b2"},
                  {label:"Pending",id:"pending",color:"#f59e0b"},
                  {label:"Sold",id:"sold",color:"#059669"},
                  {label:"Cancelled",id:"cancelled",color:"#ef4444"},
                  {label:"Past",id:"past",color:"#94a3b8"}
                ];
                const myClients=clients.filter(c=>c.assignedTo===selM.id);
                const agPipeData=agPipeline.map(p=>{
                  let count=0,rev=0;
                  if(p.id==="active")myClients.forEach(c=>{if(!c.listTag&&c.lead!=="DNC"){count++;rev+=(sales[c.id]||[]).filter(x=>x.d>=kpiStartStr&&x.d<=kpiEndStr).reduce((s,x)=>s+x.amt,0);}});
                  else myClients.forEach(c=>{if(c.listTag===p.id){count++;rev+=(sales[c.id]||[]).filter(x=>x.d>=kpiStartStr&&x.d<=kpiEndStr).reduce((s,x)=>s+x.amt,0);}});
                  return {...p,count,rev};
                }).filter(p=>p.count>0);
                const agTotCount=agPipeData.reduce((s,p)=>s+p.count,0);
                const agTotRev=agPipeData.reduce((s,p)=>s+p.rev,0);
                const PieChart2=({data,total,valueKey,fmt,size=150})=>{
                  if(!total)return <div style={{width:size,height:size,display:"flex",alignItems:"center",justifyContent:"center",color:"#cbd5e1",fontSize:12}}>No data</div>;
                  let cum=0;
                  const slices=data.map(d=>{const pct=d[valueKey]/total;const start=cum;cum+=pct;return {...d,pct,start};});
                  const r=size/2-4;const ccx=size/2;const ccy=size/2;
                  const arc2=(startAngle,endAngle)=>{const s=startAngle*2*Math.PI-Math.PI/2;const e=endAngle*2*Math.PI-Math.PI/2;const lg=endAngle-startAngle>0.5?1:0;return `M ${ccx+r*Math.cos(s)} ${ccy+r*Math.sin(s)} A ${r} ${r} 0 ${lg} 1 ${ccx+r*Math.cos(e)} ${ccy+r*Math.sin(e)} L ${ccx} ${ccy} Z`;};
                  return <svg width={size} height={size} style={{display:"block"}}>
                    {slices.length===1?<circle cx={ccx} cy={ccy} r={r} fill={slices[0].color}/>:slices.map((sl,i)=>sl.pct>0.001&&<path key={i} d={arc2(sl.start,sl.start+sl.pct-0.003)} fill={sl.color} stroke="#fff" strokeWidth={2}/>)}
                    <circle cx={ccx} cy={ccy} r={r*0.55} fill="#fff"/>
                    <text x={ccx} y={ccy-4} textAnchor="middle" fontSize={16} fontWeight="700" fill="#1a1a2e">{fmt(total)}</text>
                    <text x={ccx} y={ccy+10} textAnchor="middle" fontSize={9} fill="#94a3b8">Total</text>
                  </svg>;
                };
                return <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,marginBottom:20}}>
                  <Card style={{padding:"18px 22px"}}><div style={{fontSize:13,fontWeight:700,marginBottom:14}}>My Pipeline</div>
                    <div style={{display:"flex",alignItems:"center",gap:20}}>
                      <PieChart2 data={agPipeData} total={agTotCount} valueKey="count" fmt={v=>String(v)}/>
                      <div style={{display:"flex",flexDirection:"column",gap:5,flex:1}}>{agPipeData.map(d=><div key={d.id} style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:8,height:8,borderRadius:2,background:d.color,flexShrink:0}}/><span style={{fontSize:11,flex:1}}>{d.label}</span><span style={{fontSize:11,fontWeight:700,color:d.color}}>{d.count}</span></div>)}</div>
                    </div>
                  </Card>
                  <Card style={{padding:"18px 22px"}}><div style={{fontSize:13,fontWeight:700,marginBottom:14}}>My Revenue Split</div>
                    <div style={{display:"flex",alignItems:"center",gap:20}}>
                      <PieChart2 data={agPipeData.filter(d=>d.rev>0)} total={agTotRev} valueKey="rev" fmt={v=>fmtRev(v)}/>
                      <div style={{display:"flex",flexDirection:"column",gap:5,flex:1}}>{agPipeData.filter(d=>d.rev>0).map(d=><div key={d.id} style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:8,height:8,borderRadius:2,background:d.color,flexShrink:0}}/><span style={{fontSize:11,flex:1}}>{d.label}</span><span style={{fontSize:11,fontWeight:700,color:d.color}}>{fmtRev(d.rev)}</span></div>)}</div>
                    </div>
                  </Card>
                </div>;
              })()}

              <Card style={{overflow:"hidden"}}><div style={{padding:"14px 20px",borderBottom:"1px solid #eef0f2",fontSize:13,fontWeight:700}}>Recent Sales</div>
                {(()=>{const sn=selM.name.split(" ")[0]+" "+selM.name.split(" ")[1][0]+".";const ms=[];Object.entries(sales).forEach(([cid,arr])=>arr.forEach(s=>{if(s.ag===sn&&s.d>=kpiStartStr&&s.d<=kpiEndStr){const cl=clients.find(x=>x.id===Number(cid));ms.push({...s,client:cl?cl.name:"Unknown"});}}));ms.sort((a,b)=>b.d.localeCompare(a.d));return ms.length?ms.slice(0,10).map(s=>(<div key={s.id} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 20px",borderBottom:"1px solid #f5f6f8"}}><div><div style={{fontSize:13,fontWeight:600}}>{s.product||"Untitled"}</div><div style={{fontSize:11,color:"#94a3b8"}}>{s.client} · {s.d}</div></div><span style={{fontSize:14,fontWeight:700,color:"#059669"}}>{fmtRev(s.amt)}</span></div>)):<div style={{padding:24,textAlign:"center",color:"#94a3b8",fontSize:13}}>No sales in this period.</div>;})()}
              </Card></>}
            </div>;
          })()}

          {!dialClient&&sec==="clients"&&!sel&&<div>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14}}>
              <h1 style={{fontSize:22,fontWeight:700,margin:0,letterSpacing:-0.5}}>Client Tracking</h1>
              <div style={{display:"flex",gap:8}}>
                <button onClick={()=>setUploadMyLeadsModal(true)} style={{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151",transition:"all 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="#fff"}><Ic t="assign" s={14}/>Upload My Leads</button>
                <button onClick={()=>setImportModal(true)} style={{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151",transition:"all 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="#fff"}><Ic t="upload" s={14}/>Import</button>
                <button onClick={exportCSV} style={{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151",transition:"all 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="#fff"}><Ic t="download" s={14}/>Export CSV</button>
                <button onClick={()=>{setNewCl({name:"",co:"",em:"",ph:"",ti:"Pro",lead:"Warm",dest:"Main Database",listTag:listFilter.length===1&&listFilter[0]!=="dnc"?listFilter[0]:null});setAddClientModal(true)}} style={{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",borderRadius:8,border:"none",background:"#1a1a2e",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#fff"}}><Ic t="plus" s={14}/>Add Client</button>
              </div>
            </div>

            {/* Lists */}
            <div style={{marginBottom:16}}>
              <div style={{fontSize:10,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.8,marginBottom:8}}>Lists</div>
              <div style={{display:"flex",gap:10}}>
                {DB_LISTS.map(db=>{const isActive=activeList===db.id;const cnt=clients.filter(c=>{const inDb=db.dests.includes(c.dest);const myL=!myLeads||c.assignedTo===curUserId;return inDb&&myL;}).length;return(
                  <button key={db.id} onClick={()=>{setActiveList(isActive?null:db.id);setLeadFilter("All");}} style={{flex:1,display:"flex",alignItems:"center",gap:10,padding:"12px 16px",borderRadius:10,border:isActive?`2px solid ${db.color}`:"1px solid #eef0f2",background:isActive?db.color+"08":"#fff",cursor:"pointer",fontFamily:"inherit",transition:"all 0.15s",position:"relative",overflow:"hidden"}} onMouseEnter={e=>{if(!isActive)e.currentTarget.style.borderColor=db.color+"60"}} onMouseLeave={e=>{if(!isActive)e.currentTarget.style.borderColor="#eef0f2"}}>
                    {isActive&&<div style={{position:"absolute",top:0,left:0,width:"100%",height:3,background:db.color}}/>}
                    <div style={{width:34,height:34,borderRadius:9,background:db.color+(isActive?"20":"10"),display:"flex",alignItems:"center",justifyContent:"center",color:db.color,flexShrink:0}}><Ic t={db.icon} s={16}/></div>
                    <div style={{textAlign:"left",flex:1,minWidth:0}}>
                      <div style={{fontSize:13,fontWeight:isActive?700:500,color:isActive?db.color:"#374151",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{db.name}</div>
                      <div style={{fontSize:11,color:"#94a3b8",marginTop:1}}>{cnt} client{cnt!==1?"s":""}</div>
                    </div>
                    {isActive&&<div style={{width:8,height:8,borderRadius:"50%",background:db.color,flexShrink:0}}/>}
                  </button>
                );})}
              </div>
            </div>



            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14}}>
              <div style={{display:"flex",gap:6,alignItems:"center"}}>
                {["All","Hot","Warm","Cold","DNC"].map(l=>(
                  <button key={l} onClick={()=>setLeadFilter(l)} style={{display:"flex",alignItems:"center",gap:4,padding:"6px 14px",borderRadius:8,border:leadFilter===l?`2px solid ${l==="All"?(activeList?DB_LISTS.find(d=>d.id===activeList)?.color:"#1a1a2e"):leadColor(l)}`:"1px solid #e2e5ea",background:leadFilter===l?(l==="All"?"#f0f2f5":leadBg(l)):"#fff",fontSize:12,fontWeight:leadFilter===l?600:400,color:leadFilter===l?(l==="All"?(activeList?DB_LISTS.find(d=>d.id===activeList)?.color:"#1a1a2e"):leadColor(l)):"#94a3b8",cursor:"pointer",fontFamily:"inherit",transition:"all 0.15s"}}>
                    {l==="Hot"&&<Ic t="flame" s={12}/>}{l}{l!=="All"&&<span style={{fontSize:10,fontWeight:600,marginLeft:2}}>({clients.filter(c=>{const ml2=c.lead===l;const dl2=!activeList||DB_LISTS.find(d=>d.id===activeList)?.dests.includes(c.dest);const myL2=!myLeads||c.assignedTo===curUserId;return ml2&&dl2&&myL2;}).length})</span>}
                  </button>
                ))}
                <div style={{width:1,height:20,background:"#e2e5ea",margin:"0 2px"}}/>
                <button onClick={()=>{setMyLeads(!myLeads);setLeadFilter("All");}} style={{display:"flex",alignItems:"center",gap:5,padding:"6px 14px",borderRadius:8,border:myLeads?"1px solid #1a1a2e":"1px solid #e2e5ea",background:myLeads?"#1a1a2e":"#fff",fontSize:12,fontWeight:myLeads?600:400,color:myLeads?"#fff":"#94a3b8",cursor:"pointer",fontFamily:"inherit",transition:"all 0.15s",flexShrink:0,boxShadow:myLeads?"inset 0 0 0 1px #1a1a2e":"none"}}><Ic t="team" s={13}/>My Leads{(()=>{const cnt=clients.filter(c=>{const myL2=c.assignedTo===curUserId;const dl2=!activeList||DB_LISTS.find(d=>d.id===activeList)?.dests.includes(c.dest);return myL2&&dl2;}).length;return <span style={{fontSize:10,fontWeight:600,marginLeft:2}}>({cnt})</span>;})()}</button>
                <div style={{width:1,height:20,background:"#e2e5ea",margin:"0 2px"}}/>
                <div style={{position:"relative"}}><button onClick={()=>setListDrop(!listDrop)} style={{display:"flex",alignItems:"center",gap:5,padding:"6px 14px",borderRadius:8,border:listFilter.length?"2px solid #3b5bdb":"1px solid #e2e5ea",background:listFilter.length?"#f0f4ff":"#fff",fontSize:12,fontWeight:listFilter.length?600:400,color:listFilter.length?"#3b5bdb":"#94a3b8",cursor:"pointer",fontFamily:"inherit",transition:"all 0.15s",flexShrink:0}}>{listFilter.length?<>{listFilter.length===1?(()=>{const all=[...BUILT_IN_LISTS,...customLists];const f=all.find(x=>x.id===listFilter[0]);return f?f.name:listFilter[0];})():listFilter.length+" lists"}</>:"⋯"}</button>{listDrop&&<><div onClick={()=>setListDrop(false)} style={{position:"fixed",inset:0,zIndex:98}}/><div style={{position:"absolute",top:"calc(100% + 4px)",right:0,width:220,background:"#fff",borderRadius:10,border:"1px solid #eef0f2",boxShadow:"0 8px 24px rgba(0,0,0,0.1)",zIndex:99,overflow:"hidden"}}><div onClick={()=>{setListFilter([]);if(leadFilter==="DNC")setLeadFilter("All");}} style={{padding:"10px 14px",fontSize:12,fontWeight:600,cursor:"pointer",background:!listFilter.length?"#f0f2f5":"transparent",color:!listFilter.length?"#1a1a2e":"#64748b",borderBottom:"1px solid #f5f6f8"}} onMouseEnter={e=>{if(listFilter.length)e.currentTarget.style.background="#fafbfc"}} onMouseLeave={e=>{if(listFilter.length)e.currentTarget.style.background="transparent"}}>All Lists</div>{BUILT_IN_LISTS.map(bl=>{const cnt=bl.id==="dnc"?clients.filter(c=>c.lead==="DNC").length:clients.filter(c=>c.listTag===bl.id).length;const isOn=listFilter.includes(bl.id);return <div key={bl.id} onClick={()=>{if(isOn){const nf=listFilter.filter(f=>f!==bl.id);setListFilter(nf);if(bl.id==="dnc"&&leadFilter==="DNC")setLeadFilter("All");}else{setListFilter([...listFilter,bl.id]);if(bl.id==="dnc")setLeadFilter("DNC");}}} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",cursor:"pointer",background:isOn?bl.color+"12":"transparent",borderLeft:isOn?"3px solid "+bl.color:"3px solid transparent",borderBottom:"1px solid #f5f6f8"}} onMouseEnter={e=>{if(!isOn)e.currentTarget.style.background="#fafbfc"}} onMouseLeave={e=>{if(!isOn)e.currentTarget.style.background="transparent"}}><div style={{width:18,height:18,borderRadius:5,border:"2px solid "+(isOn?bl.color:"#d1d5db"),background:isOn?bl.color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>{isOn&&<Ic t="check" s={10}/>}</div><div style={{width:20,height:20,borderRadius:5,background:bl.color+"18",display:"flex",alignItems:"center",justifyContent:"center",color:bl.color}}>{bl.icon?<Ic t={bl.icon} s={11}/>:<svg viewBox="0 0 24 24" style={{width:11,height:11,stroke:"currentColor",strokeWidth:2,fill:"none"}}><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>}</div><div style={{flex:1}}><div style={{fontSize:12,fontWeight:isOn?700:500,color:isOn?bl.color:"#374151"}}>{bl.name}</div></div><span style={{fontSize:10,fontWeight:600,padding:"1px 6px",borderRadius:10,background:bl.color+"18",color:bl.color}}>{cnt}</span></div>})}{customLists.map(cl=>{const cnt=clients.filter(c=>c.listTag===cl.id).length;const isOn=listFilter.includes(cl.id);return <div key={cl.id} onClick={()=>{if(isOn)setListFilter(listFilter.filter(f=>f!==cl.id));else setListFilter([...listFilter,cl.id]);}} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",cursor:"pointer",background:isOn?cl.color+"12":"transparent",borderLeft:isOn?"3px solid "+cl.color:"3px solid transparent",borderBottom:"1px solid #f5f6f8"}} onMouseEnter={e=>{if(!isOn)e.currentTarget.style.background="#fafbfc"}} onMouseLeave={e=>{if(!isOn)e.currentTarget.style.background="transparent"}}><div style={{width:18,height:18,borderRadius:5,border:"2px solid "+(isOn?cl.color:"#d1d5db"),background:isOn?cl.color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>{isOn&&<Ic t="check" s={10}/>}</div><div style={{width:20,height:20,borderRadius:5,background:cl.color+"18",display:"flex",alignItems:"center",justifyContent:"center",color:cl.color}}><Ic t="target" s={11}/></div><div style={{flex:1}}><div style={{fontSize:12,fontWeight:isOn?700:500,color:isOn?cl.color:"#374151"}}>{cl.name}</div></div><span style={{fontSize:10,fontWeight:600,padding:"1px 6px",borderRadius:10,background:cl.color+"18",color:cl.color}}>{cnt}</span></div>})}<div onClick={()=>{setListDrop(false);setNewListModal(true);setNewListName("");setNewListColor("#3b5bdb");}} style={{display:"flex",alignItems:"center",gap:8,padding:"10px 14px",cursor:"pointer",borderTop:"1px solid #eef0f2",color:"#3b5bdb",fontSize:12,fontWeight:600}} onMouseEnter={e=>e.currentTarget.style.background="#f0f4ff"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}><Ic t="plus" s={14}/>Create New List</div></div></>}</div>
              </div>
              <div style={{fontSize:11,color:"#94a3b8"}}>{listFilter.length>0&&<span style={{color:"#3b5bdb",fontWeight:600}}>{listFilter.map(f=>{const all=[...BUILT_IN_LISTS,...customLists];const m=all.find(x=>x.id===f);return m?m.name:f;}).join(" + ")}{" · "}</span>}{myLeads&&<span style={{color:"#1a1a2e",fontWeight:600}}>My Leads · </span>}{activeList&&<span style={{color:DB_LISTS.find(d=>d.id===activeList)?.color,fontWeight:600}}>{DB_LISTS.find(d=>d.id===activeList)?.name} · </span>}{fc.length} client{fc.length!==1?"s":""}</div>
            </div>
            <Card style={{overflow:"hidden"}}>
              <div style={{display:"grid",gridTemplateColumns:"1.8fr 0.9fr 0.6fr 0.6fr 0.6fr 0.9fr 0.7fr 36px",padding:"11px 22px",borderBottom:"1px solid #eef0f2",fontSize:10.5,textTransform:"uppercase",letterSpacing:0.8,color:"#94a3b8",fontWeight:600}}><span>Client</span><span>Assigned To</span><span>Lead</span><span>Tier</span><span>Status</span><span>Dial</span><span>Last Contact</span><span/></div>
              {fc.map(c=>{const ag=c.assignedTo?team.find(m=>m.id===c.assignedTo):null;return(<div key={c.id} onClick={()=>{setSel(c);setTab("info")}} style={{display:"grid",gridTemplateColumns:"1.8fr 0.9fr 0.6fr 0.6fr 0.6fr 0.9fr 0.7fr 36px",padding:"13px 22px",borderBottom:"1px solid #f5f6f8",alignItems:"center",cursor:"pointer",transition:"background 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
                <div style={{display:"flex",alignItems:"center",gap:10}}><Avatar src={c.photo} fallback={ini(c.name)} size={30}/><div><div style={{fontWeight:500,fontSize:13}}>{c.name}</div><div style={{fontSize:11,color:"#94a3b8"}}>{c.co}</div></div></div>
                {ag?<div style={{display:"flex",alignItems:"center",gap:6}}><Avatar src={ag.photo} fallback={ag.avatar} color={roleBg(ag.role)+"30"} size={22}/><span style={{fontSize:11,fontWeight:500,color:"#374151"}}>{ag.name.split(" ")[0]}</span></div>:<span style={{fontSize:11,color:"#cbd5e1"}}>Unassigned</span>}
                <LeadBadge lead={c.lead}/>
                <span style={{fontSize:11,fontWeight:600,padding:"3px 10px",borderRadius:20,background:tBg(c.ti),color:tC(c.ti),width:"fit-content"}}>{c.ti}</span>
                <div style={{display:"flex",alignItems:"center",gap:5}}><span style={{width:7,height:7,borderRadius:"50%",background:stColor(c.st)}}/><span style={{fontSize:12}}>{c.st}</span></div>
                <span style={{fontSize:12,color:"#64748b"}}>{c.lead==="DNC"?<div style={{display:"flex",alignItems:"center",justifyContent:"center",width:30,height:30,borderRadius:8,background:"#7c3aed12",color:"#7c3aed",cursor:"not-allowed",position:"relative"}} title="DNC — Remove from DNC to dial"><svg viewBox="0 0 24 24" style={{width:15,height:15,stroke:"currentColor",strokeWidth:2,fill:"none"}}><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg></div>:<button onClick={e=>{e.stopPropagation();openDial(c);setTimeout(()=>{setDialMethod("phone");setDialActive(true);},100);}} style={{display:"flex",alignItems:"center",justifyContent:"center",width:30,height:30,borderRadius:8,border:"none",background:"#05966918",color:"#059669",cursor:"pointer",transition:"background 0.15s"}} onMouseEnter={e=>e.currentTarget.style.background="#05966930"} onMouseLeave={e=>e.currentTarget.style.background="#05966918"}><Ic t="phone" s={15}/></button>}</span><span style={{fontSize:11,color:"#94a3b8"}}>{c.lc}</span><Ic t="chev" s={14}/>
              </div>)})}
              {!fc.length&&<div style={{textAlign:"center",padding:36,color:"#94a3b8",fontSize:13}}>No clients match this filter.</div>}
            </Card>

            {/* IMPORT MODAL */}
            {importModal&&<div style={{position:"fixed",inset:0,background:"#00000040",zIndex:999,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={()=>{setImportModal(false);setImportFile(null);setImportRows([]);setImportStatus(null);}}>
              <div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:32,width:480,maxWidth:"90vw",boxShadow:"0 20px 60px #00000020"}}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:24}}><h2 style={{margin:0,fontSize:18,fontWeight:700}}>Import Clients</h2><button onClick={()=>{setImportModal(false);setImportFile(null);setImportRows([]);setImportStatus(null);}} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:0}}><Ic t="x" s={18}/></button></div>
                {importStatus&&<div style={{padding:"14px 18px",borderRadius:10,marginBottom:20,background:"#f0fdf4",border:"1px solid #bbf7d0"}}><div style={{fontSize:13,fontWeight:600,color:"#16a34a"}}>✓ {importStatus}</div></div>}
                {!importStatus&&<><div style={{fontSize:13,color:"#64748b",marginBottom:20,lineHeight:1.6}}>Upload a CSV file to bulk-import clients. Columns: Name, Company, Email, Phone, Status, Tier, Lead.</div>
                <div style={{marginBottom:20}}>
                  <label style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,display:"block",marginBottom:6}}>Destination Database</label>
                  <select value={importDest} onChange={e=>setImportDest(e.target.value)} style={{width:"100%",padding:"10px 14px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fafbfc",fontSize:13,fontFamily:"inherit",outline:"none",cursor:"pointer"}}>{DESTINATIONS.map(d=><option key={d}>{d}</option>)}</select>
                </div>
                <div style={{border:"2px dashed "+(importFile?"#16a34a":"#d0d5dd"),borderRadius:12,padding:"36px 20px",textAlign:"center",marginBottom:20,cursor:"pointer",transition:"all 0.15s",background:importFile?"#f0fdf4":"#fafbfc"}} onMouseEnter={e=>{if(!importFile){e.currentTarget.style.borderColor="#1a1a2e";e.currentTarget.style.background="#f0f2f5";}}} onMouseLeave={e=>{if(!importFile){e.currentTarget.style.borderColor="#d0d5dd";e.currentTarget.style.background="#fafbfc";}}} onClick={()=>{const inp=document.createElement("input");inp.type="file";inp.accept=".csv,.tsv";inp.onchange=e=>{const f=e.target.files[0];if(f){setImportFile(f);handleFileUpload(f,rows=>setImportRows(rows));}};inp.click();}}>
                  {!importFile&&<><div style={{width:44,height:44,borderRadius:12,background:"#f0f2f5",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 12px"}}><Ic t="upload" s={20}/></div>
                  <div style={{fontSize:14,fontWeight:600,color:"#374151",marginBottom:4}}>Click to upload</div>
                  <div style={{fontSize:12,color:"#94a3b8"}}>.csv, .tsv — Max 10MB</div></>}
                  {importFile&&<><div style={{fontSize:14,fontWeight:600,color:"#16a34a",marginBottom:4}}>✓ {importFile.name}</div><div style={{fontSize:12,color:"#64748b"}}>{importRows.length} row{importRows.length!==1?"s":""} detected · Click to change file</div></>}
                </div>
                {importRows.length>0&&<div style={{background:"#f8f9fb",borderRadius:10,padding:"12px 16px",marginBottom:20,maxHeight:120,overflow:"auto"}}><div style={{fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:6}}>Preview (first {Math.min(importRows.length,3)})</div>{importRows.slice(0,3).map((r,i)=><div key={i} style={{fontSize:12,color:"#374151",padding:"4px 0",borderBottom:i<2?"1px solid #eef0f2":"none"}}>{r.name} · {r.co||"—"} · {r.em||"—"} · {r.lead}</div>)}</div>}
                <div style={{display:"flex",gap:10,justifyContent:"flex-end"}}>
                  <button onClick={()=>{setImportModal(false);setImportFile(null);setImportRows([]);}} style={{padding:"9px 20px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}>Cancel</button>
                  <button onClick={()=>{if(importRows.length>0){const cnt=doImport(importRows,importDest,null);setImportStatus("Imported "+cnt+" client"+(cnt!==1?"s":"")+" to "+importDest);setImportFile(null);setImportRows([]);}}} disabled={importRows.length===0} style={{padding:"9px 20px",borderRadius:8,border:"none",background:importRows.length>0?"#1a1a2e":"#e2e5ea",color:importRows.length>0?"#fff":"#94a3b8",fontSize:13,fontWeight:500,cursor:importRows.length>0?"pointer":"default",fontFamily:"inherit"}}>Import {importRows.length} Client{importRows.length!==1?"s":""}</button>
                </div></>}
              </div>
            </div>}

            {/* ADD CLIENT MODAL */}
            {addClientModal&&<div style={{position:"fixed",inset:0,background:"#00000040",zIndex:999,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={()=>setAddClientModal(false)}>
              <div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:32,width:480,maxWidth:"90vw",boxShadow:"0 20px 60px #00000020"}}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:24}}><h2 style={{margin:0,fontSize:18,fontWeight:700}}>Add New Client</h2><button onClick={()=>setAddClientModal(false)} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:0}}><Ic t="x" s={18}/></button></div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"14px 16px",marginBottom:18}}>
                  {[["Name","name","text"],["Company","co","text"],["Email","em","email"],["Phone","ph","tel"]].map(([l,k,ty])=>(
                    <div key={k}><label style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,display:"block",marginBottom:5}}>{l}</label><input type={ty} value={newCl[k]} onChange={e=>setNewCl(p=>({...p,[k]:e.target.value}))} placeholder={l} style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box"}}/></div>
                  ))}
                </div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:14,marginBottom:18}}>
                  <div><label style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,display:"block",marginBottom:5}}>Tier</label><select value={newCl.ti} onChange={e=>setNewCl(p=>({...p,ti:e.target.value}))} style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",cursor:"pointer",boxSizing:"border-box"}}>{["Starter","Pro","Enterprise"].map(t=><option key={t}>{t}</option>)}</select></div>
                  <div><label style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,display:"block",marginBottom:5}}>Lead Status</label><div style={{display:"flex",gap:6}}>{["Hot","Warm","Cold","DNC"].map(l=><button key={l} onClick={()=>setNewCl(p=>({...p,lead:l}))} style={{flex:1,padding:"8px 0",borderRadius:8,border:newCl.lead===l?`2px solid ${leadColor(l)}`:"1px solid #e2e5ea",background:newCl.lead===l?leadBg(l):"#fff",fontSize:11,fontWeight:newCl.lead===l?600:400,color:newCl.lead===l?leadColor(l):"#94a3b8",cursor:"pointer",fontFamily:"inherit"}}>{l}</button>)}</div></div>
                  <div><label style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,display:"block",marginBottom:5}}>List</label><div style={{display:"flex",gap:6,flexWrap:"wrap"}}>{[{id:"none",name:"None",color:"#94a3b8"},...BUILT_IN_LISTS.filter(b=>b.id!=="dnc"),...customLists].map(lt=><button key={lt.id} onClick={()=>setNewCl(p=>({...p,listTag:lt.id==="none"?null:lt.id}))} style={{padding:"8px 12px",borderRadius:8,border:(newCl.listTag||"none")===lt.id?"2px solid "+lt.color:"1px solid #e2e5ea",background:(newCl.listTag||"none")===lt.id?lt.color+"18":"#fff",fontSize:11,fontWeight:(newCl.listTag||"none")===lt.id?600:400,color:(newCl.listTag||"none")===lt.id?lt.color:"#94a3b8",cursor:"pointer",fontFamily:"inherit"}}>{lt.name}</button>)}<button onClick={()=>{setAddClientModal(false);setNewListModal(true);setNewListName("");setNewListColor("#3b5bdb");}} style={{padding:"8px 12px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:11,fontWeight:400,color:"#3b5bdb",cursor:"pointer",fontFamily:"inherit"}}>+ New</button></div></div>
                  <div><label style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,display:"block",marginBottom:5}}>Status</label><select value={newCl.st||"Active"} onChange={e=>setNewCl(p=>({...p,st:e.target.value}))} style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",cursor:"pointer",boxSizing:"border-box"}}>{["Active","Pending","Inactive"].map(s=><option key={s}>{s}</option>)}</select></div>
                </div>
                <div style={{marginBottom:22}}>
                  <label style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,display:"block",marginBottom:5}}>Destination Database</label>
                  <div style={{display:"flex",flexWrap:"wrap",gap:8}}>{DESTINATIONS.map(d=><button key={d} onClick={()=>setNewCl(p=>({...p,dest:d}))} style={{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",borderRadius:8,border:newCl.dest===d?"2px solid #1a1a2e":"1px solid #e2e5ea",background:newCl.dest===d?"#f0f2f5":"#fff",fontSize:12,fontWeight:newCl.dest===d?600:400,color:newCl.dest===d?"#1a1a2e":"#94a3b8",cursor:"pointer",fontFamily:"inherit"}}><Ic t="db" s={12}/>{d}</button>)}</div>
                </div>
                <div style={{display:"flex",gap:10,justifyContent:"flex-end"}}>
                  <button onClick={()=>setAddClientModal(false)} style={{padding:"9px 20px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}>Cancel</button>
                  <button onClick={()=>{if(!newCl.name.trim())return;setClients(p=>[...p,{id:Date.now(),name:newCl.name,co:newCl.co,em:newCl.em,ph:newCl.ph,st:newCl.st||"Active",lc:new Date().toISOString().slice(0,10),ti:newCl.ti,photo:null,lead:newCl.lead,dest:newCl.dest,assignedTo:null,listTag:newCl.listTag||null}]);setAddClientModal(false);}} style={{padding:"9px 20px",borderRadius:8,border:"none",background:"#1a1a2e",color:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit"}}>Add Client</button>
                </div>
              </div>
            </div>}

            {/* UPLOAD MY LEADS MODAL */}
            {uploadMyLeadsModal&&<div style={{position:"fixed",inset:0,background:"#00000040",zIndex:999,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={()=>{setUploadMyLeadsModal(false);setUploadFile(null);}}>
              <div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:32,width:480,maxWidth:"90vw",boxShadow:"0 20px 60px #00000020"}}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20}}><h2 style={{margin:0,fontSize:18,fontWeight:700}}>Upload My Leads</h2><button onClick={()=>{setUploadMyLeadsModal(false);setUploadFile(null);}} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:0}}><Ic t="x" s={18}/></button></div>
                <div style={{display:"flex",alignItems:"center",gap:10,padding:"12px 16px",background:"#f0f4ff",borderRadius:10,marginBottom:20}}>
                  <Avatar src={curUser?.photo} fallback={curUser?.avatar||"?"} color={roleBg(role)+"30"} size={32}/>
                  <div><div style={{fontSize:13,fontWeight:600}}>{curUser?.name}</div><div style={{fontSize:11,color:"#64748b"}}>Leads will be assigned to you ({role})</div></div>
                </div>
                <div style={{fontSize:13,color:"#64748b",marginBottom:16,lineHeight:1.5}}>Upload a CSV with your leads. Columns: Name, Company, Email, Phone, Status, Tier, Lead.</div>
                <div style={{marginBottom:16}}>
                  <label style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,display:"block",marginBottom:6}}>Destination Database</label>
                  <select value={uploadDest} onChange={e=>setUploadDest(e.target.value)} style={{width:"100%",padding:"10px 14px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fafbfc",fontSize:13,fontFamily:"inherit",outline:"none",cursor:"pointer"}}>{DESTINATIONS.map(d=><option key={d}>{d}</option>)}</select>
                </div>
                <div style={{border:"2px dashed "+(uploadFile?"#16a34a":"#d0d5dd"),borderRadius:12,padding:"30px 20px",textAlign:"center",marginBottom:16,cursor:"pointer",background:uploadFile?"#f0fdf4":"#fafbfc"}} onClick={()=>{const inp=document.createElement("input");inp.type="file";inp.accept=".csv,.tsv";inp.onchange=e=>{const f=e.target.files[0];if(f)setUploadFile(f);};inp.click();}}>
                  {!uploadFile&&<><div style={{width:40,height:40,borderRadius:10,background:"#f0f2f5",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 10px"}}><Ic t="upload" s={18}/></div>
                  <div style={{fontSize:13,fontWeight:600,color:"#374151",marginBottom:3}}>Click to upload</div>
                  <div style={{fontSize:11,color:"#94a3b8"}}>.csv, .tsv</div></>}
                  {uploadFile&&<><div style={{fontSize:13,fontWeight:600,color:"#16a34a",marginBottom:3}}>✓ {uploadFile.name}</div><div style={{fontSize:11,color:"#64748b"}}>Click to change file</div></>}
                </div>
                <div style={{display:"flex",gap:10,justifyContent:"flex-end"}}>
                  <button onClick={()=>{setUploadMyLeadsModal(false);setUploadFile(null);}} style={{padding:"9px 20px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}>Cancel</button>
                  <button onClick={()=>{if(uploadFile){handleFileUpload(uploadFile,rows=>{const cnt=doImport(rows,uploadDest,curUserId);alert("Uploaded "+cnt+" lead"+(cnt!==1?"s":"")+" assigned to you.");setUploadMyLeadsModal(false);setUploadFile(null);});}}} disabled={!uploadFile} style={{padding:"9px 20px",borderRadius:8,border:"none",background:uploadFile?"#1a1a2e":"#e2e5ea",color:uploadFile?"#fff":"#94a3b8",fontSize:13,fontWeight:500,cursor:uploadFile?"pointer":"default",fontFamily:"inherit"}}>Upload & Assign to Me</button>
                </div>
              </div>
            </div>}
          </div>}

          {/* ASSIGN LEAD MODAL */}
          {assignLeadModal&&(()=>{const c=clients.find(x=>x.id===assignLeadModal);if(!c)return null;const lowerMembers=team.filter(m=>roleIdx(m.role)>=roleIdx(role)&&m.role!=="Client");return <div style={{position:"fixed",inset:0,background:"#00000040",zIndex:999,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={()=>setAssignLeadModal(null)}>
            <div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:32,width:440,maxWidth:"90vw",boxShadow:"0 20px 60px #00000020"}}>
              <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20}}><h2 style={{margin:0,fontSize:18,fontWeight:700}}>Assign Lead</h2><button onClick={()=>setAssignLeadModal(null)} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:0}}><Ic t="x" s={18}/></button></div>
              <div style={{display:"flex",alignItems:"center",gap:10,padding:"12px 16px",background:"#fafbfc",borderRadius:10,marginBottom:18,border:"1px solid #eef0f2"}}>
                <Avatar src={c.photo} fallback={ini(c.name)} size={32}/>
                <div><div style={{fontSize:13,fontWeight:600}}>{c.name}</div><div style={{fontSize:11,color:"#94a3b8"}}>{c.co} • <span style={{color:leadColor(c.lead)}}>{c.lead}</span></div></div>
              </div>
              <div style={{fontSize:11,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,marginBottom:10}}>Assign to team member {roleIdx(role)<=1?"":"(your level & below)"}</div>
              <div style={{display:"flex",flexDirection:"column",gap:6,maxHeight:280,overflowY:"auto",marginBottom:18}}>
                <button onClick={()=>{updateClient(c.id,"assignedTo",null);setAssignLeadModal(null);}} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",borderRadius:10,border:!c.assignedTo?"2px solid #1a1a2e":"1px solid #e2e5ea",background:!c.assignedTo?"#f0f2f5":"#fff",cursor:"pointer",fontFamily:"inherit",textAlign:"left"}}>
                  <div style={{width:28,height:28,borderRadius:"50%",background:"#f0f2f5",display:"flex",alignItems:"center",justifyContent:"center"}}><Ic t="x" s={12}/></div>
                  <div><div style={{fontSize:13,fontWeight:!c.assignedTo?600:400,color:"#374151"}}>Unassigned</div><div style={{fontSize:11,color:"#94a3b8"}}>Remove assignment</div></div>
                </button>
                {lowerMembers.map(m=>{const isCur=c.assignedTo===m.id;return <button key={m.id} onClick={()=>{updateClient(c.id,"assignedTo",m.id);setAssignLeadModal(null);}} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",borderRadius:10,border:isCur?"2px solid #1a1a2e":"1px solid #e2e5ea",background:isCur?"#f0f2f5":"#fff",cursor:"pointer",fontFamily:"inherit",textAlign:"left"}}>
                  <Avatar src={m.photo} fallback={m.avatar} color={roleBg(m.role)+"30"} size={28}/>
                  <div style={{flex:1}}><div style={{fontSize:13,fontWeight:isCur?600:400,color:"#374151"}}>{m.name}</div><div style={{fontSize:11,color:"#94a3b8"}}>{m.role} • {clients.filter(x=>x.assignedTo===m.id).length} lead{clients.filter(x=>x.assignedTo===m.id).length!==1?"s":""}</div></div>
                  {isCur&&<span style={{fontSize:10,fontWeight:600,padding:"3px 10px",borderRadius:20,background:"#059669",color:"#fff"}}>Current</span>}
                </button>;})}
              </div>
            </div>
          </div>;})()}
          {!dialClient&&sel&&(()=>{const c=clients.find(x=>x.id===sel.id)||sel;const assignedAgent=c.assignedTo?team.find(m=>m.id===c.assignedTo):null;return <div>
            <Back label="Back" onClick={()=>setSel(null)}/>
            <Card style={{padding:"22px 26px",marginBottom:18}}>
              <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                <div style={{display:"flex",alignItems:"center",gap:14}}><PhotoAvatar src={c.photo} fallback={ini(c.name)} size={50} onClick={()=>handlePhoto(c.id,true)}/><div><h2 style={{margin:0,fontSize:19,fontWeight:700}}>{c.name}</h2><div style={{display:"flex",alignItems:"center",gap:8,marginTop:4}}><span style={{fontSize:13,color:"#94a3b8"}}>{c.co}</span><LeadBadge lead={c.lead} size="md"/></div></div></div>
                <div style={{display:"flex",gap:8}}>
                  <button onClick={()=>setAssignLeadModal(c.id)} style={{display:"flex",alignItems:"center",gap:7,padding:"9px 18px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151"}}><Ic t="assign" s={15}/>Assign</button>
                  <button onClick={()=>{if(c.lead!=="DNC")openDial(c);}} style={{display:"flex",alignItems:"center",gap:7,padding:"9px 18px",borderRadius:8,border:"none",background:c.lead==="DNC"?"#e2e5ea":"#1a1a2e",color:c.lead==="DNC"?"#94a3b8":"#fff",fontSize:13,fontWeight:500,cursor:c.lead==="DNC"?"not-allowed":"pointer",fontFamily:"inherit"}} title={c.lead==="DNC"?"DNC — Remove from DNC to dial":""}><Ic t="phone" s={15}/>{c.lead==="DNC"?"DNC":"Dial"}</button>
                  <button onClick={()=>{navigator.clipboard.writeText(c.em);setEmailCopied(true);setTimeout(()=>setEmailCopied(false),2000);}} style={{display:"flex",alignItems:"center",gap:7,padding:"9px 18px",borderRadius:8,border:"none",background:emailCopied?"#059669":"#3b5bdb",color:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",transition:"background 0.2s"}}><Ic t="email" s={15}/>{emailCopied?"Copied!":"Email"}</button>
                  <button onClick={()=>openNewAppt(c.id)} style={{display:"flex",alignItems:"center",gap:7,padding:"9px 18px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151"}}><Ic t="clock" s={15}/>Book Appt</button>
                </div>
              </div>
              {assignedAgent&&<div style={{display:"flex",alignItems:"center",gap:8,marginTop:14,paddingTop:14,borderTop:"1px solid #eef0f2"}}><span style={{fontSize:11,color:"#94a3b8",fontWeight:500}}>Assigned to</span><Avatar src={assignedAgent.photo} fallback={assignedAgent.avatar} color={roleBg(assignedAgent.role)+"30"} size={24}/><span style={{fontSize:13,fontWeight:600,color:"#374151"}}>{assignedAgent.name}</span><span style={{fontSize:10,fontWeight:600,padding:"2px 8px",borderRadius:10,background:roleBg(assignedAgent.role)+"15",color:roleBg(assignedAgent.role)}}>{assignedAgent.role}</span></div>}
              {!assignedAgent&&<div style={{display:"flex",alignItems:"center",gap:6,marginTop:14,paddingTop:14,borderTop:"1px solid #eef0f2"}}><span style={{fontSize:11,color:"#cbd5e1",fontWeight:500}}>Unassigned — click Assign to assign a team member</span></div>}
            </Card>
            <div style={{display:"flex",marginBottom:18,borderBottom:"1px solid #eef0f2"}}>{[["info","Info","users"],["notes","Notes","note"]].map(([k,l,ic])=>(<button key={k} onClick={()=>setTab(k)} style={{display:"flex",alignItems:"center",gap:6,padding:"10px 18px",border:"none",background:"none",fontSize:13,fontFamily:"inherit",color:tab===k?"#1a1a2e":"#94a3b8",fontWeight:tab===k?600:400,borderBottom:tab===k?"2px solid #1a1a2e":"2px solid transparent",cursor:"pointer",marginBottom:-1}}><Ic t={ic} s={15}/>{l}</button>))}</div>
            {tab==="info"&&<Card style={{padding:"22px 26px"}}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"18px 36px"}}>{[["Full Name",c.name],["Company",c.co],["Email",c.em],["Phone",c.ph],["Status",c.st],["Tier",c.ti],["Lead",c.lead],["Assigned To",assignedAgent?assignedAgent.name:"Unassigned"],["Database",c.dest||"Main Database"],["List",c.listTag||"none"],["Last Contact",c.lc]].map(([l,v],i)=>(<div key={i}><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:3}}>{l}</div><div style={{fontSize:14,fontWeight:500}}>{l==="List"?<div style={{display:"flex",alignItems:"center",gap:4,flexWrap:"wrap"}}>{[{id:"none",name:"None",color:"#94a3b8"},...BUILT_IN_LISTS.filter(b=>b.id!=="dnc"),...customLists].map(lt=>(<button key={lt.id} onClick={()=>{const tag=lt.id==="none"?null:lt.id;setClients(p=>p.map(x=>x.id===c.id?{...x,listTag:tag}:x));setSel({...c,listTag:tag});}} style={{padding:"4px 10px",borderRadius:6,border:(c.listTag||"none")===lt.id?"1px solid "+lt.color:"1px solid #e2e5ea",background:(c.listTag||"none")===lt.id?lt.color+"18":"transparent",color:(c.listTag||"none")===lt.id?lt.color:"#94a3b8",fontSize:12,fontWeight:(c.listTag||"none")===lt.id?600:400,cursor:"pointer",fontFamily:"inherit"}}>{lt.name}</button>))}</div>:l==="Status"?<div style={{display:"flex",alignItems:"center",gap:4}}>{["Active","Pending","Inactive"].map(st=>(<button key={st} onClick={()=>{setClients(p=>p.map(x=>x.id===c.id?{...x,st}:x));setSel({...c,st});}} style={{display:"flex",alignItems:"center",gap:4,padding:"4px 10px",borderRadius:6,border:c.st===st?"1px solid "+stColor(st):"1px solid #e2e5ea",background:c.st===st?stColor(st)+"18":"transparent",color:c.st===st?stColor(st):"#94a3b8",fontSize:12,fontWeight:c.st===st?600:400,cursor:"pointer",fontFamily:"inherit"}}><span style={{width:6,height:6,borderRadius:"50%",background:c.st===st?stColor(st):"#e2e5ea"}}/>{st}</button>))}</div>:l==="Lead"?<div style={{display:"flex",alignItems:"center",gap:4}}>{["Hot","Warm","Cold","DNC"].map(ld=>(<button key={ld} onClick={()=>{setClients(p=>p.map(x=>x.id===c.id?{...x,lead:ld}:x));setSel({...c,lead:ld});}} style={{display:"flex",alignItems:"center",gap:4,padding:"4px 10px",borderRadius:6,border:c.lead===ld?"1px solid "+leadColor(ld):"1px solid #e2e5ea",background:c.lead===ld?leadBg(ld):"transparent",color:c.lead===ld?leadColor(ld):"#94a3b8",fontSize:12,fontWeight:c.lead===ld?600:400,cursor:"pointer",fontFamily:"inherit"}}><span style={{width:6,height:6,borderRadius:"50%",background:c.lead===ld?leadColor(ld):"#e2e5ea"}}/>{ld}</button>))}</div>:l==="Database"?<span style={{display:"inline-flex",alignItems:"center",gap:5}}><Ic t="db" s={13}/>{v}</span>:l==="Assigned To"&&assignedAgent?<span style={{display:"inline-flex",alignItems:"center",gap:6}}><Avatar src={assignedAgent.photo} fallback={assignedAgent.avatar} color={roleBg(assignedAgent.role)+"30"} size={20}/>{v}</span>:v}</div></div>))}</div></Card>}
            {tab==="info"&&<Card style={{padding:"22px 26px",marginTop:14}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14}}><div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:28,height:28,borderRadius:8,background:"#059669"+"18",display:"flex",alignItems:"center",justifyContent:"center",color:"#059669"}}><Ic t="dollar" s={14}/></div><span style={{fontSize:14,fontWeight:700}}>Sales</span><span style={{fontSize:11,color:"#94a3b8"}}>({(sales[c.id]||[]).length})</span>{(sales[c.id]||[]).filter(x=>x.recurring).length>0&&<span style={{fontSize:10,fontWeight:600,padding:"2px 8px",borderRadius:10,background:"#dbeafe",color:"#3b5bdb"}}>{(sales[c.id]||[]).filter(x=>x.recurring).length} recurring</span>}</div><button onClick={()=>setSaleModal({clientId:c.id})} style={{display:"flex",alignItems:"center",gap:5,padding:"6px 14px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151"}}><Ic t="plus" s={13}/>Add Sale</button></div>{(sales[c.id]||[]).map(s=>(<div key={s.id} style={{padding:"14px 0",borderTop:"1px solid #f0f2f5"}}><div style={{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:12}}><div style={{display:"flex",alignItems:"center",gap:10,flex:1,cursor:"pointer"}} onClick={()=>setSaleModal({clientId:c.id,sale:s})}><div style={{width:36,height:36,borderRadius:8,background:s.recurring?"#dbeafe":"#f0fdf4",display:"flex",alignItems:"center",justifyContent:"center",color:s.recurring?"#3b5bdb":"#059669",flexShrink:0}}><Ic t={s.recurring?"signal":"dollar"} s={16}/></div><div style={{flex:1,minWidth:0}}><div style={{fontSize:14,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{s.product||"Untitled Sale"}</div><div style={{display:"flex",alignItems:"center",gap:8,marginTop:3,flexWrap:"wrap"}}>{s.saleType&&<span style={{fontSize:10,fontWeight:600,padding:"2px 7px",borderRadius:6,background:"#f5f6f8",color:"#64748b"}}>{s.saleType}</span>}{s.quality&&<span style={{fontSize:10,fontWeight:600,padding:"2px 7px",borderRadius:6,background:"#f5f0ff",color:"#7c3aed"}}>{s.quality}</span>}{s.recurring&&<span style={{fontSize:10,fontWeight:600,padding:"2px 7px",borderRadius:6,background:"#dbeafe",color:"#3b5bdb"}}>{s.recurringFreq}</span>}</div><div style={{fontSize:10,color:"#94a3b8",marginTop:3}}>{s.d} · by {s.ag}</div></div></div><div style={{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:2,flexShrink:0}}><span style={{fontSize:15,fontWeight:700,color:"#059669"}}>${(s.amt||0).toLocaleString()}</span><div style={{display:"flex",gap:8}}><span style={{fontSize:10,color:"#64748b"}}>Gross <strong style={{color:"#059669"}}>${(s.grossProfit||0).toLocaleString()}</strong></span><span style={{fontSize:10,color:"#64748b"}}>Net <strong style={{color:"#059669"}}>${(s.netProfit||0).toLocaleString()}</strong></span></div><button onClick={e=>{e.stopPropagation();setSales(p=>({...p,[c.id]:(p[c.id]||[]).filter(x=>x.id!==s.id)}));}} style={{padding:"3px 6px",borderRadius:5,border:"1px solid #fecaca",background:"#fff",cursor:"pointer",color:"#ef4444",fontSize:10,marginTop:4}}><Ic t="trash" s={10}/></button></div></div></div>))}{!(sales[c.id]||[]).length&&<div style={{textAlign:"center",padding:20,color:"#94a3b8",fontSize:12}}>No sales recorded.</div>}</Card>}
            {tab==="notes"&&<div>
              <Card style={{padding:"16px 20px",marginBottom:14}}><textarea placeholder="Add a note..." value={note} onChange={e=>setNote(e.target.value)} rows={3} style={{width:"100%",border:"1px solid #e2e5ea",borderRadius:8,padding:"10px 14px",fontSize:13,fontFamily:"inherit",resize:"vertical",outline:"none",boxSizing:"border-box"}}/><div style={{display:"flex",justifyContent:"flex-end",marginTop:8}}><button onClick={()=>{if(!note.trim())return;setNts(p=>({...p,[c.id]:[{id:Date.now(),d:new Date().toISOString().slice(0,10),a:team[0].name.split(" ")[0]+" "+team[0].name.split(" ")[1][0]+".",aRole:role,t:note.trim()},...(p[c.id]||[])]}));setNote("");}} style={{padding:"8px 18px",borderRadius:8,border:"none",background:"#1a1a2e",color:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit"}}>Save Note</button></div></Card>
              {!(nts[c.id]||[]).length&&<Card style={{textAlign:"center",padding:36,color:"#94a3b8",fontSize:14}}>No notes yet.</Card>}
              {(nts[c.id]||[]).map(n=>{const ce=canEditDeleteNote(role,n.aRole);return <Card key={n.id} style={{padding:"16px 20px",marginBottom:10}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:7}}><div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:12,fontWeight:600,color:"#3b5bdb"}}>{n.a}</span><span style={{fontSize:10,padding:"2px 6px",borderRadius:10,background:roleBg(n.aRole)+"15",color:roleBg(n.aRole),fontWeight:600}}>{n.aRole}</span></div><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:11,color:"#94a3b8"}}>{n.d}</span>{ce&&<button style={{padding:"2px 6px",borderRadius:4,border:"1px solid #e2e5ea",background:"#fff",fontSize:10,cursor:"pointer",color:"#64748b"}}><Ic t="edit" s={10}/></button>}{ce&&<button style={{padding:"2px 6px",borderRadius:4,border:"1px solid #fecaca",background:"#fff",fontSize:10,cursor:"pointer",color:"#ef4444"}}><Ic t="trash" s={10}/></button>}</div></div><div style={{fontSize:13.5,lineHeight:1.6,color:"#374151"}}>{n.t}</div></Card>;})}
            </div>}
          </div>})()}

          {/* SETTINGS */}
          {!dialClient&&sec==="acquisition"&&(()=>{
            const now2=new Date(2026,1,25);
            const aqRangeD={"1d":1,"7d":7,"1m":30,"3m":90,"6m":180,"12m":365,"custom":0,"all":9999}[kpiRange]||30;
            const aqStart=kpiRange==="custom"?(parseD(kpiFrom)||new Date(2020,0,1)):new Date(now2);if(kpiRange!=="custom")aqStart.setDate(aqStart.getDate()-aqRangeD);
            const aqStartStr=aqStart.toISOString().slice(0,10);
            const aqEndStr=kpiRange==="custom"?kpiTo:"2026-02-25";
            // Source analysis
            const DESTS=["Main Database","Inbound Leads","Outbound Leads","Event Contacts","Partner Referrals"];
            const destColors={"Main Database":"#3b5bdb","Inbound Leads":"#059669","Outbound Leads":"#0891b2","Event Contacts":"#f59e0b","Partner Referrals":"#7c3aed"};
            const srcData=DESTS.map(d=>{const dClients=clients.filter(c=>c.dest===d);const count=dClients.length;const converted=dClients.filter(c=>c.listTag==="sold").length;const rev=dClients.reduce((s,c)=>(s+(sales[c.id]||[]).filter(x=>x.d>=aqStartStr&&x.d<=aqEndStr).reduce((ss,x)=>ss+x.amt,0)),0);const convRate=count>0?Math.round(converted/count*100):0;return {name:d,color:destColors[d]||"#94a3b8",count,converted,rev,convRate};});
            const totalAcq=srcData.reduce((s,d)=>s+d.count,0);
            const totalConv=srcData.reduce((s,d)=>s+d.converted,0);
            const totalAcqRev=srcData.reduce((s,d)=>s+d.rev,0);
            // Lead temp funnel
            const leads=["Hot","Warm","Cold"];
            const leadColors={"Hot":"#ef4444","Warm":"#f59e0b","Cold":"#3b5bdb"};
            const leadData=leads.map(l=>{const lc=clients.filter(c=>c.lead===l);return {name:l,color:leadColors[l],count:lc.length,rev:lc.reduce((s,c)=>(s+(sales[c.id]||[]).filter(x=>x.d>=aqStartStr&&x.d<=aqEndStr).reduce((ss,x)=>ss+x.amt,0)),0)};});
            // New vs returning
            const newClients=clients.filter(c=>c.listTag==="new").length;
            const activeClients=clients.filter(c=>!c.listTag&&c.lead!=="DNC").length;
            const soldClients=clients.filter(c=>c.listTag==="sold").length;
            const pendingClients=clients.filter(c=>c.listTag==="pending").length;
            // Monthly trend
            const months=[];for(let i=5;i>=0;i--){const md=new Date(2026,1-i,1);months.push({label:md.toLocaleString("default",{month:"short"}),key:md.toISOString().slice(0,7)});}
            const monthData=months.map(m=>{const mClients=clients.filter(c=>{const cl=(cls[c.id]||[]);return cl.some(x=>x.d.startsWith(m.key));});return {...m,acquired:mClients.length,rev:clients.reduce((s,c)=>(s+(sales[c.id]||[]).filter(x=>x.d.startsWith(m.key)).reduce((ss,x)=>ss+x.amt,0)),0)};});
            const mMax=Math.max(...monthData.map(m=>m.acquired),1);
            const fmtR=v=>"$"+v.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0});
            // Pie helper
            const Pie3=({data,total,valueKey,fmt,size=160})=>{if(!total)return <div style={{width:size,height:size,display:"flex",alignItems:"center",justifyContent:"center",color:"#cbd5e1",fontSize:12}}>No data</div>;let cum=0;const slices=data.filter(d=>d[valueKey]>0).map(d=>{const pct=d[valueKey]/total;const start=cum;cum+=pct;return {...d,pct,start};});const r=size/2-4;const cx=size/2;const cy=size/2;const arc=(s0,e0)=>{const s=s0*2*Math.PI-Math.PI/2;const e=e0*2*Math.PI-Math.PI/2;const lg=e0-s0>0.5?1:0;return `M ${cx+r*Math.cos(s)} ${cy+r*Math.sin(s)} A ${r} ${r} 0 ${lg} 1 ${cx+r*Math.cos(e)} ${cy+r*Math.sin(e)} L ${cx} ${cy} Z`;};return <svg width={size} height={size}>{slices.length===1?<circle cx={cx} cy={cy} r={r} fill={slices[0].color}/>:slices.map((sl,i)=>sl.pct>0.001&&<path key={i} d={arc(sl.start,sl.start+sl.pct-0.003)} fill={sl.color} stroke="#fff" strokeWidth={2}/>)}<circle cx={cx} cy={cy} r={r*0.55} fill="#fff"/><text x={cx} y={cy-4} textAnchor="middle" fontSize={16} fontWeight="700" fill="#1a1a2e">{fmt(total)}</text><text x={cx} y={cy+10} textAnchor="middle" fontSize={9} fill="#94a3b8">Total</text></svg>;};
            const StatB=({label,value,sub,color,icon})=><Card style={{padding:"18px 22px"}}><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:8}}><div style={{width:32,height:32,borderRadius:8,background:color+"18",display:"flex",alignItems:"center",justifyContent:"center",color}}><Ic t={icon} s={16}/></div><span style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600}}>{label}</span></div><div style={{fontSize:26,fontWeight:700,color:"#1a1a2e"}}>{value}</div>{sub&&<div style={{fontSize:12,color:"#64748b",marginTop:2}}>{sub}</div>}</Card>;
            return <div>
              <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20}}>
                <div style={{display:"flex",alignItems:"center",gap:10}}><div style={{width:32,height:32,borderRadius:8,background:"linear-gradient(135deg, #0891b2 0%, #3b5bdb 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"}}><Ic t="target" s={16}/></div><h1 style={{fontSize:22,fontWeight:700,margin:0}}>Acquisition Statistics</h1><span style={{fontSize:11,color:"#94a3b8",fontWeight:500}}>{aqEntries.length} entries</span></div>
                <div style={{display:"flex",alignItems:"center",gap:8}}>
                <button onClick={()=>setAqHistoryOpen(true)} style={{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",borderRadius:8,border:"1px solid #3b5bdb",background:"#f0f4ff",fontSize:12,fontWeight:600,color:"#3b5bdb",cursor:"pointer",fontFamily:"inherit"}}><Ic t="clock" s={13}/>History{aqHistory.length>0&&<span style={{fontSize:10,fontWeight:700,padding:"1px 5px",borderRadius:8,background:"#3b5bdb",color:"#fff",marginLeft:2}}>{aqHistory.length}</span>}</button>
                <button onClick={()=>{setAqModal(true);setAqTab("manual");setAqCsvText("");}} style={{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",borderRadius:8,border:"1px solid #059669",background:"#f0fdf4",fontSize:12,fontWeight:600,color:"#059669",cursor:"pointer",fontFamily:"inherit"}}><Ic t="plus" s={13}/>Add Entry</button>
                <div style={{position:"relative"}}><button onClick={()=>setKpiDrop(!kpiDrop)} style={{display:"flex",alignItems:"center",gap:6,padding:"7px 14px",borderRadius:8,border:kpiDrop?"2px solid #3b5bdb":"1px solid #e2e5ea",background:kpiDrop?"#f0f4ff":"#fff",fontSize:12,fontWeight:600,color:kpiDrop?"#3b5bdb":"#374151",cursor:"pointer",fontFamily:"inherit"}}><Ic t="clock" s={13}/>{kpiRange==="custom"?kpiFrom+" → "+kpiTo:{"1d":"1 Day","7d":"7 Days","1m":"1 Month","3m":"3 Months","6m":"6 Months","12m":"1 Year","all":"All Time"}[kpiRange]||"1 Month"}<span style={{transform:kpiDrop?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",display:"inline-flex"}}><Ic t="chev" s={11}/></span></button>{kpiDrop&&<><div onClick={()=>{setKpiDrop(false);setKpiCustomView(false);}} style={{position:"fixed",inset:0,zIndex:98}}/><div style={{position:"absolute",top:"calc(100% + 4px)",right:0,width:kpiCustomView?340:200,background:"#fff",borderRadius:10,border:"1px solid #eef0f2",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",zIndex:99}}>{!kpiCustomView&&<div style={{padding:4}}>{[["1d","1 Day"],["7d","7 Days"],["1m","1 Month"],["3m","3 Months"],["6m","6 Months"],["12m","1 Year"],["all","All Time"]].map(([k,l])=><button key={k} onClick={()=>{setKpiRange(k);setKpiDrop(false);}} style={{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",border:"none",background:kpiRange===k?"#f0f4ff":"transparent",color:kpiRange===k?"#3b5bdb":"#374151",fontSize:12,fontWeight:kpiRange===k?600:400,cursor:"pointer",fontFamily:"inherit",borderRadius:6}} onMouseEnter={e=>{if(kpiRange!==k)e.currentTarget.style.background="#f8f9fb"}} onMouseLeave={e=>{if(kpiRange!==k)e.currentTarget.style.background="transparent"}}>{l}{kpiRange===k&&<Ic t="check" s={12}/>}</button>)}<div style={{borderTop:"1px solid #eef0f2",margin:"4px 0"}}/><button onClick={()=>setKpiCustomView(true)} style={{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",border:"none",background:kpiRange==="custom"?"#f0f4ff":"transparent",color:kpiRange==="custom"?"#3b5bdb":"#374151",fontSize:12,fontWeight:kpiRange==="custom"?600:400,cursor:"pointer",fontFamily:"inherit",borderRadius:6}} onMouseEnter={e=>e.currentTarget.style.background="#f8f9fb"} onMouseLeave={e=>e.currentTarget.style.background=kpiRange==="custom"?"#f0f4ff":"transparent"}>Custom Range<Ic t="chev" s={10}/></button></div>}{kpiCustomView&&<div style={{padding:16}}><button onClick={()=>setKpiCustomView(false)} style={{display:"flex",alignItems:"center",gap:4,border:"none",background:"none",color:"#64748b",fontSize:11,cursor:"pointer",fontFamily:"inherit",padding:0,marginBottom:12}}><span style={{transform:"rotate(180deg)",display:"inline-flex"}}><Ic t="chev" s={10}/></span>Back</button><div style={{fontSize:13,fontWeight:700,marginBottom:12}}>Choose Date Range</div><div style={{display:"flex",gap:12,marginBottom:14}}><CalendarPicker value={kpiFrom} onChange={setKpiFrom} label="From"/><CalendarPicker value={kpiTo} onChange={setKpiTo} label="To"/></div><button onClick={()=>{setKpiRange("custom");setKpiDrop(false);setKpiCustomView(false);}} style={{width:"100%",padding:"8px 0",borderRadius:8,border:"none",background:"#3b5bdb",color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit"}}>Apply Range</button></div>}</div></>}</div>
                </div>
              </div>

              <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:14,marginBottom:20}}>
                <StatB label="Total Leads" value={totalAcq} sub={DESTS.length+" sources"} color="#3b5bdb" icon="users"/>
                <StatB label="Converted" value={totalConv} sub={totalAcq>0?Math.round(totalConv/totalAcq*100)+"% conversion":"—"} color="#059669" icon="check"/>
                <StatB label="Revenue" value={fmtR(totalAcqRev)} sub="from all sources" color="#0891b2" icon="dollar"/>
                <StatB label="Avg Deal Size" value={totalConv>0?fmtR(Math.round(totalAcqRev/totalConv)):"—"} sub={totalConv+" deals closed"} color="#7c3aed" icon="target"/>
              </div>

              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,marginBottom:20}}>
                <Card style={{padding:"22px 26px"}}><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:16}}><Ic t="db" s={14}/><span style={{fontSize:14,fontWeight:700}}>Leads by Source</span></div>
                  <div style={{display:"flex",alignItems:"center",gap:20}}>
                    <Pie3 data={srcData} total={totalAcq} valueKey="count" fmt={v=>String(v)}/>
                    <div style={{display:"flex",flexDirection:"column",gap:5,flex:1}}>{srcData.map(d=><div key={d.name} style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:8,height:8,borderRadius:2,background:d.color,flexShrink:0}}/><span style={{fontSize:11,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{d.name}</span><span style={{fontSize:11,fontWeight:700,color:d.color}}>{d.count}</span></div>)}</div>
                  </div>
                </Card>
                <Card style={{padding:"22px 26px"}}><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:16}}><Ic t="dollar" s={14}/><span style={{fontSize:14,fontWeight:700}}>Revenue by Source</span></div>
                  <div style={{display:"flex",alignItems:"center",gap:20}}>
                    <Pie3 data={srcData.filter(d=>d.rev>0)} total={totalAcqRev} valueKey="rev" fmt={v=>fmtR(v)}/>
                    <div style={{display:"flex",flexDirection:"column",gap:5,flex:1}}>{srcData.filter(d=>d.rev>0).map(d=><div key={d.name} style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:8,height:8,borderRadius:2,background:d.color,flexShrink:0}}/><span style={{fontSize:11,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{d.name}</span><span style={{fontSize:11,fontWeight:700,color:d.color}}>{fmtR(d.rev)}</span></div>)}</div>
                  </div>
                </Card>
              </div>

              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,marginBottom:20}}>
                <Card style={{padding:"22px 26px"}}><div style={{fontSize:14,fontWeight:700,marginBottom:16}}>Lead Temperature</div>
                  <div style={{display:"flex",alignItems:"center",gap:20}}>
                    <Pie3 data={leadData} total={leadData.reduce((s,d)=>s+d.count,0)} valueKey="count" fmt={v=>String(v)} size={140}/>
                    <div style={{flex:1}}>{leadData.map(d=><div key={d.name} style={{display:"flex",alignItems:"center",gap:10,padding:"8px 10px",borderRadius:8,marginBottom:4,background:d.color+"08"}}><div style={{width:10,height:10,borderRadius:"50%",background:d.color}}/><span style={{fontSize:12,fontWeight:600,flex:1}}>{d.name}</span><span style={{fontSize:13,fontWeight:700,color:d.color}}>{d.count}</span><span style={{fontSize:10,color:"#94a3b8"}}>{fmtR(d.rev)}</span></div>)}</div>
                  </div>
                </Card>
                <Card style={{padding:"22px 26px"}}><div style={{fontSize:14,fontWeight:700,marginBottom:16}}>Conversion Funnel</div>
                  {srcData.sort((a,b)=>b.count-a.count).map(d=><div key={d.name} style={{marginBottom:10}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:3}}><span style={{fontSize:11,fontWeight:500}}>{d.name}</span><span style={{fontSize:11,fontWeight:700,color:d.color}}>{d.convRate}%</span></div><div style={{height:20,background:"#f5f6f8",borderRadius:6,overflow:"hidden",position:"relative"}}><div style={{height:"100%",background:d.color+"30",borderRadius:6,width:d.count>0?(d.count/Math.max(...srcData.map(x=>x.count))*100)+"%":"0%"}}><div style={{height:"100%",background:d.color,borderRadius:6,width:d.convRate+"%"}}/></div></div></div>)}
                </Card>
              </div>

              <Card style={{padding:"22px 26px"}}><div style={{fontSize:14,fontWeight:700,marginBottom:16}}>Monthly Acquisition Trend</div>
                <div style={{display:"flex",alignItems:"flex-end",gap:8,height:160,padding:"0 10px"}}>{monthData.map(m=><div key={m.key} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:4}}>
                  <span style={{fontSize:10,fontWeight:700,color:"#3b5bdb"}}>{m.acquired}</span>
                  <div style={{width:"100%",background:"#3b5bdb",borderRadius:6,height:Math.max(4,m.acquired/mMax*120),transition:"height 0.3s"}}/>
                  <span style={{fontSize:10,color:"#94a3b8",fontWeight:500}}>{m.label}</span>
                  <span style={{fontSize:9,color:"#059669",fontWeight:600}}>{fmtR(m.rev)}</span>
                </div>)}</div>
              </Card>

              {/* ── Acquisition Cost Entries ── */}
              {(()=>{const fltEntries=aqEntries.filter(e=>e.d>=aqStartStr&&e.d<=aqEndStr);const totCost=fltEntries.reduce((s,e)=>s+e.cost,0);const totLeads=fltEntries.reduce((s,e)=>s+e.leads,0);const avgCpl=totLeads>0?(totCost/totLeads):0;const stColors={active:"#059669",completed:"#3b5bdb",paused:"#f59e0b"};
              return <Card style={{overflow:"hidden",marginTop:20}}>
                <div style={{padding:"16px 22px",borderBottom:"1px solid #eef0f2",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                  <div style={{display:"flex",alignItems:"center",gap:10}}><Ic t="dollar" s={15}/><span style={{fontSize:14,fontWeight:700}}>Acquisition Costs & Services</span><span style={{fontSize:11,color:"#94a3b8"}}>{fltEntries.length} entries</span></div>
                  <div style={{display:"flex",alignItems:"center",gap:16}}><span style={{fontSize:11,color:"#64748b"}}>Total Spend: <strong style={{color:"#ef4444"}}>{fmtR(totCost)}</strong></span><span style={{fontSize:11,color:"#64748b"}}>Leads: <strong style={{color:"#3b5bdb"}}>{totLeads}</strong></span><span style={{fontSize:11,color:"#64748b"}}>Avg CPL: <strong style={{color:"#7c3aed"}}>{fmtR(Math.round(avgCpl))}</strong></span></div>
                </div>
                <div style={{display:"grid",gridTemplateColumns:"0.8fr 0.8fr 1.4fr 0.6fr 0.5fr 0.5fr 0.5fr 40px",padding:"8px 22px",fontSize:9.5,textTransform:"uppercase",letterSpacing:0.7,color:"#94a3b8",fontWeight:600,borderBottom:"1px solid #f5f6f8"}}><span>Date</span><span>Source</span><span>Service</span><span>Category</span><span style={{textAlign:"right"}}>Cost</span><span style={{textAlign:"right"}}>Leads</span><span style={{textAlign:"right"}}>CPL</span><span/></div>
                {fltEntries.sort((a,b)=>b.d.localeCompare(a.d)).map(e=>(<div key={e.id} style={{display:"grid",gridTemplateColumns:"0.8fr 0.8fr 1.4fr 0.6fr 0.5fr 0.5fr 0.5fr 40px",padding:"11px 22px",borderBottom:"1px solid #f8f9fb",alignItems:"center",fontSize:12}}>
                  <span style={{color:"#94a3b8",fontFamily:"monospace",fontSize:11}}>{e.d}</span>
                  <span style={{fontWeight:600}}>{e.source}</span>
                  <span style={{color:"#374151",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{e.service}</span>
                  <span style={{fontSize:10,fontWeight:600,padding:"2px 7px",borderRadius:6,background:"#f5f6f8",color:"#64748b",justifySelf:"start"}}>{e.category}</span>
                  <span style={{textAlign:"right",fontWeight:700,color:"#ef4444"}}>${e.cost.toLocaleString()}</span>
                  <span style={{textAlign:"right",fontWeight:600,color:"#3b5bdb"}}>{e.leads}</span>
                  <span style={{textAlign:"right",fontWeight:600,color:"#7c3aed"}}>${Math.round(e.cpl)}</span>
                  <button onClick={()=>setAqEntries(p=>p.filter(x=>x.id!==e.id))} style={{padding:2,border:"none",background:"transparent",cursor:"pointer",color:"#cbd5e1",justifySelf:"center"}}><Ic t="trash" s={12}/></button>
                </div>))}
                {!fltEntries.length&&<div style={{padding:30,textAlign:"center",color:"#94a3b8",fontSize:13}}>No entries in selected date range.</div>}
              </Card>;})()}
            </div>;
          })()}

          {!dialClient&&sec==="settings"&&!selRole&&<div>
            <h1 style={{fontSize:22,fontWeight:700,margin:"0 0 18px",letterSpacing:-0.5}}>Settings</h1>
            <div style={{display:"flex",gap:0,marginBottom:18,borderBottom:"1px solid #eef0f2"}}>{[["general","General"],["display","Display"],["dialin","Dial-In"],["callrecords","Call Records"],...(canAssignKeys(role)?[["names","Profile Names"]]:[])].map(([k,l])=>(<button key={k} onClick={()=>setSettingsTab(k)} style={{padding:"10px 18px",border:"none",background:"none",fontSize:13,fontFamily:"inherit",color:settingsTab===k?"#1a1a2e":"#94a3b8",fontWeight:settingsTab===k?600:400,borderBottom:settingsTab===k?"2px solid #1a1a2e":"2px solid transparent",cursor:"pointer",marginBottom:-1}}>{l}</button>))}</div>
            {settingsTab==="general"&&<div style={{maxWidth:620}}><h3 style={{fontSize:15,fontWeight:600,margin:"0 0 14px"}}>Access Roles</h3><div style={{display:"flex",flexDirection:"column",gap:10}}>{ROLE_ORDER.map(r=>(<div key={r} onClick={()=>setSelRole(r)} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 18px",borderRadius:12,border:"1px solid #eef0f2",background:"#fff",cursor:"pointer"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="#fff"}><div style={{display:"flex",alignItems:"center",gap:12}}><div style={{width:36,height:36,borderRadius:10,background:roleBg(r)+"18",display:"flex",alignItems:"center",justifyContent:"center",color:roleBg(r)}}><Ic t="paw" s={22}/></div><div><div style={{fontWeight:600,fontSize:14,color:roleBg(r)}}>{r}</div><div style={{fontSize:12,color:"#94a3b8",marginTop:1}}>{ROLE_INFO[r].desc.slice(0,55)}...</div></div></div><div style={{display:"flex",alignItems:"center",gap:8}}>{r!=="Client"&&<span style={{fontSize:12,color:"#94a3b8"}}>{team.filter(m=>m.role===r).length}</span>}{r!=="Client"&&<div style={{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:6,background:roleBg(r)+"12",color:roleBg(r)}}><Ic t="key" s={14}/></div>}<Ic t="chev" s={14}/></div></div>))}</div></div>}
            {settingsTab==="display"&&<Card style={{padding:26,maxWidth:580}}><h3 style={{fontSize:15,fontWeight:600,margin:"0 0 14px"}}>Text Size</h3><p style={{fontSize:13,color:"#64748b",margin:"0 0 18px",lineHeight:1.5}}>Adjust the text size across the application. This does not affect the sidebar logo or branding.</p><div style={{display:"flex",alignItems:"center",gap:16,marginBottom:18}}><span style={{fontSize:12,color:"#94a3b8",fontWeight:500,whiteSpace:"nowrap"}}>A</span><input type="range" min={0.8} max={1.8} step={0.05} value={pendingTextSize} onChange={e=>setPendingTextSize(parseFloat(e.target.value))} style={{flex:1,accentColor:"#1a1a2e",cursor:"pointer"}}/><span style={{fontSize:18,color:"#94a3b8",fontWeight:500,whiteSpace:"nowrap"}}>A</span></div><div style={{display:"flex",gap:8,flexWrap:"wrap",marginBottom:18}}>{[{label:"X-Small",val:0.8},{label:"Small",val:0.9},{label:"Medium",val:1.1,def:true},{label:"Large",val:1.3},{label:"X-Large",val:1.5},{label:"XX-Large",val:1.8}].map(o=>(<button key={o.val} onClick={()=>setPendingTextSize(o.val)} style={{padding:"8px 16px",borderRadius:8,border:pendingTextSize===o.val?"2px solid #1a1a2e":"1px solid #e2e5ea",background:pendingTextSize===o.val?"#f0f2f5":"#fff",fontSize:12,fontWeight:pendingTextSize===o.val?600:400,color:pendingTextSize===o.val?"#1a1a2e":"#94a3b8",cursor:"pointer",fontFamily:"inherit"}}>{o.label}{o.def?" ✦":""}</button>))}</div><Card style={{padding:"16px 20px",background:"#fafbfc",marginBottom:18}}><div style={{fontSize:11*pendingTextSize,color:"#94a3b8",fontWeight:500,textTransform:"uppercase",letterSpacing:0.5,marginBottom:4}}>Preview</div><div style={{fontSize:14*pendingTextSize,fontWeight:500,color:"#374151",marginBottom:4}}>This is how your text will appear at the current size.</div><div style={{fontSize:12*pendingTextSize,color:"#64748b"}}>Smaller secondary text like dates, labels, and metadata will also scale accordingly.</div></Card><div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}><div style={{fontSize:12,color:"#94a3b8"}}>{pendingTextSize!==textSize?"Unsaved changes":textSize!==1.1?`Current: ${Math.round(textSize*100)}%`:"Default (Medium)"}</div><button onClick={()=>{setTextSize(pendingTextSize)}} disabled={pendingTextSize===textSize} style={{padding:"9px 24px",borderRadius:8,border:"none",background:pendingTextSize!==textSize?"#1a1a2e":"#e2e5ea",color:pendingTextSize!==textSize?"#fff":"#94a3b8",fontSize:13,fontWeight:600,cursor:pendingTextSize!==textSize?"pointer":"default",fontFamily:"inherit",transition:"all 0.15s"}}>Apply</button></div></Card>}
            {settingsTab==="dialin"&&<Card style={{padding:26,maxWidth:580}}><h3 style={{fontSize:15,fontWeight:600,margin:"0 0 14px"}}>Dial-In Configuration</h3><div style={{display:"flex",flexDirection:"column",gap:10}}>{[["own","Use Own Phone","Dial from your personal or company phone"],["tf","TracForce Dialer","Built-in VoIP dialing service"],["3rd","3rd Party Integration","Connect existing telephony provider"]].map(([k,l,d])=>(<label key={k} style={{display:"flex",alignItems:"flex-start",gap:12,padding:"13px 15px",borderRadius:10,border:dialMethod===k?"2px solid #1a1a2e":"1px solid #e2e5ea",cursor:"pointer",background:dialMethod===k?"#fafbfc":"#fff"}}><input type="radio" name="dial" checked={dialMethod===k} onChange={()=>setDialMethod(k)} style={{marginTop:2,accentColor:"#1a1a2e"}}/><div><div style={{fontWeight:500,fontSize:13.5}}>{l}</div><div style={{fontSize:12,color:"#94a3b8",marginTop:2}}>{d}</div></div></label>))}</div></Card>}
            {settingsTab==="callrecords"&&<Card style={{overflow:"hidden"}}><div style={{display:"grid",gridTemplateColumns:"1.5fr 1fr 1fr 1fr 1fr 80px",padding:"11px 22px",borderBottom:"1px solid #eef0f2",fontSize:10.5,textTransform:"uppercase",letterSpacing:0.8,color:"#94a3b8",fontWeight:600}}><span>Client</span><span>Date</span><span>Type</span><span>Duration</span><span>Agent</span><span>Rec</span></div>{clients.flatMap(cl=>(cls[cl.id]||[]).map(c2=>({...c2,cn:cl.name}))).sort((a,b)=>b.d.localeCompare(a.d)).map((c2,i)=>(<div key={i} style={{display:"grid",gridTemplateColumns:"1.5fr 1fr 1fr 1fr 1fr 80px",padding:"13px 22px",borderBottom:"1px solid #f5f6f8",alignItems:"center"}}><span style={{fontWeight:500,fontSize:13}}>{c2.cn}</span><span style={{fontSize:13}}>{c2.d}</span><span style={{fontSize:11,fontWeight:600,padding:"3px 10px",borderRadius:20,background:c2.ty==="Inbound"?"#f0fdf4":"#f0f4ff",color:c2.ty==="Inbound"?"#16a34a":"#3b5bdb",width:"fit-content"}}>{c2.ty}</span><span style={{fontSize:13,color:"#64748b"}}>{c2.dur}</span><span style={{fontSize:13}}>{c2.ag}</span><span>{c2.rc?<button style={{display:"flex",alignItems:"center",gap:4,padding:"4px 10px",borderRadius:6,border:"1px solid #e2e5ea",background:"#fff",fontSize:11,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}><Ic t="play" s={12}/>Play</button>:<span style={{color:"#cbd5e1",fontSize:11}}>—</span>}</span></div>))}</Card>}
            {settingsTab==="names"&&canAssignKeys(role)&&(()=>{const me=team.find(m=>m.role===role);return <Card style={{padding:26,maxWidth:580}}><h3 style={{fontSize:15,fontWeight:600,margin:"0 0 14px"}}>Edit Profile Names</h3><div style={{fontSize:12,color:"#64748b",marginBottom:6,lineHeight:1.5}}>Profile names are generated at account creation during first login. You may edit your own name and names of team members below your role level.</div><div style={{fontSize:12,color:"#94a3b8",marginBottom:16,lineHeight:1.5,display:"flex",alignItems:"center",gap:6}}><Ic t="key" s={12}/>Accounts can be created by roles with key access.</div><div style={{display:"flex",flexDirection:"column",gap:10}}>{team.map(m=>{const isSelf=me&&m.id===me.id;const canEdit=isSelf||isAbove(role,m.role);return(<div key={m.id} style={{display:"flex",alignItems:"center",gap:12,padding:"10px 14px",borderRadius:10,border:isSelf?"1px solid "+roleBg(role)+"40":"1px solid #eef0f2",background:isSelf?roleBg(role)+"06":"transparent",opacity:canEdit?1:0.55}}><Avatar src={m.photo} fallback={m.avatar} color={roleBg(m.role)+"30"} size={30}/>{canEdit?<input value={m.name} onChange={e=>{const v=e.target.value;setTeam(p=>p.map(x=>x.id===m.id?{...x,name:v}:x))}} style={{flex:1,border:"1px solid #e2e5ea",borderRadius:6,padding:"6px 10px",fontSize:13,fontFamily:"inherit",outline:"none"}}/>:<span style={{flex:1,fontSize:13,fontWeight:500,color:"#374151"}}>{m.name}</span>}<span style={{fontSize:11,color:canEdit?"#94a3b8":"#cbd5e1",fontWeight:500,flexShrink:0}}>{m.role}{isSelf?" (You)":""}</span>{!canEdit&&<span style={{color:roleBg(m.role)}}><Ic t="paw" s={14}/></span>}</div>)})}</div></Card>})()}
          </div>}

          {/* ROLE PROFILE */}
          {!dialClient&&sec==="settings"&&selRole&&<div>
            <Back label="Back to Settings" onClick={()=>setSelRole(null)}/>
            <Card style={{padding:28,marginBottom:20}}><div style={{display:"flex",alignItems:"center",gap:16,marginBottom:20}}><div style={{width:56,height:56,borderRadius:14,background:roleBg(selRole)+"18",display:"flex",alignItems:"center",justifyContent:"center",color:roleBg(selRole)}}><Ic t="paw" s={32}/></div><div><h2 style={{margin:0,fontSize:22,fontWeight:700,color:roleBg(selRole)}}>{selRole}</h2><div style={{fontSize:13,color:"#94a3b8",marginTop:3}}>{selRole==="Client"?"No platform access":team.filter(m=>m.role===selRole).length+" member"+(team.filter(m=>m.role===selRole).length!==1?"s":"")}</div></div></div><p style={{fontSize:14,lineHeight:1.7,color:"#374151",margin:"0 0 20px"}}>{ROLE_INFO[selRole].desc}</p><h4 style={{fontSize:13,fontWeight:600,margin:"0 0 10px",textTransform:"uppercase",letterSpacing:0.5,color:"#94a3b8"}}>Permissions</h4><div style={{display:"flex",flexDirection:"column",gap:6}}>{ROLE_INFO[selRole].perms.map((p2,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:8,fontSize:13,color:"#374151"}}><Ic t="check" s={14}/>{p2}</div>))}</div></Card>
            {selRole!=="Client"&&<div><h3 style={{fontSize:15,fontWeight:600,margin:"0 0 14px"}}>Members with {selRole} access</h3>{!team.filter(m=>m.role===selRole).length&&<Card style={{textAlign:"center",padding:30,color:"#94a3b8",fontSize:13}}>No members.</Card>}<div style={{display:"flex",flexDirection:"column",gap:10}}>{team.filter(m=>m.role===selRole).map(m=>(<Card key={m.id} style={{padding:"16px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer"}} onClick={()=>{setSec("team");setSelMember(m);setSelRole(null)}}><div style={{display:"flex",alignItems:"center",gap:14}}><Avatar src={m.photo} fallback={m.avatar} color={roleBg(m.role)+"30"} size={42}/><div><div style={{fontWeight:500,fontSize:14}}>{m.name}</div><div style={{fontSize:12,color:"#94a3b8"}}>{m.email}</div></div></div><div style={{display:"flex",gap:20,alignItems:"center"}}><div style={{textAlign:"center"}}><div style={{fontSize:16,fontWeight:700}}>{m.phoneTime}h</div><div style={{fontSize:10,color:"#94a3b8"}}>Phone</div></div><div style={{textAlign:"center"}}><div style={{fontSize:16,fontWeight:700}}>{m.noteCount}</div><div style={{fontSize:10,color:"#94a3b8"}}>Notes</div></div><div style={{textAlign:"center"}}><div style={{fontSize:16,fontWeight:700}}>{m.callCount}</div><div style={{fontSize:10,color:"#94a3b8"}}>Calls</div></div><Ic t="chev" s={14}/></div></Card>))}</div></div>}
          </div>}

          {/* AUDIT */}
          {!dialClient&&sec==="audit"&&(role==="Master"||role==="Admin")&&(()=>{const auditLogs=[];clients.forEach(c=>{(nts[c.id]||[]).forEach(n=>{auditLogs.push({t:n.d+(n.d.includes(" ")?"":" "+String(9+Math.abs((n.id*7)%14))+":"+String(10+(n.id*13)%50).padStart(2,"0")),u:n.a,a:"Added note to "+c.name,cat:"note"});});(cls[c.id]||[]).forEach(cl=>{auditLogs.push({t:cl.d+(cl.d.includes(" ")?"":" "+String(8+Math.abs((cl.id*11)%14))+":"+String(10+(cl.id*17)%50).padStart(2,"0")),u:cl.ag,a:"Completed "+cl.ty.toLowerCase()+" call to "+c.name+" ("+cl.dur+")",cat:"call"});});});auditLogs.push({t:"2026-02-25 14:32",u:"James K.",a:"Changed role of Chris D.",cat:"role"},{t:"2026-02-25 16:20",u:"James K.",a:"Updated billing — auto-renewal confirmed",cat:"billing"},{t:"2026-02-24 17:55",u:"Sarah M.",a:"Updated text size setting to Large",cat:"settings"},{t:"2026-02-23 15:10",u:"James K.",a:"Updated SSO integration settings",cat:"settings"},{t:"2026-02-22 16:50",u:"James K.",a:"Updated dial-in config",cat:"settings"},{t:"2026-02-26 09:12",u:"Sarah M.",a:"Logged in",cat:"auth"},{t:"2026-02-26 08:55",u:"James K.",a:"Logged in",cat:"auth"},{t:"2026-02-25 08:30",u:"Chris D.",a:"Logged in",cat:"auth"},{t:"2026-02-25 08:22",u:"Maya L.",a:"Logged in",cat:"auth"},{t:"2026-02-24 08:15",u:"Alex R.",a:"Logged in",cat:"auth"},{t:"2026-02-25 17:40",u:"Sarah M.",a:"Exported client list to CSV",cat:"data"},{t:"2026-02-20 10:30",u:"Alex R.",a:"Exported engagement report",cat:"data"});auditLogs.sort((a,b)=>b.t.localeCompare(a.t));const catBg={auth:"#f0f4ff",note:"#fefce8",call:"#f0fdf4",role:"#fdf2f8",settings:"#f5f3ff",billing:"#fff7ed",client:"#ecfeff",data:"#f0fdf4"};const catFg={auth:"#3b5bdb",note:"#a16207",call:"#16a34a",role:"#be185d",settings:"#7c3aed",billing:"#c2410c",client:"#0891b2",data:"#059669"};const recent=auditLogs.slice(0,50);const older=auditLogs.slice(50);const renderRow=(l,i)=>(<div key={i} style={{padding:"13px 22px",borderBottom:"1px solid #f5f6f8",display:"flex",alignItems:"center",gap:16}}><span style={{fontSize:12,color:"#94a3b8",whiteSpace:"nowrap",fontFamily:"monospace"}}>{l.t}</span><span style={{fontSize:11,fontWeight:600,padding:"3px 8px",borderRadius:6,whiteSpace:"nowrap",background:catBg[l.cat]||"#f5f6f8",color:catFg[l.cat]||"#64748b"}}>{l.cat.charAt(0).toUpperCase()+l.cat.slice(1)}</span><span style={{fontSize:12,fontWeight:600,color:"#3b5bdb",whiteSpace:"nowrap"}}>{l.u}</span><span style={{fontSize:13,color:"#374151",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{l.a}</span></div>);const activeTeam=team.filter(m=>m.role!=="Client"&&reportInclude.includes(m.id));const getDateRange=()=>{const now2=new Date(2026,1,25);if(reportRange==="custom")return{from:reportFrom,to:reportTo};const ranges={"7d":7,"30d":30,"3m":90,"6m":180,"12m":365,"all":9999};const days=ranges[reportRange]||365;const from=new Date(now2);from.setDate(from.getDate()-days);return{from:from.toISOString().slice(0,10),to:"2026-02-25"};};const dateRange=getDateRange();const filteredLogs=auditLogs.filter(l=>{const ld=l.t.slice(0,10);if(ld<dateRange.from||ld>dateRange.to)return false;const sn=l.u;return activeTeam.some(m=>{const short=m.name.split(" ")[0]+" "+m.name.split(" ")[1][0]+".";return short===sn;});});const getStats=(logs,member)=>{const sn=member?member.name.split(" ")[0]+" "+member.name.split(" ")[1][0]+".":null;const ml=member?logs.filter(l=>l.u===sn):logs;const notes=ml.filter(l=>l.cat==="note").length;const calls=ml.filter(l=>l.cat==="call").length;const other=ml.filter(l=>l.cat!=="note"&&l.cat!=="call").length;return{total:ml.length,notes,calls,other};};return <div>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:18}}>
              <h1 style={{fontSize:22,fontWeight:700,margin:0,letterSpacing:-0.5}}>Audit Logs</h1>
              <div style={{display:"flex",alignItems:"center",gap:10}}>
                <span style={{fontSize:12,color:"#94a3b8"}}>Showing latest 50 of {auditLogs.length}</span>
                {older.length>0&&<button onClick={()=>setAuditModal(true)} style={{display:"flex",alignItems:"center",gap:5,padding:"6px 14px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,color:"#3b5bdb",cursor:"pointer",fontFamily:"inherit"}}><Ic t="clock" s={13}/>View All ({auditLogs.length})</button>}
                <button onClick={()=>exportAuditCSV(auditLogs)} style={{display:"flex",alignItems:"center",gap:5,padding:"6px 14px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,color:"#374151",cursor:"pointer",fontFamily:"inherit"}}><Ic t="download" s={13}/>Export CSV</button>
                <button onClick={()=>{setReportModal(true);setReportGenerated(false);setReportType("team");setReportExclude([]);setReportInclude(team.filter(m=>m.role!=="Client").map(m=>m.id));setRoleIndividual({});}} style={{display:"flex",alignItems:"center",gap:5,padding:"6px 14px",borderRadius:8,border:"none",background:"#1a1a2e",fontSize:12,fontWeight:500,color:"#fff",cursor:"pointer",fontFamily:"inherit"}}><Ic t="note" s={13}/>Generate Report</button>
              </div>
            </div>
            <Card style={{overflow:"hidden"}}>{recent.map(renderRow)}</Card>
            {auditModal&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:10000,display:"flex",alignItems:"center",justifyContent:"center"}}>
              <div onClick={()=>setAuditModal(false)} style={{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.4)"}}/>
              <div style={{position:"relative",background:"#fff",borderRadius:16,width:"90%",maxWidth:820,maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"}}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px 26px 16px",borderBottom:"1px solid #eef0f2"}}>
                  <div><h2 style={{margin:0,fontSize:18,fontWeight:700}}>All Audit Logs</h2><span style={{fontSize:12,color:"#94a3b8"}}>{auditLogs.length} total entries</span></div>
                  <button onClick={()=>setAuditModal(false)} style={{width:32,height:32,borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:16,color:"#64748b"}}>✕</button>
                </div>
                <div style={{overflow:"auto",flex:1}}>{auditLogs.map(renderRow)}</div>
              </div>
            </div>}
            {reportModal&&!reportGenerated&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:10000,display:"flex",alignItems:"center",justifyContent:"center"}}>
              <div onClick={()=>setReportModal(false)} style={{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.4)"}}/>
              <div style={{position:"relative",background:"#fff",borderRadius:16,width:"90%",maxWidth:680,maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"}}>
                <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px 26px 16px",borderBottom:"1px solid #eef0f2"}}>
                  <div><h2 style={{margin:0,fontSize:18,fontWeight:700}}>Generate Report</h2><span style={{fontSize:12,color:"#94a3b8"}}>Configure report options</span></div>
                  <button onClick={()=>setReportModal(false)} style={{width:32,height:32,borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:16,color:"#64748b"}}>✕</button>
                </div>
                <div style={{overflow:"visible",flex:1,padding:"20px 26px"}}>
                  <div style={{marginBottom:20}}>
                    <div style={{fontSize:13,fontWeight:600,marginBottom:10}}>Team Members</div>
                    <div style={{position:"relative"}}><button onClick={()=>setReportDrop(!reportDrop)} style={{width:"100%",padding:"10px 14px",borderRadius:10,border:"1px solid #e2e5ea",background:"#fff",cursor:"pointer",fontFamily:"inherit",textAlign:"left",display:"flex",alignItems:"center",justifyContent:"space-between"}}><span style={{fontSize:13,color:"#374151"}}>{(()=>{const allIds=team.filter(m=>m.role!=="Client").map(m=>m.id);const isAll=allIds.length===reportInclude.length&&allIds.every(id=>reportInclude.includes(id));return isAll?<span><span style={{fontWeight:600}}>All Team Members</span><span style={{color:"#94a3b8",marginLeft:6}}>({allIds.length})</span></span>:<span><span style={{fontWeight:600}}>{reportInclude.length} member{reportInclude.length!==1?"s":""} selected</span></span>})()}</span><span style={{fontSize:10,color:"#94a3b8",transform:reportDrop?"rotate(180deg)":"none",transition:"transform 0.15s"}}>▼</span></button>{reportDrop&&(()=>{const allIds=team.filter(m=>m.role!=="Client").map(m=>m.id);const isAll=allIds.length===reportInclude.length&&allIds.every(id=>reportInclude.includes(id));const roleList=["Master","Admin","Manager","Asst. Manager","Specialist"];return <div style={{position:"absolute",top:"100%",left:0,right:0,zIndex:10,marginTop:4,background:"#fff",borderRadius:10,border:"1px solid #e2e5ea",boxShadow:"0 8px 24px rgba(0,0,0,0.1)",maxHeight:420,overflow:"auto"}}><div style={{display:"flex",alignItems:"center",padding:"10px 14px",borderBottom:"1px solid #f5f6f8",gap:8,flexWrap:"wrap"}}><div onClick={()=>{setReportInclude(allIds);setRoleIndividual({});setReportExclude([]);}} style={{display:"flex",alignItems:"center",gap:6,cursor:"pointer",padding:"5px 10px",borderRadius:6,background:isAll?"#1a1a2e":"#f5f6f8",color:isAll?"#fff":"#64748b",fontSize:11,fontWeight:600,whiteSpace:"nowrap"}}>All</div>{roleList.map(r=>{const rm=team.filter(m=>m.role===r);if(!rm.length)return null;const allIn=rm.every(m=>reportInclude.includes(m.id));const anyIn=rm.some(m=>reportInclude.includes(m.id));return <div key={r} onClick={()=>{if(isAll){const justThisRole=rm.map(m=>m.id);setReportInclude(justThisRole);setRoleIndividual({});setReportExclude(allIds.filter(id=>!justThisRole.includes(id)));}else if(allIn){const without=reportInclude.filter(id=>!rm.some(m=>m.id===id));if(without.length===0){setReportInclude(allIds);setRoleIndividual({});setReportExclude([]);}else{setReportInclude(without);setRoleIndividual(p=>{const n={...p};delete n[r];return n;});setReportExclude(allIds.filter(id=>!without.includes(id)));}}else{const with_=[...new Set([...reportInclude,...rm.map(m=>m.id)])];setReportInclude(with_);setRoleIndividual(p=>{const n={...p};delete n[r];return n;});setReportExclude(allIds.filter(id=>!with_.includes(id)));}}} style={{display:"flex",alignItems:"center",gap:4,cursor:"pointer",padding:"5px 10px",borderRadius:6,background:allIn?roleBg(r)+"20":anyIn?roleBg(r)+"10":"#f5f6f8",color:allIn?roleBg(r):anyIn?roleBg(r):"#94a3b8",fontSize:11,fontWeight:600,whiteSpace:"nowrap",border:"1px solid "+(allIn?roleBg(r)+"40":anyIn?roleBg(r)+"20":"transparent")}}>{r}{allIn&&<span style={{fontSize:9}}>✓</span>}{anyIn&&!allIn&&<span style={{fontSize:9}}>◐</span>}</div>})}</div>{roleList.map(r=>{const rm=team.filter(m=>m.role===r);if(!rm.length)return null;return <div key={r}><div style={{padding:"6px 14px",background:"#fafbfc",borderBottom:"1px solid #f5f6f8",display:"flex",alignItems:"center",gap:6}}><span style={{width:8,height:8,borderRadius:"50%",background:roleBg(r)}}/><span style={{fontSize:10,fontWeight:700,color:"#64748b",textTransform:"uppercase",letterSpacing:0.5}}>{r}</span><span style={{fontSize:10,color:"#94a3b8"}}>({rm.filter(m=>reportInclude.includes(m.id)).length}/{rm.length})</span></div>{rm.map(m=>{const inc=reportInclude.includes(m.id);return <div key={m.id} onClick={()=>{if(isAll){setReportInclude([m.id]);setRoleIndividual({[r]:true});setReportExclude(allIds.filter(id=>id!==m.id));}else{const allInRole=rm.every(x=>reportInclude.includes(x.id));const hasIndiv=roleIndividual[r];if(allInRole&&!hasIndiv){const keep=reportInclude.filter(id=>!rm.some(x=>x.id===id));const next=[...keep,m.id];setReportInclude(next);setRoleIndividual(p=>({...p,[r]:true}));setReportExclude(allIds.filter(id=>!next.includes(id)));}else{let next;if(inc){next=reportInclude.filter(x=>x!==m.id);}else{next=[...reportInclude,m.id];}if(next.length===0){setReportInclude(allIds);setRoleIndividual({});setReportExclude([]);}else{setReportInclude(next);if(rm.every(x=>next.includes(x.id))){setRoleIndividual(p=>{const n={...p};delete n[r];return n;});}else if(rm.some(x=>next.includes(x.id))){setRoleIndividual(p=>({...p,[r]:true}));}else{setRoleIndividual(p=>{const n={...p};delete n[r];return n;});}setReportExclude(allIds.filter(id=>!next.includes(id)));}}}}} style={{display:"flex",alignItems:"center",gap:10,padding:"9px 14px",cursor:"pointer",borderBottom:"1px solid #f5f6f8",background:inc?roleBg(r)+"08":"transparent",transition:"background 0.1s"}} onMouseEnter={e=>{if(!inc)e.currentTarget.style.background="#fafbfc"}} onMouseLeave={e=>{if(!inc)e.currentTarget.style.background="transparent"}}><div style={{width:18,height:18,borderRadius:5,border:"2px solid "+(inc?roleBg(r):"#d1d5db"),background:inc?roleBg(r):"#fff",display:"flex",alignItems:"center",justifyContent:"center"}}>{inc&&<Ic t="check" s={10}/>}</div><Avatar src={m.photo} fallback={m.avatar} color={roleBg(m.role)+"30"} size={26}/><div style={{flex:1}}><div style={{fontWeight:inc?600:500,fontSize:12,color:inc?"#1a1a2e":"#64748b"}}>{m.name}</div><div style={{fontSize:10,color:"#94a3b8"}}>{m.role}</div></div></div>})}</div>})}</div>})()}</div>
                  </div>
                  <div style={{marginBottom:20}}>
                    <div style={{fontSize:13,fontWeight:600,marginBottom:10}}>Time Period</div>
                    <div style={{display:"flex",alignItems:"center",gap:0,borderRadius:8,border:"1px solid #e2e5ea",overflow:"hidden"}}>{[["7d","7D"],["30d","30D"],["3m","3M"],["6m","6M"],["12m","1Y"],["all","All"],["custom","Custom"]].map(([k,l],i,a)=>(<button key={k} onClick={()=>setReportRange(k)} style={{flex:1,padding:"7px 0",border:"none",borderRight:i<a.length-1?"1px solid #e2e5ea":"none",background:reportRange===k?"#1a1a2e":"#fff",cursor:"pointer",fontFamily:"inherit",fontSize:11,fontWeight:600,color:reportRange===k?"#fff":"#64748b",whiteSpace:"nowrap"}}>{l}</button>))}</div>
                    {reportRange==="custom"&&<div style={{display:"flex",alignItems:"center",gap:8,marginTop:10}}><input type="date" value={reportFrom} onChange={e=>setReportFrom(e.target.value)} style={{padding:"8px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:12,fontFamily:"inherit",color:"#374151"}}/><span style={{color:"#94a3b8",fontSize:12}}>to</span><input type="date" value={reportTo} onChange={e=>setReportTo(e.target.value)} style={{padding:"8px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:12,fontFamily:"inherit",color:"#374151"}}/></div>}
                  </div>
                  <button onClick={()=>{setReportDrop(false);setReportGenerated(true);}} disabled={activeTeam.length===0} style={{width:"100%",padding:"12px 0",borderRadius:10,border:"none",background:activeTeam.length>0?"#1a1a2e":"#e2e5ea",color:activeTeam.length>0?"#fff":"#94a3b8",fontSize:14,fontWeight:600,cursor:activeTeam.length>0?"pointer":"default",fontFamily:"inherit"}}>Generate Report ({activeTeam.length} member{activeTeam.length!==1?"s":""})</button>
                </div>
              </div>
            </div>}
            {reportModal&&reportGenerated&&(()=>{const dr=getDateRange();const fromD=new Date(dr.from+"T00:00:00");const toD=new Date(dr.to+"T00:00:00");const months=[];const cur=new Date(fromD.getFullYear(),fromD.getMonth(),1);const endM=new Date(toD.getFullYear(),toD.getMonth(),1);while(cur<=endM){months.push({key:cur.toISOString().slice(0,7),label:cur.toLocaleDateString("en-US",{month:"short",year:"numeric"})});cur.setMonth(cur.getMonth()+1);}const monthlyData=months.map(mo=>{const ml=filteredLogs.filter(l=>l.t.slice(0,7)===mo.key);const notes=ml.filter(l=>l.cat==="note").length;const calls=ml.filter(l=>l.cat==="call").length;const other=ml.filter(l=>l.cat!=="note"&&l.cat!=="call").length;return{...mo,notes,calls,other,total:notes+calls+other};});const maxMonth=Math.max(...monthlyData.map(m=>m.total),1);const ts=getStats(filteredLogs);const genDate=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});const rangeStr=new Date(dr.from+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" – "+new Date(dr.to+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return <div className="tf-report-print" style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:10000,background:"#f0f2f5",overflow:"auto"}}>
              <style>{`@media print{.tf-report-noprint{display:none!important}.tf-report-print{position:static!important;background:#fff!important;overflow:visible!important}.tf-report-page{box-shadow:none!important;margin:0!important;border-radius:0!important;max-width:none!important;break-inside:avoid}}`}</style>
              <div className="tf-report-noprint" style={{position:"sticky",top:0,zIndex:10,background:"#fff",borderBottom:"1px solid #eef0f2",padding:"12px 24px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                <div style={{display:"flex",alignItems:"center",gap:12}}><button onClick={()=>{setReportGenerated(false);}} style={{display:"flex",alignItems:"center",gap:4,border:"1px solid #e2e5ea",background:"#fff",borderRadius:8,padding:"6px 14px",fontSize:12,color:"#64748b",cursor:"pointer",fontFamily:"inherit"}}><Ic t="chev" s={12}/>Back</button><span style={{fontSize:14,fontWeight:600}}>Audit Report Preview</span></div>
                <div style={{display:"flex",gap:8}}><button onClick={()=>window.print()} style={{display:"flex",alignItems:"center",gap:5,padding:"8px 20px",borderRadius:8,border:"none",background:"#1a1a2e",color:"#fff",fontSize:13,fontWeight:600,cursor:"pointer",fontFamily:"inherit"}}>Print / Save PDF</button><button onClick={()=>setReportModal(false)} style={{padding:"8px 16px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,color:"#64748b",cursor:"pointer",fontFamily:"inherit"}}>Close</button></div>
              </div>
              <div style={{padding:"32px 24px",display:"flex",flexDirection:"column",alignItems:"center",gap:32}}>
                <div className="tf-report-page" style={{background:"#fff",borderRadius:12,boxShadow:"0 2px 12px rgba(0,0,0,0.08)",maxWidth:780,width:"100%",padding:"48px 56px"}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:32,paddingBottom:24,borderBottom:"2px solid #1a1a2e"}}>
                    <div><div style={{fontSize:28,fontWeight:800,color:"#1a1a2e",letterSpacing:-1}}>TracForce</div><div style={{fontSize:11,color:"#94a3b8",textTransform:"uppercase",letterSpacing:2,marginTop:2}}>Audit Report</div></div>
                    <div style={{textAlign:"right"}}><div style={{fontSize:12,color:"#64748b"}}>{genDate}</div><div style={{fontSize:11,color:"#94a3b8",marginTop:2}}>{reportExclude.length===0?"Team-wide":"Individual"} · {activeTeam.length} member{activeTeam.length!==1?"s":""}</div><div style={{fontSize:11,color:"#64748b",marginTop:2,fontWeight:500}}>{rangeStr}</div>{reportExclude.length>0&&<div style={{fontSize:10,color:"#94a3b8",marginTop:2}}>{reportExclude.length} not included</div>}</div>
                  </div>
                  <div style={{fontSize:16,fontWeight:700,marginBottom:16}}>Summary</div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:16,marginBottom:32}}>{[["Total Activity",ts.total,"#1a1a2e"],["Notes",ts.notes,"#7c3aed"],["Calls",ts.calls,"#3b5bdb"],["Other",ts.other,"#64748b"]].map(([label,val,col],i)=>(<div key={i} style={{padding:"20px 16px",borderRadius:10,border:"1px solid #eef0f2",textAlign:"center"}}><div style={{fontSize:28,fontWeight:800,color:col}}>{val}</div><div style={{fontSize:11,color:"#94a3b8",marginTop:4,textTransform:"uppercase",letterSpacing:0.5}}>{label}</div></div>))}</div>
                  <div style={{fontSize:16,fontWeight:700,marginBottom:16}}>Activity Over Time</div>
                  <div style={{marginBottom:32}}>
                    <div style={{display:"flex",alignItems:"flex-end",gap:4,height:160,padding:"0 0 24px",borderBottom:"1px solid #eef0f2",position:"relative"}}>{monthlyData.map((mo,i)=>{const h=maxMonth>0?Math.round(mo.total/maxMonth*130):0;const nh=maxMonth>0?Math.round(mo.notes/maxMonth*130):0;const ch=maxMonth>0?Math.round(mo.calls/maxMonth*130):0;const oh=maxMonth>0?Math.round(mo.other/maxMonth*130):0;return <div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:0}}><div style={{display:"flex",flexDirection:"column",justifyContent:"flex-end",height:130,width:"100%",gap:1}}>{oh>0&&<div style={{height:oh,background:"#94a3b8",borderRadius:oh===h?"3px 3px 0 0":"0",width:"100%"}}/>}{ch>0&&<div style={{height:ch,background:"#3b5bdb",width:"100%"}}/>}{nh>0&&<div style={{height:nh,background:"#7c3aed",borderRadius:nh===h?"0":"0 0 3px 3px",width:"100%"}}/>}</div><div style={{fontSize:8,color:"#94a3b8",marginTop:6,whiteSpace:"nowrap",transform:"rotate(-45deg)",transformOrigin:"top center"}}>{mo.label}</div></div>})}</div>
                    <div style={{display:"flex",gap:16,justifyContent:"center",marginTop:20}}>{[["Notes","#7c3aed"],["Calls","#3b5bdb"],["Other","#94a3b8"]].map(([l,c])=>(<div key={l} style={{display:"flex",alignItems:"center",gap:5}}><div style={{width:10,height:10,borderRadius:2,background:c}}/><span style={{fontSize:11,color:"#64748b"}}>{l}</span></div>))}</div>
                  </div>
                  <div style={{fontSize:16,fontWeight:700,marginBottom:16}}>{reportExclude.length===0?"Team Member Breakdown":"Individual Reports"}</div>
                  {reportExclude.length===0&&<div>
                    <div style={{borderRadius:10,border:"1px solid #eef0f2",overflow:"hidden",marginBottom:24}}><div style={{display:"grid",gridTemplateColumns:"1.8fr 0.8fr 0.8fr 0.8fr 0.8fr",padding:"10px 16px",borderBottom:"1px solid #eef0f2",fontSize:9,textTransform:"uppercase",letterSpacing:1,color:"#94a3b8",fontWeight:700}}><span>Member</span><span style={{textAlign:"center"}}>Total</span><span style={{textAlign:"center"}}>Notes</span><span style={{textAlign:"center"}}>Calls</span><span style={{textAlign:"center"}}>Other</span></div>{activeTeam.map(m=>{const s=getStats(filteredLogs,m);const pct=ts.total>0?Math.round(s.total/ts.total*100):0;return <div key={m.id} style={{display:"grid",gridTemplateColumns:"1.8fr 0.8fr 0.8fr 0.8fr 0.8fr",padding:"11px 16px",borderBottom:"1px solid #f5f6f8",alignItems:"center"}}><div><div style={{fontWeight:600,fontSize:12}}>{m.name}</div><div style={{fontSize:10,color:"#94a3b8"}}>{m.role}</div></div><div style={{textAlign:"center"}}><span style={{fontWeight:700,fontSize:13}}>{s.total}</span><span style={{fontSize:9,color:"#94a3b8",marginLeft:3}}>{pct}%</span></div><div style={{textAlign:"center",fontSize:12,color:"#7c3aed",fontWeight:500}}>{s.notes}</div><div style={{textAlign:"center",fontSize:12,color:"#3b5bdb",fontWeight:500}}>{s.calls}</div><div style={{textAlign:"center",fontSize:12,color:"#64748b",fontWeight:500}}>{s.other}</div></div>})}</div>
                  </div>}
                  {reportExclude.length>0&&<div style={{display:"flex",flexDirection:"column",gap:20}}>
                    {activeTeam.map(m=>{const s=getStats(filteredLogs,m);const maxVal=Math.max(s.notes,s.calls,s.other,1);const mMonths=months.map(mo=>{const ml=filteredLogs.filter(l=>{const sn=m.name.split(" ")[0]+" "+m.name.split(" ")[1][0]+".";return l.u===sn&&l.t.slice(0,7)===mo.key;});return{...mo,total:ml.length};});const mMax=Math.max(...mMonths.map(x=>x.total),1);return <div key={m.id} style={{borderRadius:10,border:"1px solid #eef0f2",overflow:"hidden",breakInside:"avoid"}}>
                      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 20px",borderBottom:"1px solid #f5f6f8",background:"#fafbfc"}}><div><div style={{fontWeight:700,fontSize:14}}>{m.name}</div><div style={{fontSize:11,color:"#94a3b8"}}>{m.role} · {m.email}</div></div><div style={{textAlign:"right"}}><span style={{fontSize:22,fontWeight:800,color:"#1a1a2e"}}>{s.total}</span><span style={{fontSize:10,color:"#94a3b8",marginLeft:4}}>actions</span></div></div>
                      <div style={{padding:"14px 20px"}}><div style={{display:"flex",gap:16,marginBottom:12}}>{[["Notes",s.notes,"#7c3aed"],["Calls",s.calls,"#3b5bdb"],["Other",s.other,"#94a3b8"]].map(([label,val,col])=>(<div key={label} style={{flex:1}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><span style={{fontSize:10,color:"#64748b"}}>{label}</span><span style={{fontSize:11,fontWeight:700,color:col}}>{val}</span></div><div style={{height:5,borderRadius:3,background:"#f0f2f5"}}><div style={{height:"100%",borderRadius:3,background:col,width:Math.round(val/maxVal*100)+"%"}}/></div></div>))}</div><div style={{fontSize:10,color:"#94a3b8",marginBottom:6}}>Monthly Activity</div><div style={{display:"flex",alignItems:"flex-end",gap:2,height:36}}>{mMonths.map((mo,i)=>(<div key={i} style={{flex:1,background:"#3b5bdb",borderRadius:"2px 2px 0 0",height:Math.max(Math.round(mo.total/mMax*32),mo.total>0?2:0),opacity:mo.total>0?1:0.15}} title={mo.label+": "+mo.total}/>))}</div></div>
                    </div>})}
                  </div>}
                  <div style={{marginTop:32,paddingTop:20,borderTop:"1px solid #eef0f2",display:"flex",justifyContent:"space-between",alignItems:"center"}}><div style={{fontSize:10,color:"#94a3b8"}}>TracForce Audit Report · {rangeStr} · Generated {genDate}</div><div style={{fontSize:10,color:"#94a3b8"}}>{activeTeam.length} members · {filteredLogs.length} entries{reportExclude.length>0?" · "+reportExclude.length+" excluded":""}</div></div>
                </div>
              </div>
            </div>})()}
          </div>})()}

          {/* BILLING */}
          {!dialClient&&sec==="billing"&&role==="Master"&&<div><h1 style={{fontSize:22,fontWeight:700,margin:"0 0 18px"}}>Billing</h1><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:20}}><Card style={{padding:"22px 26px"}}><div style={{fontSize:11.5,color:"#94a3b8",fontWeight:500,textTransform:"uppercase",letterSpacing:0.5}}>Current Plan</div><div style={{fontSize:24,fontWeight:700,margin:"8px 0 4px"}}>Enterprise</div><div style={{fontSize:13,color:"#64748b"}}>$299/month · 10 seats</div></Card><Card style={{padding:"22px 26px"}}><div style={{fontSize:11.5,color:"#94a3b8",fontWeight:500,textTransform:"uppercase",letterSpacing:0.5}}>Next Billing</div><div style={{fontSize:24,fontWeight:700,margin:"8px 0 4px"}}>Mar 1, 2026</div><div style={{fontSize:13,color:"#64748b"}}>Auto-renewal enabled</div></Card></div><Card style={{padding:"22px 26px"}}><h3 style={{fontSize:15,fontWeight:600,margin:"0 0 14px"}}>Payment History</h3>{[["Feb 1, 2026","$299.00","Paid"],["Jan 1, 2026","$299.00","Paid"],["Dec 1, 2025","$299.00","Paid"]].map(([d,a,s],i)=>(<div key={i} style={{display:"flex",justifyContent:"space-between",padding:"10px 0",borderBottom:i<2?"1px solid #f5f6f8":"none"}}><span style={{fontSize:13}}>{d}</span><span style={{fontSize:13,fontWeight:600}}>{a}</span><span style={{fontSize:11,fontWeight:600,padding:"3px 10px",borderRadius:20,background:"#f0fdf4",color:"#16a34a"}}>{s}</span></div>))}</Card></div>}
        </div>
      </div>

      {/* ASSIGN MODAL */}
      {assignModal&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,backdropFilter:"blur(4px)"}} onClick={()=>setAssignModal(null)}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:30,width:370,boxShadow:"0 20px 60px rgba(0,0,0,0.15)"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18}}><h3 style={{margin:0,fontSize:17,fontWeight:700}}>Assign Key Access</h3><button onClick={()=>setAssignModal(null)} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:4}}><Ic t="x" s={18}/></button></div><div style={{textAlign:"center",marginBottom:18}}><div style={{width:48,height:48,borderRadius:"50%",background:roleBg(assignModal.role)+"20",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 8px",fontSize:16,fontWeight:700,color:roleBg(assignModal.role)}}>{assignModal.avatar}</div><div style={{fontWeight:600,fontSize:15}}>{assignModal.name}</div><div style={{fontSize:12,color:"#94a3b8",marginTop:2}}>Current: <span style={{fontWeight:600,color:roleBg(assignModal.role)}}>{assignModal.role}</span></div></div><div style={{display:"flex",flexDirection:"column",gap:6}}>{assignableRoles(role).map(r=>(<button key={r} onClick={()=>handleRoleChange(assignModal.id,r)} style={{display:"flex",alignItems:"center",gap:10,padding:"11px 15px",borderRadius:10,border:"1px solid #e2e5ea",background:"#fff",cursor:"pointer",fontFamily:"inherit"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="#fff"}><span style={{width:10,height:10,borderRadius:"50%",background:roleBg(r)}}/><span style={{fontWeight:500,fontSize:13.5}}>{r}</span></button>))}</div></div></div>}

      {/* Appointment Modal */}
      {apptModal&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,backdropFilter:"blur(4px)"}} onClick={()=>setApptModal(null)}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:30,width:420,boxShadow:"0 20px 60px rgba(0,0,0,0.15)"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><h3 style={{margin:0,fontSize:17,fontWeight:700}}>{apptModal.isNew?"Book Appointment":"Edit Appointment"}</h3><button onClick={()=>setApptModal(null)} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:4}}><Ic t="x" s={18}/></button></div>
        {(()=>{const ac=apptModal.clientId?clients.find(x=>x.id===apptModal.clientId):null;return ac?<div style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",borderRadius:10,background:"#f8fafc",marginBottom:18}}><Avatar src={ac.photo} fallback={ini(ac.name)} size={32}/><div><div style={{fontWeight:600,fontSize:13.5}}>{ac.name}</div><div style={{fontSize:11.5,color:"#94a3b8"}}>{ac.co}</div></div>{apptModal.isNew&&<button onClick={()=>setApptModal(p=>({...p,clientId:null}))} style={{marginLeft:"auto",fontSize:11,color:"#94a3b8",background:"none",border:"none",cursor:"pointer",fontFamily:"inherit",textDecoration:"underline"}}>change</button>}</div>:<div style={{marginBottom:18}}><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:6}}>Select Client</div><div style={{maxHeight:160,overflowY:"auto",border:"1px solid #e2e5ea",borderRadius:10}}>{clients.map(cl=>(<div key={cl.id} onClick={()=>setApptModal(p=>({...p,clientId:cl.id}))} style={{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",cursor:"pointer",borderBottom:"1px solid #f5f6f8",transition:"background 0.1s"}} onMouseEnter={e=>e.currentTarget.style.background="#fafbfc"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}><Avatar src={cl.photo} fallback={ini(cl.name)} size={26}/><div><div style={{fontSize:12.5,fontWeight:500}}>{cl.name}</div><div style={{fontSize:10.5,color:"#94a3b8"}}>{cl.co}</div></div></div>))}</div></div>;})()}
        <div style={{display:"flex",flexDirection:"column",gap:14}}>
          <div><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:5}}>Type</div><div style={{display:"flex",flexWrap:"wrap",gap:6}}>{APPT_TYPES.map(t=>(<button key={t} onClick={()=>setApptModal(p=>({...p,type:t}))} style={{padding:"6px 12px",borderRadius:8,border:apptModal.type===t?"1px solid #3b5bdb":"1px solid #e2e5ea",background:apptModal.type===t?"#f0f4ff":"#fff",color:apptModal.type===t?"#3b5bdb":"#64748b",fontSize:12,fontWeight:apptModal.type===t?600:400,cursor:"pointer",fontFamily:"inherit"}}>{t}</button>))}</div></div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}><div><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:5}}>Date</div><input type="date" value={apptModal.date} onChange={e=>setApptModal(p=>({...p,date:e.target.value}))} style={{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none"}}/></div><div><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:5}}>Time</div><select value={apptModal.time} onChange={e=>setApptModal(p=>({...p,time:e.target.value}))} style={{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",background:"#fff"}}>{["8:00 AM","8:30 AM","9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 PM","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM","4:30 PM","5:00 PM","5:30 PM","6:00 PM"].map(t=><option key={t} value={t}>{t}</option>)}</select></div></div>
          <div><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:5}}>Notes</div><input value={apptModal.notes} onChange={e=>setApptModal(p=>({...p,notes:e.target.value}))} placeholder="Add notes for this appointment..." style={{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none"}}/></div>
          <div style={{display:"flex",gap:8,marginTop:4}}>{!apptModal.isNew&&<button onClick={()=>deleteAppointment(apptModal.id)} style={{padding:"10px 18px",borderRadius:8,border:"1px solid #fecaca",background:"#fef2f2",color:"#ef4444",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit"}}><Ic t="trash" s={14}/></button>}<button onClick={()=>setApptModal(null)} style={{flex:1,padding:"10px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}>Cancel</button><button disabled={!apptModal.clientId} onClick={()=>{const {isNew,...data}=apptModal;if(isNew)addAppointment(data);else updateAppointment(data);}} style={{flex:1,padding:"10px",borderRadius:8,border:"none",background:apptModal.clientId?"#1a1a2e":"#e2e5ea",color:apptModal.clientId?"#fff":"#94a3b8",fontSize:13,fontWeight:600,cursor:apptModal.clientId?"pointer":"default",fontFamily:"inherit"}}>{apptModal.isNew?"Book":"Save"}</button></div>
        </div>
      </div></div>}

      {newListModal&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,backdropFilter:"blur(4px)"}} onClick={()=>setNewListModal(false)}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:30,width:380,boxShadow:"0 20px 60px rgba(0,0,0,0.15)"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><h3 style={{margin:0,fontSize:17,fontWeight:700}}>Create New List</h3><button onClick={()=>setNewListModal(false)} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:4}}><Ic t="x" s={18}/></button></div><div style={{marginBottom:16}}><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:5}}>List Name</div><input value={newListName} onChange={e=>setNewListName(e.target.value)} placeholder="e.g. VIP Clients, Referrals..." style={{width:"100%",padding:"10px 14px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box"}}/></div><div style={{marginBottom:20}}><div style={{fontSize:10.5,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:8}}>Color</div><div style={{display:"flex",gap:8}}>{["#3b5bdb","#7c3aed","#059669","#0891b2","#ef4444","#f59e0b","#ec4899","#1a1a2e"].map(c=>(<div key={c} onClick={()=>setNewListColor(c)} style={{width:32,height:32,borderRadius:8,background:c,cursor:"pointer",border:newListColor===c?"3px solid #fff":"3px solid transparent",boxShadow:newListColor===c?"0 0 0 2px "+c:"none",transition:"all 0.15s"}}/>))}</div></div><div style={{display:"flex",gap:8}}><button onClick={()=>setNewListModal(false)} style={{flex:1,padding:"10px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}>Cancel</button><button disabled={!newListName.trim()} onClick={()=>{const id="custom_"+Date.now();setCustomLists(p=>[...p,{id,name:newListName.trim(),color:newListColor}]);setNewListModal(false);setListFilter(id);}} style={{flex:1,padding:"10px",borderRadius:8,border:"none",background:newListName.trim()?"#1a1a2e":"#e2e5ea",color:newListName.trim()?"#fff":"#94a3b8",fontSize:13,fontWeight:600,cursor:newListName.trim()?"pointer":"default",fontFamily:"inherit"}}>Create List</button></div></div></div>}

      {/* ── Acquisition Entry Modal ── */}
      {aqModal&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,backdropFilter:"blur(4px)"}} onClick={()=>setAqModal(false)}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:30,width:580,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.18)"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18}}><h3 style={{margin:0,fontSize:18,fontWeight:700}}>Add Acquisition Entry</h3><button onClick={()=>setAqModal(false)} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:4}}><Ic t="x" s={18}/></button></div>
        <div style={{display:"flex",gap:4,marginBottom:18}}>{[["manual","Manual Entry"],["csv","Import CSV"]].map(([k,l])=><button key={k} onClick={()=>setAqTab(k)} style={{flex:1,padding:"9px",borderRadius:8,border:aqTab===k?"2px solid #3b5bdb":"1px solid #e2e5ea",background:aqTab===k?"#f0f4ff":"#fff",fontSize:12,fontWeight:aqTab===k?600:400,color:aqTab===k?"#3b5bdb":"#94a3b8",cursor:"pointer",fontFamily:"inherit"}}>{l}</button>)}</div>

        {aqTab==="manual"&&<div>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12}}>
              <div><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:4}}>Source</div><input value={aqManual.source} onChange={e=>setAqManual(p=>({...p,source:e.target.value}))} placeholder="e.g. Google Ads, LinkedIn..." style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box",background:"#fafbfc"}}/></div>
              <div><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:4}}>Category</div><input value={aqManual.category} onChange={e=>setAqManual(p=>({...p,category:e.target.value}))} placeholder="e.g. Paid Search, Events..." style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box",background:"#fafbfc"}}/></div>
            </div>
            <div style={{marginBottom:12}}><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:4}}>Service / Description</div><input value={aqManual.service} onChange={e=>setAqManual(p=>({...p,service:e.target.value}))} placeholder="e.g. PPC Campaign — Enterprise" style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box",background:"#fafbfc"}}/></div>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:16}}>
              <div><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:4}}>Cost ($)</div><div style={{display:"flex",alignItems:"center",border:"1px solid #e2e5ea",borderRadius:8,background:"#fafbfc",overflow:"hidden"}}><span style={{fontSize:12,color:"#ef4444",fontWeight:700,padding:"9px 0 9px 12px"}}>$</span><input type="number" value={aqManual.cost} onChange={e=>setAqManual(p=>({...p,cost:e.target.value}))} placeholder="0" style={{flex:1,fontSize:13,fontWeight:600,color:"#ef4444",border:"none",outline:"none",background:"transparent",padding:"9px 12px 9px 4px",fontFamily:"inherit"}}/></div></div>
              <div><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:4}}>Leads Generated</div><input type="number" value={aqManual.leads} onChange={e=>setAqManual(p=>({...p,leads:e.target.value}))} placeholder="0" style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box",background:"#fafbfc"}}/></div>
              <div><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:4}}>Date</div><input type="date" value={aqManual.d} onChange={e=>setAqManual(p=>({...p,d:e.target.value}))} style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box",background:"#fafbfc"}}/></div>
            </div>
            <button onClick={()=>{const cost=Number(aqManual.cost)||0;const leads=Number(aqManual.leads)||0;if(!aqManual.source.trim())return;const nid=Date.now();setAqEntries(p=>[{id:nid,d:aqManual.d,source:aqManual.source.trim(),category:aqManual.category.trim()||"General",service:aqManual.service.trim(),cost,leads,cpl:leads>0?Math.round(cost/leads*100)/100:0,status:"active"},...p]);setAqHistory(p=>[{id:nid,ts:new Date().toISOString().slice(0,16).replace("T"," "),type:"manual",count:1,entries:[nid],label:"Manual — "+aqManual.source.trim()},...p]);setAqManual({source:"",category:"",service:"",cost:"",leads:"",d:new Date().toISOString().slice(0,10)});setAqModal(false);}} disabled={!aqManual.source.trim()} style={{width:"100%",padding:"11px",borderRadius:8,border:"none",background:aqManual.source.trim()?"#059669":"#e2e5ea",color:aqManual.source.trim()?"#fff":"#94a3b8",fontSize:13,fontWeight:600,cursor:aqManual.source.trim()?"pointer":"default",fontFamily:"inherit"}}>Add Entry</button>
          </div>}

        {aqTab==="csv"&&<div>
          <div style={{fontSize:12,color:"#64748b",marginBottom:8,lineHeight:1.5}}>Paste CSV data or click "Load Sample" to test. Format: <code style={{fontSize:11,background:"#f5f6f8",padding:"1px 5px",borderRadius:4}}>date,source,category,service,cost,leads</code></div>
          <textarea value={aqCsvText} onChange={e=>setAqCsvText(e.target.value)} rows={8} placeholder={"2026-02-20,Google Ads,Paid Search,PPC Campaign,4500,32\n2026-02-18,LinkedIn,Social Media,InMail Campaign,2800,18"} style={{width:"100%",border:"1px solid #e2e5ea",borderRadius:8,padding:"12px 14px",fontSize:12,fontFamily:"monospace",resize:"vertical",outline:"none",boxSizing:"border-box",background:"#fafbfc",marginBottom:12}}/>
          <div style={{display:"flex",gap:8}}>
            <button onClick={()=>setAqCsvText("2026-03-01,TikTok Ads,Social Media,Brand Awareness Campaign,3200,26\n2026-03-01,Google Display,Paid Display,Retargeting - Cart Abandoners,1800,15\n2026-02-28,Podcast Sponsor,Partnership,Tech Talk Weekly - 4 Episodes,5500,42\n2026-02-27,Cold Email,Direct,Outreach - Series A Startups,400,8\n2026-02-26,Bing Ads,Paid Search,Competitor Keywords Bid,950,11\n2026-02-25,Affiliate,Partnership,Partner Commission - Q1,2100,19")} style={{padding:"9px 16px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#374151"}}>Load Sample</button>
            <button onClick={()=>{if(!aqCsvText.trim())return;const rows=aqCsvText.trim().split("\n").map(r=>r.split(",").map(c=>c.trim()));const base=Date.now();const newEntries=rows.filter(r=>r.length>=5).map((r,i)=>{const cost=Number(r[4])||0;const leads=Number(r[5])||0;return {id:base+i,d:r[0]||new Date().toISOString().slice(0,10),source:r[1]||"Unknown",category:r[2]||"General",service:r[3]||"",cost,leads,cpl:leads>0?Math.round(cost/leads*100)/100:0,status:"active"};});if(newEntries.length){setAqEntries(p=>[...newEntries,...p]);setAqHistory(p=>[{id:base,ts:new Date().toISOString().slice(0,16).replace("T"," "),type:"csv",count:newEntries.length,entries:newEntries.map(e=>e.id),label:"CSV import — "+newEntries.length+" rows ("+[...new Set(newEntries.map(e=>e.source))].slice(0,3).join(", ")+(newEntries.length>3?" +more":"")+" )"},...p]);setAqModal(false);}}} disabled={!aqCsvText.trim()} style={{flex:1,padding:"9px",borderRadius:8,border:"none",background:aqCsvText.trim()?"#059669":"#e2e5ea",color:aqCsvText.trim()?"#fff":"#94a3b8",fontSize:12,fontWeight:600,cursor:aqCsvText.trim()?"pointer":"default",fontFamily:"inherit"}}>Import {aqCsvText.trim()?aqCsvText.trim().split("\n").filter(r=>r.trim()).length+" rows":"CSV"}</button>
          </div>
          {aqCsvText.trim()&&<div style={{marginTop:12,padding:12,borderRadius:8,background:"#f0fdf4",border:"1px solid #bbf7d0"}}><div style={{fontSize:11,fontWeight:600,color:"#059669",marginBottom:4}}>Preview ({aqCsvText.trim().split("\n").filter(r=>r.trim()).length} rows)</div>{aqCsvText.trim().split("\n").slice(0,4).map((r,i)=>{const c=r.split(",").map(x=>x.trim());return <div key={i} style={{fontSize:11,color:"#374151",padding:"3px 0",borderBottom:"1px solid #dcfce7"}}><strong>{c[1]||"?"}</strong> {" - "} {c[3]||"?"} {" · $"}{c[4]||0}{" · "}{c[5]||0}{" leads"}</div>;})}{aqCsvText.trim().split("\n").length>4&&<div style={{fontSize:10,color:"#94a3b8",marginTop:4}}>+{aqCsvText.trim().split("\n").length-4} more rows...</div>}</div>}
        </div>}
      </div></div>}

      {/* ── Acquisition History Modal ── */}
      {aqHistoryOpen&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,backdropFilter:"blur(4px)"}} onClick={()=>setAqHistoryOpen(false)}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:30,width:580,maxHeight:"85vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.18)"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18}}><div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:28,height:28,borderRadius:8,background:"#f0f4ff",display:"flex",alignItems:"center",justifyContent:"center",color:"#3b5bdb"}}><Ic t="clock" s={14}/></div><h3 style={{margin:0,fontSize:18,fontWeight:700}}>Import History</h3></div><button onClick={()=>setAqHistoryOpen(false)} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:4}}><Ic t="x" s={18}/></button></div>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14}}>
            <div style={{fontSize:12,color:"#64748b"}}>{aqHistory.length} import{aqHistory.length!==1?"s":""} · {aqEntries.length} total entries</div>
            {aqEntries.length>0&&<button onClick={()=>{if(confirm("Delete ALL acquisition entries and history? This cannot be undone.")){setAqEntries([]);setAqHistory([]);}}} style={{display:"flex",alignItems:"center",gap:4,padding:"6px 12px",borderRadius:6,border:"1px solid #fecaca",background:"#fef2f2",fontSize:11,fontWeight:600,color:"#ef4444",cursor:"pointer",fontFamily:"inherit"}}><Ic t="trash" s={12}/>Clear All Data</button>}
          </div>
          {aqHistory.map(h=>{const hEntries=aqEntries.filter(e=>h.entries.includes(e.id));const hCost=hEntries.reduce((s,e)=>s+e.cost,0);const hLeads=hEntries.reduce((s,e)=>s+e.leads,0);const stillExists=hEntries.length;
          return <div key={h.id} style={{padding:"14px 16px",borderRadius:10,border:"1px solid #eef0f2",marginBottom:8,background:"#fafbfc"}}>
            <div style={{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:10}}>
              <div style={{flex:1}}>
                <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:4}}>
                  <span style={{fontSize:10,fontWeight:600,padding:"2px 7px",borderRadius:6,background:h.type==="csv"?"#dbeafe":"#f0fdf4",color:h.type==="csv"?"#3b5bdb":"#059669"}}>{h.type==="csv"?"CSV":"Manual"}</span>
                  <span style={{fontSize:11,fontWeight:600}}>{h.count} entr{h.count!==1?"ies":"y"}</span>
                  {stillExists<h.count&&<span style={{fontSize:10,color:"#f59e0b"}}>({h.count-stillExists} deleted)</span>}
                </div>
                <div style={{fontSize:12,color:"#374151",marginBottom:3}}>{h.label}</div>
                <div style={{display:"flex",gap:12,fontSize:10,color:"#94a3b8"}}>
                  <span>{h.ts}</span>
                  {hCost>0&&<span>{"$"}{hCost.toLocaleString()} spent</span>}
                  {hLeads>0&&<span>{hLeads} leads</span>}
                </div>
              </div>
              <button onClick={()=>{setAqEntries(p=>p.filter(e=>!h.entries.includes(e.id)));setAqHistory(p=>p.map(x=>x.id===h.id?{...x,entries:[]}:x));}} disabled={!stillExists} style={{padding:"5px 10px",borderRadius:6,border:"1px solid "+(stillExists?"#fecaca":"#e2e5ea"),background:stillExists?"#fff":"#f5f6f8",fontSize:10,fontWeight:600,color:stillExists?"#ef4444":"#cbd5e1",cursor:stillExists?"pointer":"default",fontFamily:"inherit"}}><Ic t="trash" s={10}/> Delete</button>
            </div>
            {stillExists>0&&<div style={{marginTop:10,borderTop:"1px solid #eef0f2",paddingTop:8}}>{hEntries.slice(0,3).map(e=><div key={e.id} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 0",fontSize:11}}><span style={{color:"#374151"}}><strong>{e.source}</strong>{" — "}{e.service}</span><div style={{display:"flex",gap:10}}><span style={{color:"#ef4444",fontWeight:600}}>{"$"}{e.cost.toLocaleString()}</span><span style={{color:"#3b5bdb",fontWeight:600}}>{e.leads} leads</span></div></div>)}{stillExists>3&&<div style={{fontSize:10,color:"#94a3b8",marginTop:4}}>+{stillExists-3} more entries</div>}</div>}
          </div>;})}
          {!aqHistory.length&&<div style={{textAlign:"center",padding:30,color:"#94a3b8",fontSize:13}}>No import history yet.</div>}
      </div></div>}

      {/* ── Sale Modal ── */}
      {saleModal&&(()=>{
        const isEdit=!!saleModal.sale;
        const cId=saleModal.clientId;
        if(!saleModal.draft){const d=isEdit?{...saleModal.sale}:{id:Date.now(),d:new Date().toISOString().slice(0,10),amt:0,product:"",ag:team[0].name.split(" ")[0]+" "+team[0].name.split(" ")[1][0]+".",quality:"",saleType:"",netProfit:0,grossProfit:0,recurring:false,recurringFreq:"monthly",recurringAmt:0};setSaleModal({...saleModal,draft:d});return null;}
        const sd=saleModal.draft;
        const setSd=fn=>{const nv=typeof fn==="function"?fn(sd):{...sd,...fn};setSaleModal({...saleModal,draft:nv});};
        const Lbl=({children})=><div style={{fontSize:10,color:"#94a3b8",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600,marginBottom:4}}>{children}</div>;
        const TxtF=({field,ph})=><input value={sd[field]||""} onChange={e=>setSd(p=>({...p,[field]:e.target.value}))} placeholder={ph} style={{width:"100%",padding:"9px 12px",borderRadius:8,border:"1px solid #e2e5ea",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box",background:"#fafbfc"}}/>;
        const NumF=({field,ph})=><div style={{display:"flex",alignItems:"center",border:"1px solid #e2e5ea",borderRadius:8,background:"#fafbfc",overflow:"hidden"}}><span style={{fontSize:12,color:"#059669",fontWeight:700,padding:"9px 0 9px 12px"}}>$</span><input type="number" value={sd[field]||""} onChange={e=>setSd(p=>({...p,[field]:Number(e.target.value)||0}))} placeholder={ph} style={{flex:1,fontSize:13,fontWeight:600,color:"#059669",border:"none",outline:"none",background:"transparent",padding:"9px 12px 9px 6px",fontFamily:"inherit"}}/></div>;
        const saveSale=()=>{const saleObj={...sd,recurring:sd.recurring||false,recurringFreq:sd.recurring?sd.recurringFreq:"",recurringAmt:sd.recurring?sd.recurringAmt:0};if(isEdit){setSales(p=>({...p,[cId]:(p[cId]||[]).map(x=>x.id===sd.id?saleObj:x)}));}else{setSales(p=>({...p,[cId]:[saleObj,...(p[cId]||[])]}));}setSaleModal(null);};
        const cl=clients.find(x=>x.id===cId);
        return <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,backdropFilter:"blur(4px)"}} onClick={()=>setSaleModal(null)}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:30,width:500,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.18)"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><div><h3 style={{margin:0,fontSize:18,fontWeight:700}}>{isEdit?"Edit Sale":"New Sale"}</h3>{cl&&<div style={{fontSize:12,color:"#94a3b8",marginTop:2}}>{cl.name} · {cl.co}</div>}</div><button onClick={()=>setSaleModal(null)} style={{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",padding:4}}><Ic t="x" s={18}/></button></div>

          <div style={{marginBottom:14}}><Lbl>Product / Service Name</Lbl><TxtF field="product" ph="e.g. Enterprise Plan, Consulting Package..."/></div>

          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:14}}>
            <div><Lbl>Sale Type</Lbl><TxtF field="saleType" ph="e.g. New Business, Upsell, Renewal..."/></div>
            <div><Lbl>Quality</Lbl><TxtF field="quality" ph="e.g. Premium, Standard, Basic..."/></div>
          </div>

          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:14}}>
            <div><Lbl>Sale Amount</Lbl><NumF field="amt" ph="0"/></div>
            <div><Lbl>Expected Gross Profit</Lbl><NumF field="grossProfit" ph="0"/></div>
            <div><Lbl>Expected Net Profit</Lbl><NumF field="netProfit" ph="0"/></div>
          </div>

          <div style={{padding:"16px 18px",borderRadius:10,border:"1px solid "+(sd.recurring?"#3b5bdb30":"#e2e5ea"),background:sd.recurring?"#f0f4ff":"#fafbfc",marginBottom:20}}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:sd.recurring?14:0}}>
              <div style={{display:"flex",alignItems:"center",gap:8}}><Ic t="signal" s={15}/><div><div style={{fontSize:13,fontWeight:600}}>Recurring Billing</div><div style={{fontSize:11,color:"#64748b"}}>Subscribe client to automatic charges</div></div></div>
              <button onClick={()=>setSd(p=>({...p,recurring:!p.recurring}))} style={{width:44,height:24,borderRadius:12,border:"none",background:sd.recurring?"#3b5bdb":"#d1d5db",cursor:"pointer",position:"relative",transition:"background 0.2s"}}><div style={{width:20,height:20,borderRadius:10,background:"#fff",position:"absolute",top:2,left:sd.recurring?22:2,transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}}/></button>
            </div>
            {sd.recurring&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
              <div><Lbl>Frequency</Lbl><div style={{display:"flex",gap:4}}>{["monthly","quarterly","annually"].map(f=><button key={f} onClick={()=>setSd(p=>({...p,recurringFreq:f}))} style={{flex:1,padding:"7px 0",borderRadius:6,border:sd.recurringFreq===f?"2px solid #3b5bdb":"1px solid #e2e5ea",background:sd.recurringFreq===f?"#f0f4ff":"#fff",fontSize:11,fontWeight:sd.recurringFreq===f?600:400,color:sd.recurringFreq===f?"#3b5bdb":"#94a3b8",cursor:"pointer",fontFamily:"inherit",textTransform:"capitalize"}}>{f}</button>)}</div></div>
              <div><Lbl>Recurring Amount</Lbl><NumF field="recurringAmt" ph="0"/></div>
            </div>}
          </div>

          <div style={{display:"flex",gap:10}}><button onClick={()=>setSaleModal(null)} style={{flex:1,padding:"11px",borderRadius:8,border:"1px solid #e2e5ea",background:"#fff",fontSize:13,fontWeight:500,cursor:"pointer",fontFamily:"inherit",color:"#64748b"}}>Cancel</button><button onClick={saveSale} disabled={!sd.product.trim()} style={{flex:2,padding:"11px",borderRadius:8,border:"none",background:sd.product.trim()?"#059669":"#e2e5ea",color:sd.product.trim()?"#fff":"#94a3b8",fontSize:13,fontWeight:600,cursor:sd.product.trim()?"pointer":"default",fontFamily:"inherit"}}>{isEdit?"Save Changes":"Add Sale"}</button></div>
        </div></div>;
      })()}
      <style>{`@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}} @keyframes grow{0%{width:0}100%{width:100%}}`}</style>
    </div>
  );
}

</script></body></html>
